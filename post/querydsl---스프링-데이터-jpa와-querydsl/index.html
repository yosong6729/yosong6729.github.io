<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Querydsl] 스프링 데이터 JPA와 Querydsl | Yosong6729 Blog</title>
<meta name=keywords content="Querydsl"><meta name=description content='해당 글은 김영한님의 인프런 강의 실전! Querydsl을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
스프링 데이터 JPA 리포지토리 변경 스프링데이터 JPA - MemberRepository 생성
이전에 순수 JPA로 만든 리포지토리를 스프링 데이터 JPA 리포지토리로 변경하는데 username으로 member를 조회하는 것 빼고는 다 지원되기 때문에 다음과 같이 작성한다.
public interface MemberRepository extends JpaRepository<Member, Long> { List<Member> findByUsername(String username); } 스프링 데이터 JPA 테스트
@SpringBootTest @Transactional class MemberRepositoryTest { @Autowired EntityManager em; @Autowired MemberRepository memberRepository; @Test public void basicTest() { Member member = new Member("member1", 10); memberRepository.'><meta name=author content="yosong6729"><link rel=canonical href=https://yosong6729.github.io/post/querydsl---%EC%8A%A4%ED%94%84%EB%A7%81-%EB%8D%B0%EC%9D%B4%ED%84%B0-jpa%EC%99%80-querydsl/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://yosong6729.github.io/post/querydsl---%EC%8A%A4%ED%94%84%EB%A7%81-%EB%8D%B0%EC%9D%B4%ED%84%B0-jpa%EC%99%80-querydsl/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="[Querydsl] 스프링 데이터 JPA와 Querydsl"><meta property="og:description" content='해당 글은 김영한님의 인프런 강의 실전! Querydsl을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
스프링 데이터 JPA 리포지토리 변경 스프링데이터 JPA - MemberRepository 생성
이전에 순수 JPA로 만든 리포지토리를 스프링 데이터 JPA 리포지토리로 변경하는데 username으로 member를 조회하는 것 빼고는 다 지원되기 때문에 다음과 같이 작성한다.
public interface MemberRepository extends JpaRepository<Member, Long> { List<Member> findByUsername(String username); } 스프링 데이터 JPA 테스트
@SpringBootTest @Transactional class MemberRepositoryTest { @Autowired EntityManager em; @Autowired MemberRepository memberRepository; @Test public void basicTest() { Member member = new Member("member1", 10); memberRepository.'><meta property="og:type" content="article"><meta property="og:url" content="https://yosong6729.github.io/post/querydsl---%EC%8A%A4%ED%94%84%EB%A7%81-%EB%8D%B0%EC%9D%B4%ED%84%B0-jpa%EC%99%80-querydsl/"><meta property="og:image" content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-10-11T16:58:26+09:00"><meta property="article:modified_time" content="2024-10-11T16:58:26+09:00"><meta property="og:site_name" content="Yosong6729 Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[Querydsl] 스프링 데이터 JPA와 Querydsl"><meta name=twitter:description content='해당 글은 김영한님의 인프런 강의 실전! Querydsl을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
스프링 데이터 JPA 리포지토리 변경 스프링데이터 JPA - MemberRepository 생성
이전에 순수 JPA로 만든 리포지토리를 스프링 데이터 JPA 리포지토리로 변경하는데 username으로 member를 조회하는 것 빼고는 다 지원되기 때문에 다음과 같이 작성한다.
public interface MemberRepository extends JpaRepository<Member, Long> { List<Member> findByUsername(String username); } 스프링 데이터 JPA 테스트
@SpringBootTest @Transactional class MemberRepositoryTest { @Autowired EntityManager em; @Autowired MemberRepository memberRepository; @Test public void basicTest() { Member member = new Member("member1", 10); memberRepository.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yosong6729.github.io/post/"},{"@type":"ListItem","position":2,"name":"[Querydsl] 스프링 데이터 JPA와 Querydsl","item":"https://yosong6729.github.io/post/querydsl---%EC%8A%A4%ED%94%84%EB%A7%81-%EB%8D%B0%EC%9D%B4%ED%84%B0-jpa%EC%99%80-querydsl/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Querydsl] 스프링 데이터 JPA와 Querydsl","name":"[Querydsl] 스프링 데이터 JPA와 Querydsl","description":"해당 글은 김영한님의 인프런 강의 실전! Querydsl을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n스프링 데이터 JPA 리포지토리 변경 스프링데이터 JPA - MemberRepository 생성\n이전에 순수 JPA로 만든 리포지토리를 스프링 데이터 JPA 리포지토리로 변경하는데 username으로 member를 조회하는 것 빼고는 다 지원되기 때문에 다음과 같이 작성한다.\npublic interface MemberRepository extends JpaRepository\u0026lt;Member, Long\u0026gt; { List\u0026lt;Member\u0026gt; findByUsername(String username); } 스프링 데이터 JPA 테스트\n@SpringBootTest @Transactional class MemberRepositoryTest { @Autowired EntityManager em; @Autowired MemberRepository memberRepository; @Test public void basicTest() { Member member = new Member(\u0026#34;member1\u0026#34;, 10); memberRepository.","keywords":["Querydsl"],"articleBody":" 해당 글은 김영한님의 인프런 강의 실전! Querydsl을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n스프링 데이터 JPA 리포지토리 변경 스프링데이터 JPA - MemberRepository 생성\n이전에 순수 JPA로 만든 리포지토리를 스프링 데이터 JPA 리포지토리로 변경하는데 username으로 member를 조회하는 것 빼고는 다 지원되기 때문에 다음과 같이 작성한다.\npublic interface MemberRepository extends JpaRepository\u003cMember, Long\u003e { List\u003cMember\u003e findByUsername(String username); } 스프링 데이터 JPA 테스트\n@SpringBootTest @Transactional class MemberRepositoryTest { @Autowired EntityManager em; @Autowired MemberRepository memberRepository; @Test public void basicTest() { Member member = new Member(\"member1\", 10); memberRepository.save(member); Member findMember = memberRepository.findById(member.getId()).get(); assertThat(findMember).isEqualTo(member); List\u003cMember\u003e result1 = memberRepository.findAll(); assertThat(result1).containsExactly(member); List\u003cMember\u003e result2 = memberRepository.findByUsername(\"member1\"); assertThat(result2).containsExactly(member); } } 위 테스트를 실행한 결과 올바르게 작동되는것을 확인할수 있다.\nQuerydsl 전용 기능인 회원 search를 작성할 수 없다. → 사용자 정의 리포지토리가 필요하다. 사용자 정의 리포지토리 스프링 데이터 JPA 리포지토리에 Querydsl을 작성하는것이 안되기 때문에 사용자 정의 리포지토리가 필요하다.\n사용자 정의 리포지토리 사용법\n사용자 정의 인터페이스 작성 사용자 정의 인터페이스 구현 스프링 데이터 리포지토리에 사용자 정의 인터페이스 상속 사용자 정의 리포지토리 구성\n1.사용자 정의 인터페이스 작성\npublic interface MemberRepositoryCustom { List\u003cMemberTeamDto\u003e search(MemberSearchCondition condition); } 사용자 정의 인터페이스의 이름은 아무거나 해도 상관없다.\n2.사용자 정의 인터페이스 구현\npublic class MemberRepositoryImpl implements MemberRepositoryCustom{ private final JPAQueryFactory queryFactory; public MemberRepositoryImpl(EntityManager em) { this.queryFactory = new JPAQueryFactory(em); } @Override public List\u003cMemberTeamDto\u003e search(MemberSearchCondition condition) { return queryFactory .select(new QMemberTeamDto( member.id, member.username, member.age, team.id, team.name )) .from(member) .leftJoin(member.team, team) .where( usernameEq(condition.getUsername()), teamNameEq(condition.getTeamName()), ageGoe(condition.getAgeGoe()), ageLoe(condition.getAgeLoe()) ) .fetch(); } private BooleanExpression usernameEq(String username) { return hasText(username) ? member.username.eq(username) : null; } private BooleanExpression teamNameEq(String teamName) { return hasText(teamName) ? team.name.eq(teamName) : null; } private BooleanExpression ageGoe(Integer ageGoe) { return ageGoe != null ? member.age.goe(ageGoe) : null; } private BooleanExpression ageLoe(Integer ageLoe) { return ageLoe != null ? member.age.loe(ageLoe) : null; } } 사용자 정의 인터페이스 구현체의 이름은 스프링 데이터 인터페이스 명(MemberRepository) + Impl로 해야한다.\n3.스프링 데이터 리포지토리에 사용자 정의 인터페이스 상속\npublic interface MemberRepository extends JpaRepository\u003cMember, Long\u003e, MemberRepositoryCustom { List\u003cMember\u003e findByUsername(String username); } 위 방법 처럼 사용자 정의 인터페이스를 만드는 방법도 좋은 방법이지만 핵심 비즈니스 로직에서 재사용 가능성이 있거나, 엔티티를 많이 조회하는경우는 MemberRepository에 작성하고, 공용성이 없고 특정 API 종속되어있는 것들, 즉 수정 라이프 사이클이 API 화면에 맞춰있는 것들은 별도로 조회용 리포지토리를 만드는것도 괜찮은 방법이다.\n커스텀 리포지토리 동작 테스트 추가\n@Test public void searchTest() { Team teamA = new Team(\"teamA\"); Team teamB = new Team(\"teamB\"); em.persist(teamA); em.persist(teamB); Member member1 = new Member(\"member1\", 10, teamA); Member member2 = new Member(\"member2\", 20, teamA); Member member3 = new Member(\"member3\", 30, teamB); Member member4 = new Member(\"member4\", 40, teamB); em.persist(member1); em.persist(member2); em.persist(member3); em.persist(member4); MemberSearchCondition condition = new MemberSearchCondition(); condition.setAgeGoe(35); condition.setAgeLoe(40); condition.setTeamName(\"teamB\"); List\u003cMemberTeamDto\u003e result = memberRepository.search(condition); assertThat(result).extracting(\"username\").containsExactly(\"member4\"); } 위 테스트 실행시 올바르게 작동하는것을 알수있다.\n스프링 데이터 페이징 활용1 - Querydsl 페이징 연동 스프링 데이터 Page, Pageable을 활용하여 데이터 내용과 전체 카운트를 한번에 조회하는 단순한 방법과 데이터 내용과 전체 카운트를 별도로 조회하는 방법을 알아보자.\n사용자 정의 인터페이스에 페이징 2가지 추가\npublic interface MemberRepositoryCustom { List\u003cMemberTeamDto\u003e search(MemberSearchCondition condition); Page\u003cMemberTeamDto\u003e searchPageSimple(MemberSearchCondition condition, Pageable pageable); Page\u003cMemberTeamDto\u003e searchPageComplex(MemberSearchCondition condition, Pageable pageable); } 페이징을 사용 활용하기 때문에 반환 타입은 Page이고 파라미터에는 Pageable pageable이 들어간다.\n전체 카운트를 한번에 조회하는 단순한 방법 searchPageSimple(), fetchResults() 사용\n@Override public Page\u003cMemberTeamDto\u003e searchPageSimple(MemberSearchCondition condition, Pageable pageable) { QueryResults\u003cMemberTeamDto\u003e results = queryFactory .select(new QMemberTeamDto( member.id, member.username, member.age, team.id, team.name )) .from(member) .leftJoin(member.team, team) .where( usernameEq(condition.getUsername()), teamNameEq(condition.getTeamName()), ageGoe(condition.getAgeGoe()), ageLoe(condition.getAgeLoe()) ) .offset(pageable.getOffset()) .limit(pageable.getPageSize()) .fetchResults(); List\u003cMemberTeamDto\u003e content = results.getResults(); long total = results.getTotal(); return new PageImpl\u003c\u003e(content, pageable, total); } 파라미터로 받은 pageable을 이용하여 몇번째 페이지 부터 시작할지에 대한 정보를 offset()에, 몇개를 조회 할건지를 limit()에 작성한다. Querydsl이 제공하는 fetchResults()를 사용하면 내용과 전체 카운트를 한번에 조회할 수 있다.(실제 쿼리는 content(실제 데이터) 쿼리와, count 쿼리 총 2번 호출) fetchResults()는 카운트 쿼리 실행시 필요없는 order by는 제거한다. 테스트\n@Test public void searchPageSimple() { Team teamA = new Team(\"teamA\"); Team teamB = new Team(\"teamB\"); em.persist(teamA); em.persist(teamB); Member member1 = new Member(\"member1\", 10, teamA); Member member2 = new Member(\"member2\", 20, teamA); Member member3 = new Member(\"member3\", 30, teamB); Member member4 = new Member(\"member4\", 40, teamB); em.persist(member1); em.persist(member2); em.persist(member3); em.persist(member4); MemberSearchCondition condition = new MemberSearchCondition(); PageRequest pageRequest = PageRequest.of(0, 3); Page\u003cMemberTeamDto\u003e result = memberRepository.searchPageSimple(condition, pageRequest); assertThat(result.getSize()).isEqualTo(3); assertThat(result.getContent()).extracting(\"username\") .containsExactly(\"member1\", \"member2\", \"member3\"); } 테스트 결과 올바르게 작동하느것을 확인할수 있고 쿼리도 총 2개 나가는것을 확인할수 있다.\n데이터 내용과 전체 카운트 별도로 조회하는 방법 searchPageComplex()\n@Override public Page\u003cMemberTeamDto\u003e searchPageComplex(MemberSearchCondition condition, Pageable pageable) { List\u003cMemberTeamDto\u003e content = queryFactory .select(new QMemberTeamDto( member.id, member.username, member.age, team.id, team.name )) .from(member) .leftJoin(member.team, team) .where( usernameEq(condition.getUsername()), teamNameEq(condition.getTeamName()), ageGoe(condition.getAgeGoe()), ageLoe(condition.getAgeLoe()) ) .offset(pageable.getOffset()) .limit(pageable.getPageSize()) .fetch(); long total = queryFactory .select(member) .from(member) .leftJoin(member.team, team) .where( usernameEq(condition.getUsername()), teamNameEq(condition.getTeamName()), ageGoe(condition.getAgeGoe()), ageLoe(condition.getAgeLoe()) ) .fetchCount(); return new PageImpl\u003c\u003e(content, pageable, total); } 전체 데이터 내용과 전체 카운트를 한번에 조회하는 방법과 다른점은 fetch()를 사용하여 content(실제 데이터)만 가져오고 따로 fetchCount()를 이용하여 카운트를 가져오는 코드를 작성한다.\n전체 카운트를 조회 하는 방법을 최적화 할수 있으면 이렇게 분리하면된다.(예를 들어 전체 카운트를 조회할때 조인 쿼리를 줄일수 있다면 상당한 효과가 있다.) 코드를 리펙토링해서 내용 쿼리와 전체 카운트 쿼리를 읽기 좋게 분리하면 좋다. 스프링 데이터 페이징 활용2 - CountQuery 최적화 PageableExecutionUtils.getPage()로 최적화\nJPAQuery\u003cMember\u003e countQuery = queryFactory .select(member) .from(member) .leftJoin(member.team, team) .where( usernameEq(condition.getUsername()), teamNameEq(condition.getTeamName()), ageGoe(condition.getAgeGoe()), ageLoe(condition.getAgeLoe()) ); //return new PageImpl\u003c\u003e(content, pageable, total); return PageableExecutionUtils.getPage(content, pageable, countQuery::fetchCount); 스프링 데이터 라이브러리가 제공하낟. count 쿼리가 생략 가능한 경우에 생략해서 처리한다. 페이지 시작이면서 컨텐츠 사이즈가 페이지 사이즈보다 작을 때 마지막 페이지 일 때 (offset + 컨텐츠 사이즈를 더해서 전체 사이즈 구함, 더 정확히는 마지막 페이지이면서 컨텐츠 사이즈가 페이지 사이즈보다 작을 때) 스프링 데이터 페이징 활용3 - 컨트롤러 개발 컨트롤러\n@RestController @RequiredArgsConstructor public class MemberController { private final MemberJpaRepository memberJpaRepository; private final MemberRepository memberRepository; @GetMapping(\"/v1/members\") public List\u003cMemberTeamDto\u003e searchMemberV1(MemberSearchCondition condition) { return memberJpaRepository.search(condition); } @GetMapping(\"/v2/members\") public Page\u003cMemberTeamDto\u003e searchMemberV2(MemberSearchCondition condition, Pageable pageable) { return memberRepository.searchPageSimple(condition, pageable); } @GetMapping(\"/v3/members\") public Page\u003cMemberTeamDto\u003e searchMemberV3(MemberSearchCondition condition, Pageable pageable) { return memberRepository.searchPageComplex(condition, pageable); } } (http://localhost:8080/v2/members?page=0\u0026size=5)로 postman 실행결과 { \"content\": [ { \"memberId\": 1, \"username\": \"member0\", \"age\": 0, \"teamId\": 1, \"teamName\": \"teamA\" }, { \"memberId\": 2, \"username\": \"member1\", \"age\": 1, \"teamId\": 2, \"teamName\": \"teamB\" }, { \"memberId\": 3, \"username\": \"member2\", \"age\": 2, \"teamId\": 1, \"teamName\": \"teamA\" }, { \"memberId\": 4, \"username\": \"member3\", \"age\": 3, \"teamId\": 2, \"teamName\": \"teamB\" }, { \"memberId\": 5, \"username\": \"member4\", \"age\": 4, \"teamId\": 1, \"teamName\": \"teamA\" } ], \"pageable\": { \"pageNumber\": 0, \"pageSize\": 5, \"sort\": { \"empty\": true, \"sorted\": false, \"unsorted\": true }, \"offset\": 0, \"paged\": true, \"unpaged\": false }, \"last\": false, \"totalElements\": 100, \"totalPages\": 20, \"size\": 5, \"number\": 0, \"sort\": { \"empty\": true, \"sorted\": false, \"unsorted\": true }, \"first\": true, \"numberOfElements\": 5, \"empty\": false } 의도한 대로 결과가 나왔고 데이터와 전체 카운트를 한번에 조회하는 것이기때문에 쿼리 결과도 2번 다음과 같이 2번 나가는것을 확인할수 있다.\n(http://localhost:8080/v3/members?page=0\u0026size=110)로 postman 실행결과 { \"content\": [ { \"memberId\": 1, \"username\": \"member0\", \"age\": 0, \"teamId\": 1, \"teamName\": \"teamA\" }, { \"memberId\": 2, \"username\": \"member1\", \"age\": 1, \"teamId\": 2, \"teamName\": \"teamB\" }, ... { \"memberId\": 99, \"username\": \"member98\", \"age\": 98, \"teamId\": 1, \"teamName\": \"teamA\" }, { \"memberId\": 100, \"username\": \"member99\", \"age\": 99, \"teamId\": 2, \"teamName\": \"teamB\" } ], \"pageable\": { \"pageNumber\": 0, \"pageSize\": 110, \"sort\": { \"empty\": true, \"sorted\": false, \"unsorted\": true }, \"offset\": 0, \"paged\": true, \"unpaged\": false }, \"last\": true, \"totalElements\": 100, \"totalPages\": 1, \"size\": 110, \"number\": 0, \"sort\": { \"empty\": true, \"sorted\": false, \"unsorted\": true }, \"first\": true, \"numberOfElements\": 100, \"empty\": false } 의도한 대로 결과 나왔고, count쿼리가 생략이 가능한 경우인 페이지 시작이면서 먼텐츠 사이즈가 페이지 사이즈보다작은경우 이기때문에 다음과 같이 쿼리 결과가 하나만 호추되는것을 확인할수 있다.\n스프링 데이터 정렬(Sort) 스프링 데이터 JPA는 자신의 정렬(Sort)을 Querydsl의 정렬(OrderSpecifier)로 편리하게 변경하는 기능을 제공한다.\n스프링 데이터의 정렬을 Querydsl의 정렬로 직접 전환하는 방법은 다음 코드를 참고하자.\n스프링 데이터 Sort를 Querydsl로 OrderSpecifier로 변환\nJPAQuery\u003cMember\u003e query = queryFactory .selectFrom(member); for (Sort.Order o : pageable.getSort()) { PathBuilder pathBuilder = new PathBuilder(member.getType(), member.getMetadata()); query.orderBy(new OrderSpecifier(o.isAscending() ? Order.ASC : Order.DESC, pathBuilder.get(o.getProperty()))); } List\u003cMember\u003e result = query.fetch(); 정렬(Sort)은 조건이 조인이 포함되는 경우와 같이 조금만 복잡해져도 Pageable의 Sort 기능을 사용하기는 어렵다. 루트 엔티티 범위를 넘어가는 동적 정렬 기능이 필요하면 스프링 데이터 페이징이 제공하는 Sort를 사용하기 보다는 파라미터를 받아서 직접 처리하는 것을 권장한다.\n","wordCount":"1276","inLanguage":"en","image":"https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-11T16:58:26+09:00","dateModified":"2024-10-11T16:58:26+09:00","author":{"@type":"Person","name":"yosong6729"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yosong6729.github.io/post/querydsl---%EC%8A%A4%ED%94%84%EB%A7%81-%EB%8D%B0%EC%9D%B4%ED%84%B0-jpa%EC%99%80-querydsl/"},"publisher":{"@type":"Organization","name":"Yosong6729 Blog","logo":{"@type":"ImageObject","url":"https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yosong6729.github.io/ accesskey=h title="Yosong6729 블로그 (Alt + H)"><img src=https://yosong6729.github.io/apple-touch-icon.png alt aria-label=logo height=35>Yosong6729 블로그</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yosong6729.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://yosong6729.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yosong6729.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://yosong6729.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">[Querydsl] 스프링 데이터 JPA와 Querydsl</h1><div class=post-meta><span title='2024-10-11 16:58:26 +0900 KST'>October 11, 2024</span>&nbsp;·&nbsp;yosong6729&nbsp;|&nbsp;<a href=https://github.com/yosong6729/blog/tree/main/content/post/Querydsl%20-%20%ec%8a%a4%ed%94%84%eb%a7%81%20%eb%8d%b0%ec%9d%b4%ed%84%b0%20JPA%ec%99%80%20Querydsl/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%ec%8a%a4%ed%94%84%eb%a7%81-%eb%8d%b0%ec%9d%b4%ed%84%b0-jpa-%eb%a6%ac%ed%8f%ac%ec%a7%80%ed%86%a0%eb%a6%ac-%eb%b3%80%ea%b2%bd aria-label="스프링 데이터 JPA 리포지토리 변경">스프링 데이터 JPA 리포지토리 변경</a></li><li><a href=#%ec%82%ac%ec%9a%a9%ec%9e%90-%ec%a0%95%ec%9d%98-%eb%a6%ac%ed%8f%ac%ec%a7%80%ed%86%a0%eb%a6%ac aria-label="사용자 정의 리포지토리">사용자 정의 리포지토리</a></li><li><a href=#%ec%8a%a4%ed%94%84%eb%a7%81-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ed%8e%98%ec%9d%b4%ec%a7%95-%ed%99%9c%ec%9a%a91---querydsl-%ed%8e%98%ec%9d%b4%ec%a7%95-%ec%97%b0%eb%8f%99 aria-label="스프링 데이터 페이징 활용1 - Querydsl 페이징 연동">스프링 데이터 페이징 활용1 - Querydsl 페이징 연동</a><ul><li><a href=#%ec%a0%84%ec%b2%b4-%ec%b9%b4%ec%9a%b4%ed%8a%b8%eb%a5%bc-%ed%95%9c%eb%b2%88%ec%97%90-%ec%a1%b0%ed%9a%8c%ed%95%98%eb%8a%94-%eb%8b%a8%ec%88%9c%ed%95%9c-%eb%b0%a9%eb%b2%95 aria-label="전체 카운트를 한번에 조회하는 단순한 방법">전체 카운트를 한번에 조회하는 단순한 방법</a></li><li><a href=#%eb%8d%b0%ec%9d%b4%ed%84%b0-%eb%82%b4%ec%9a%a9%ea%b3%bc-%ec%a0%84%ec%b2%b4-%ec%b9%b4%ec%9a%b4%ed%8a%b8-%eb%b3%84%eb%8f%84%eb%a1%9c-%ec%a1%b0%ed%9a%8c%ed%95%98%eb%8a%94-%eb%b0%a9%eb%b2%95 aria-label="데이터 내용과 전체 카운트 별도로 조회하는 방법">데이터 내용과 전체 카운트 별도로 조회하는 방법</a></li></ul></li><li><a href=#%ec%8a%a4%ed%94%84%eb%a7%81-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ed%8e%98%ec%9d%b4%ec%a7%95-%ed%99%9c%ec%9a%a92---countquery-%ec%b5%9c%ec%a0%81%ed%99%94 aria-label="스프링 데이터 페이징 활용2 - CountQuery 최적화">스프링 데이터 페이징 활용2 - CountQuery 최적화</a></li><li><a href=#%ec%8a%a4%ed%94%84%eb%a7%81-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ed%8e%98%ec%9d%b4%ec%a7%95-%ed%99%9c%ec%9a%a93---%ec%bb%a8%ed%8a%b8%eb%a1%a4%eb%9f%ac-%ea%b0%9c%eb%b0%9c aria-label="스프링 데이터 페이징 활용3 - 컨트롤러 개발">스프링 데이터 페이징 활용3 - 컨트롤러 개발</a><ul><li><a href=#%ec%8a%a4%ed%94%84%eb%a7%81-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ec%a0%95%eb%a0%acsort aria-label="스프링 데이터 정렬(Sort)">스프링 데이터 정렬(Sort)</a></li></ul></li></ul></div></details></div><div class=post-content><blockquote><p>해당 글은 김영한님의 인프런 강의 <a href=https://www.inflearn.com/course/querydsl-%EC%8B%A4%EC%A0%84>실전! Querydsl</a>을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.</p></blockquote><hr><h2 id=스프링-데이터-jpa-리포지토리-변경>스프링 데이터 JPA 리포지토리 변경<a hidden class=anchor aria-hidden=true href=#스프링-데이터-jpa-리포지토리-변경>#</a></h2><p><strong>스프링데이터 JPA - MemberRepository 생성</strong></p><p>이전에 순수 JPA로 만든 리포지토리를 스프링 데이터 JPA 리포지토리로 변경하는데 username으로 member를 조회하는 것 빼고는 다 지원되기 때문에 다음과 같이 작성한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>MemberRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Member</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsername</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>스프링 데이터 JPA 테스트</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>MemberRepositoryTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>EntityManager</span><span class=w> </span><span class=n>em</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MemberRepository</span><span class=w> </span><span class=n>memberRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>basicTest</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>findMember</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result1</span><span class=p>).</span><span class=na>containsExactly</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>findByUsername</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result2</span><span class=p>).</span><span class=na>containsExactly</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>위 테스트를 실행한 결과 올바르게 작동되는것을 확인할수 있다.</p><ul><li>Querydsl 전용 기능인 회원 search를 작성할 수 없다. → 사용자 정의 리포지토리가 필요하다.</li></ul><hr><h2 id=사용자-정의-리포지토리>사용자 정의 리포지토리<a hidden class=anchor aria-hidden=true href=#사용자-정의-리포지토리>#</a></h2><p>스프링 데이터 JPA 리포지토리에 Querydsl을 작성하는것이 안되기 때문에 사용자 정의 리포지토리가 필요하다.</p><p><strong>사용자 정의 리포지토리 사용법</strong></p><ol><li>사용자 정의 인터페이스 작성</li><li>사용자 정의 인터페이스 구현</li><li>스프링 데이터 리포지토리에 사용자 정의 인터페이스 상속</li></ol><p><strong>사용자 정의 리포지토리 구성</strong></p><p><img loading=lazy src=images/image.png alt=image.png></p><p><strong>1.사용자 정의 인터페이스 작성</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>MemberRepositoryCustom</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>search</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>사용자 정의 인터페이스의 이름은 아무거나 해도 상관없다.</p><p><strong>2.사용자 정의 인터페이스 구현</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberRepositoryImpl</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>MemberRepositoryCustom</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JPAQueryFactory</span><span class=w> </span><span class=n>queryFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>MemberRepositoryImpl</span><span class=p>(</span><span class=n>EntityManager</span><span class=w> </span><span class=n>em</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>queryFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JPAQueryFactory</span><span class=p>(</span><span class=n>em</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>search</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>queryFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>QMemberTeamDto</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>member</span><span class=p>.</span><span class=na>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>member</span><span class=p>.</span><span class=na>username</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>member</span><span class=p>.</span><span class=na>age</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>team</span><span class=p>.</span><span class=na>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>team</span><span class=p>.</span><span class=na>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>leftJoin</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>team</span><span class=p>,</span><span class=w> </span><span class=n>team</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>usernameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>teamNameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getTeamName</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>ageGoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeGoe</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>ageLoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeLoe</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>fetch</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>BooleanExpression</span><span class=w> </span><span class=nf>usernameEq</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>hasText</span><span class=p>(</span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>member</span><span class=p>.</span><span class=na>username</span><span class=p>.</span><span class=na>eq</span><span class=p>(</span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>BooleanExpression</span><span class=w> </span><span class=nf>teamNameEq</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>teamName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>hasText</span><span class=p>(</span><span class=n>teamName</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>team</span><span class=p>.</span><span class=na>name</span><span class=p>.</span><span class=na>eq</span><span class=p>(</span><span class=n>teamName</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>BooleanExpression</span><span class=w> </span><span class=nf>ageGoe</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>ageGoe</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ageGoe</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>member</span><span class=p>.</span><span class=na>age</span><span class=p>.</span><span class=na>goe</span><span class=p>(</span><span class=n>ageGoe</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>BooleanExpression</span><span class=w> </span><span class=nf>ageLoe</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>ageLoe</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ageLoe</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>member</span><span class=p>.</span><span class=na>age</span><span class=p>.</span><span class=na>loe</span><span class=p>(</span><span class=n>ageLoe</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>사용자 정의 인터페이스 구현체의 이름은 <strong>스프링 데이터 인터페이스 명(MemberRepository) + Impl</strong>로 해야한다.</p><p><strong>3.스프링 데이터 리포지토리에 사용자 정의 인터페이스 상속</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>MemberRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Member</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                                                                                    </span><span class=n>MemberRepositoryCustom</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsername</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>위 방법 처럼 사용자 정의 인터페이스를 만드는 방법도 좋은 방법이지만 핵심 비즈니스 로직에서 재사용 가능성이 있거나, 엔티티를 많이 조회하는경우는 MemberRepository에 작성하고, 공용성이 없고 특정 API 종속되어있는 것들, 즉 수정 라이프 사이클이 API 화면에 맞춰있는 것들은 별도로 조회용 리포지토리를 만드는것도 괜찮은 방법이다.</p><p><strong>커스텀 리포지토리 동작 테스트 추가</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>searchTest</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Team</span><span class=w> </span><span class=n>teamA</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>(</span><span class=s>&#34;teamA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Team</span><span class=w> </span><span class=n>teamB</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>(</span><span class=s>&#34;teamB&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>teamA</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>teamB</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>,</span><span class=w> </span><span class=n>teamA</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member2&#34;</span><span class=p>,</span><span class=w> </span><span class=n>20</span><span class=p>,</span><span class=w> </span><span class=n>teamA</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member3&#34;</span><span class=p>,</span><span class=w> </span><span class=n>30</span><span class=p>,</span><span class=w> </span><span class=n>teamB</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member4</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member4&#34;</span><span class=p>,</span><span class=w> </span><span class=n>40</span><span class=p>,</span><span class=w> </span><span class=n>teamB</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member4</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>MemberSearchCondition</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>condition</span><span class=p>.</span><span class=na>setAgeGoe</span><span class=p>(</span><span class=n>35</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>condition</span><span class=p>.</span><span class=na>setAgeLoe</span><span class=p>(</span><span class=n>40</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>condition</span><span class=p>.</span><span class=na>setTeamName</span><span class=p>(</span><span class=s>&#34;teamB&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>search</span><span class=p>(</span><span class=n>condition</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>).</span><span class=na>extracting</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>).</span><span class=na>containsExactly</span><span class=p>(</span><span class=s>&#34;member4&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>위 테스트 실행시 올바르게 작동하는것을 알수있다.</p><hr><h2 id=스프링-데이터-페이징-활용1---querydsl-페이징-연동>스프링 데이터 페이징 활용1 - Querydsl 페이징 연동<a hidden class=anchor aria-hidden=true href=#스프링-데이터-페이징-활용1---querydsl-페이징-연동>#</a></h2><p>스프링 데이터 Page, Pageable을 활용하여 데이터 내용과 전체 카운트를 한번에 조회하는 단순한 방법과 데이터 내용과 전체 카운트를 별도로 조회하는 방법을 알아보자.</p><p><strong>사용자 정의 인터페이스에 페이징 2가지 추가</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>MemberRepositoryCustom</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>search</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>searchPageSimple</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>pageable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>searchPageComplex</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>pageable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>페이징을 사용 활용하기 때문에 반환 타입은 Page이고 파라미터에는 Pageable pageable이 들어간다.</p><h3 id=전체-카운트를-한번에-조회하는-단순한-방법>전체 카운트를 한번에 조회하는 단순한 방법<a hidden class=anchor aria-hidden=true href=#전체-카운트를-한번에-조회하는-단순한-방법>#</a></h3><p><strong>searchPageSimple(), fetchResults() 사용</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>searchPageSimple</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>pageable</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>QueryResults</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=n>results</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>queryFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>QMemberTeamDto</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>username</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>age</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>team</span><span class=p>.</span><span class=na>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>team</span><span class=p>.</span><span class=na>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>leftJoin</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>team</span><span class=p>,</span><span class=w> </span><span class=n>team</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>usernameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>teamNameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getTeamName</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ageGoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeGoe</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ageLoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeLoe</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>offset</span><span class=p>(</span><span class=n>pageable</span><span class=p>.</span><span class=na>getOffset</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=n>pageable</span><span class=p>.</span><span class=na>getPageSize</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>fetchResults</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=n>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>results</span><span class=p>.</span><span class=na>getResults</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>long</span><span class=w> </span><span class=n>total</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>results</span><span class=p>.</span><span class=na>getTotal</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PageImpl</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>content</span><span class=p>,</span><span class=w> </span><span class=n>pageable</span><span class=p>,</span><span class=w> </span><span class=n>total</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>파라미터로 받은 pageable을 이용하여 몇번째 페이지 부터 시작할지에 대한 정보를 offset()에, 몇개를 조회 할건지를 limit()에 작성한다.</li><li>Querydsl이 제공하는 fetchResults()를 사용하면 내용과 전체 카운트를 한번에 조회할 수 있다.(실제 쿼리는 content(실제 데이터) 쿼리와, count 쿼리 총 2번 호출)</li><li>fetchResults()는 카운트 쿼리 실행시 필요없는 order by는 제거한다.</li></ul><p><strong>테스트</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>searchPageSimple</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Team</span><span class=w> </span><span class=n>teamA</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>(</span><span class=s>&#34;teamA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Team</span><span class=w> </span><span class=n>teamB</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>(</span><span class=s>&#34;teamB&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>teamA</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>teamB</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>,</span><span class=w> </span><span class=n>teamA</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member2&#34;</span><span class=p>,</span><span class=w> </span><span class=n>20</span><span class=p>,</span><span class=w> </span><span class=n>teamA</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member3&#34;</span><span class=p>,</span><span class=w> </span><span class=n>30</span><span class=p>,</span><span class=w> </span><span class=n>teamB</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member4</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member4&#34;</span><span class=p>,</span><span class=w> </span><span class=n>40</span><span class=p>,</span><span class=w> </span><span class=n>teamB</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member4</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>MemberSearchCondition</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PageRequest</span><span class=w> </span><span class=n>pageRequest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>PageRequest</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>searchPageSimple</span><span class=p>(</span><span class=n>condition</span><span class=p>,</span><span class=w> </span><span class=n>pageRequest</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>getSize</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>getContent</span><span class=p>()).</span><span class=na>extracting</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>containsExactly</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;member2&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;member3&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>테스트 결과 올바르게 작동하느것을 확인할수 있고 쿼리도 총 2개 나가는것을 확인할수 있다.</p><p><img loading=lazy src=images/image%201.png alt=image.png></p><p><img loading=lazy src=images/image%202.png alt=image.png></p><h3 id=데이터-내용과-전체-카운트-별도로-조회하는-방법>데이터 내용과 전체 카운트 별도로 조회하는 방법<a hidden class=anchor aria-hidden=true href=#데이터-내용과-전체-카운트-별도로-조회하는-방법>#</a></h3><p><strong>searchPageComplex()</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>searchPageComplex</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>pageable</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=n>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>queryFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>QMemberTeamDto</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>username</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>age</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>team</span><span class=p>.</span><span class=na>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>team</span><span class=p>.</span><span class=na>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>leftJoin</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>team</span><span class=p>,</span><span class=w> </span><span class=n>team</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>usernameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>teamNameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getTeamName</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ageGoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeGoe</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ageLoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeLoe</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>offset</span><span class=p>(</span><span class=n>pageable</span><span class=p>.</span><span class=na>getOffset</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=n>pageable</span><span class=p>.</span><span class=na>getPageSize</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>fetch</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>long</span><span class=w> </span><span class=n>total</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>queryFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>leftJoin</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>team</span><span class=p>,</span><span class=w> </span><span class=n>team</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>usernameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>teamNameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getTeamName</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ageGoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeGoe</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ageLoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeLoe</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>fetchCount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PageImpl</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>content</span><span class=p>,</span><span class=w> </span><span class=n>pageable</span><span class=p>,</span><span class=w> </span><span class=n>total</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>전체 데이터 내용과 전체 카운트를 한번에 조회하는 방법과 다른점은 fetch()를 사용하여 content(실제 데이터)만 가져오고 따로 fetchCount()를 이용하여 카운트를 가져오는 코드를 작성한다.</p><ul><li>전체 카운트를 조회 하는 방법을 최적화 할수 있으면 이렇게 분리하면된다.(예를 들어 전체 카운트를 조회할때 조인 쿼리를 줄일수 있다면 상당한 효과가 있다.)</li><li>코드를 리펙토링해서 내용 쿼리와 전체 카운트 쿼리를 읽기 좋게 분리하면 좋다.</li></ul><hr><h2 id=스프링-데이터-페이징-활용2---countquery-최적화>스프링 데이터 페이징 활용2 - CountQuery 최적화<a hidden class=anchor aria-hidden=true href=#스프링-데이터-페이징-활용2---countquery-최적화>#</a></h2><p><strong>PageableExecutionUtils.getPage()로 최적화</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>JPAQuery</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>countQuery</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>queryFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>leftJoin</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>team</span><span class=p>,</span><span class=w> </span><span class=n>team</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>usernameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>teamNameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getTeamName</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ageGoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeGoe</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ageLoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeLoe</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//return new PageImpl&lt;&gt;(content, pageable, total);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>return</span><span class=w> </span><span class=n>PageableExecutionUtils</span><span class=p>.</span><span class=na>getPage</span><span class=p>(</span><span class=n>content</span><span class=p>,</span><span class=w> </span><span class=n>pageable</span><span class=p>,</span><span class=w> </span><span class=n>countQuery</span><span class=p>::</span><span class=n>fetchCount</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><ul><li>스프링 데이터 라이브러리가 제공하낟.</li><li>count 쿼리가 생략 가능한 경우에 생략해서 처리한다.<ul><li>페이지 시작이면서 컨텐츠 사이즈가 페이지 사이즈보다 작을 때</li><li>마지막 페이지 일 때 (offset + 컨텐츠 사이즈를 더해서 전체 사이즈 구함, 더 정확히는 마지막 페이지이면서 컨텐츠 사이즈가 페이지 사이즈보다 작을 때)</li></ul></li></ul><hr><h2 id=스프링-데이터-페이징-활용3---컨트롤러-개발>스프링 데이터 페이징 활용3 - 컨트롤러 개발<a hidden class=anchor aria-hidden=true href=#스프링-데이터-페이징-활용3---컨트롤러-개발>#</a></h2><p><strong>컨트롤러</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequiredArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MemberJpaRepository</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MemberRepository</span><span class=w> </span><span class=n>memberRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/v1/members&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>searchMemberV1</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>search</span><span class=p>(</span><span class=n>condition</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/v2/members&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>searchMemberV2</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>pageable</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>searchPageSimple</span><span class=p>(</span><span class=n>condition</span><span class=p>,</span><span class=w> </span><span class=n>pageable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/v3/members&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>searchMemberV3</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>pageable</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>searchPageComplex</span><span class=p>(</span><span class=n>condition</span><span class=p>,</span><span class=w> </span><span class=n>pageable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>(http://localhost:8080/v2/members?page=0&amp;size=5)로 postman 실행결과</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;memberId&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;member0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamId&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamName&#34;</span><span class=p>:</span> <span class=s2>&#34;teamA&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;memberId&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;member1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamId&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamName&#34;</span><span class=p>:</span> <span class=s2>&#34;teamB&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;memberId&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;member2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamId&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamName&#34;</span><span class=p>:</span> <span class=s2>&#34;teamA&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;memberId&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;member3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamId&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamName&#34;</span><span class=p>:</span> <span class=s2>&#34;teamB&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;memberId&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;member4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamId&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamName&#34;</span><span class=p>:</span> <span class=s2>&#34;teamA&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;pageable&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;pageNumber&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;pageSize&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;sort&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;empty&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;sorted&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;unsorted&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;offset&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;paged&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;unpaged&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;last&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;totalElements&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;totalPages&#34;</span><span class=p>:</span> <span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;size&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;number&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sort&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;empty&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;sorted&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;unsorted&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;first&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;numberOfElements&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;empty&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>의도한 대로 결과가 나왔고 데이터와 전체 카운트를 한번에 조회하는 것이기때문에 쿼리 결과도 2번 다음과 같이 2번 나가는것을 확인할수 있다.</p><p><img loading=lazy src=images/image%203.png alt=image.png></p><p><img loading=lazy src=images/image%204.png alt=image.png></p><ul><li>(http://localhost:8080/v3/members?page=0&amp;size=110)로 postman 실행결과</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;memberId&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;member0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamId&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamName&#34;</span><span class=p>:</span> <span class=s2>&#34;teamA&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;memberId&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;member1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamId&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamName&#34;</span><span class=p>:</span> <span class=s2>&#34;teamB&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=err>...</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;memberId&#34;</span><span class=p>:</span> <span class=mi>99</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;member98&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>98</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamId&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamName&#34;</span><span class=p>:</span> <span class=s2>&#34;teamA&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;memberId&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;member99&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>99</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamId&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;teamName&#34;</span><span class=p>:</span> <span class=s2>&#34;teamB&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;pageable&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;pageNumber&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;pageSize&#34;</span><span class=p>:</span> <span class=mi>110</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;sort&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;empty&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;sorted&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;unsorted&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;offset&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;paged&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;unpaged&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;last&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;totalElements&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;totalPages&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;size&#34;</span><span class=p>:</span> <span class=mi>110</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;number&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sort&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;empty&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;sorted&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;unsorted&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;first&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;numberOfElements&#34;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;empty&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>의도한 대로 결과 나왔고, count쿼리가 생략이 가능한 경우인 페이지 시작이면서 먼텐츠 사이즈가 페이지 사이즈보다작은경우 이기때문에 다음과 같이 쿼리 결과가 하나만 호추되는것을 확인할수 있다.</p><p><img loading=lazy src=images/image%205.png alt=image.png></p><h3 id=스프링-데이터-정렬sort>스프링 데이터 정렬(Sort)<a hidden class=anchor aria-hidden=true href=#스프링-데이터-정렬sort>#</a></h3><p>스프링 데이터 JPA는 자신의 정렬(Sort)을 Querydsl의 정렬(OrderSpecifier)로 편리하게 변경하는 기능을 제공한다.</p><p>스프링 데이터의 정렬을 Querydsl의 정렬로 직접 전환하는 방법은 다음 코드를 참고하자.</p><p><strong>스프링 데이터 Sort를 Querydsl로 OrderSpecifier로 변환</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>JPAQuery</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>queryFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>.</span><span class=na>selectFrom</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Sort</span><span class=p>.</span><span class=na>Order</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>pageable</span><span class=p>.</span><span class=na>getSort</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>PathBuilder</span><span class=w> </span><span class=n>pathBuilder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PathBuilder</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>getType</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>member</span><span class=p>.</span><span class=na>getMetadata</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=n>query</span><span class=p>.</span><span class=na>orderBy</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>OrderSpecifier</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=na>isAscending</span><span class=p>()</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>Order</span><span class=p>.</span><span class=na>ASC</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>Order</span><span class=p>.</span><span class=na>DESC</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>pathBuilder</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=na>getProperty</span><span class=p>())));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>query</span><span class=p>.</span><span class=na>fetch</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>정렬(Sort)은 조건이 조인이 포함되는 경우와 같이 조금만 복잡해져도 Pageable의 Sort 기능을 사용하기는 어렵다. 루트 엔티티 범위를 넘어가는 동적 정렬 기능이 필요하면 스프링 데이터 페이징이 제공하는 Sort를 사용하기 보다는 파라미터를 받아서 직접 처리하는 것을 권장한다.</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://yosong6729.github.io/tags/querydsl/>Querydsl</a></li></ul><nav class=paginav><a class=prev href=https://yosong6729.github.io/post/querydsl---%EC%8A%A4%ED%94%84%EB%A7%81-%EB%8D%B0%EC%9D%B4%ED%84%B0-jpa%EA%B0%80-%EC%A0%9C%EA%B3%B5%ED%95%98%EB%8A%94-querydsl-%EA%B8%B0%EB%8A%A5/><span class=title>« Prev</span><br><span>[Querydsl] 스프링 데이터 JPA가 제공하는 Querydsl 기능</span>
</a><a class=next href=https://yosong6729.github.io/post/querydsl---%EC%88%9C%EC%88%98-jpa-querydsl/><span class=title>Next »</span><br><span>[Querydsl] 순수 JPA와 Querydsl</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://yosong6729.github.io/>Yosong6729 Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>