<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[자바 ORM 표준 JPA 프로그래밍 - 기본편] 객체지향 쿼리 언어1 - 기본문법 | Yosong6729 Blog</title>
<meta name=keywords content="JPA"><meta name=description content='객체지향 쿼리 언어 소개 JPA는 다양한 쿼리 방법을 지원 JPQL JPA Criteria QueryDSL 네이티브 SQL JDBC API 직접 사용, MyBatis, SpringJdbcTemplate 함께 사용 JPQL 소개 가장 단순한 조회 방법 EntityManager.find() 객체 그래프 탐색(a.getB().getC()) JPQL JPA를 사용하면 엔티티 객체를 중심으로 개발 문제는 검색 쿼리 검색을 할 때도 테이블이 아닌 엔티티 객체를 대상으로 검색 모든 DB 데이터를 객체로 변환해서 검색하는 것은 불가능 애플리케이션이 필요한 데이터만 DB에서 불러오려면 결국 검색 조건이 포함된 SQL이 필요 JPA는 SQL을 추상화한 JPQL이라는 객체 지향 쿼리 언어 제공 SQL과 문법 유사, SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN 지원 JPQL은 엔티티 객체를 대상으로 쿼리 SQL은 데이터베이스 테이블을 대상으로 쿼리 //검색 String jpql = "select m From Member m where m.'><meta name=author content="yosong6729"><link rel=canonical href=https://yosong6729.github.io/post/%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5-%EC%BF%BC%EB%A6%AC-%EC%96%B8%EC%96%B41---%EA%B8%B0%EB%B3%B8%EB%AC%B8%EB%B2%95/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://yosong6729.github.io/post/%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5-%EC%BF%BC%EB%A6%AC-%EC%96%B8%EC%96%B41---%EA%B8%B0%EB%B3%B8%EB%AC%B8%EB%B2%95/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="[자바 ORM 표준 JPA 프로그래밍 - 기본편] 객체지향 쿼리 언어1 - 기본문법"><meta property="og:description" content='객체지향 쿼리 언어 소개 JPA는 다양한 쿼리 방법을 지원 JPQL JPA Criteria QueryDSL 네이티브 SQL JDBC API 직접 사용, MyBatis, SpringJdbcTemplate 함께 사용 JPQL 소개 가장 단순한 조회 방법 EntityManager.find() 객체 그래프 탐색(a.getB().getC()) JPQL JPA를 사용하면 엔티티 객체를 중심으로 개발 문제는 검색 쿼리 검색을 할 때도 테이블이 아닌 엔티티 객체를 대상으로 검색 모든 DB 데이터를 객체로 변환해서 검색하는 것은 불가능 애플리케이션이 필요한 데이터만 DB에서 불러오려면 결국 검색 조건이 포함된 SQL이 필요 JPA는 SQL을 추상화한 JPQL이라는 객체 지향 쿼리 언어 제공 SQL과 문법 유사, SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN 지원 JPQL은 엔티티 객체를 대상으로 쿼리 SQL은 데이터베이스 테이블을 대상으로 쿼리 //검색 String jpql = "select m From Member m where m.'><meta property="og:type" content="article"><meta property="og:url" content="https://yosong6729.github.io/post/%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5-%EC%BF%BC%EB%A6%AC-%EC%96%B8%EC%96%B41---%EA%B8%B0%EB%B3%B8%EB%AC%B8%EB%B2%95/"><meta property="og:image" content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-09-18T22:20:14+09:00"><meta property="article:modified_time" content="2024-09-18T22:20:14+09:00"><meta property="og:site_name" content="Yosong6729 Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[자바 ORM 표준 JPA 프로그래밍 - 기본편] 객체지향 쿼리 언어1 - 기본문법"><meta name=twitter:description content='객체지향 쿼리 언어 소개 JPA는 다양한 쿼리 방법을 지원 JPQL JPA Criteria QueryDSL 네이티브 SQL JDBC API 직접 사용, MyBatis, SpringJdbcTemplate 함께 사용 JPQL 소개 가장 단순한 조회 방법 EntityManager.find() 객체 그래프 탐색(a.getB().getC()) JPQL JPA를 사용하면 엔티티 객체를 중심으로 개발 문제는 검색 쿼리 검색을 할 때도 테이블이 아닌 엔티티 객체를 대상으로 검색 모든 DB 데이터를 객체로 변환해서 검색하는 것은 불가능 애플리케이션이 필요한 데이터만 DB에서 불러오려면 결국 검색 조건이 포함된 SQL이 필요 JPA는 SQL을 추상화한 JPQL이라는 객체 지향 쿼리 언어 제공 SQL과 문법 유사, SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN 지원 JPQL은 엔티티 객체를 대상으로 쿼리 SQL은 데이터베이스 테이블을 대상으로 쿼리 //검색 String jpql = "select m From Member m where m.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yosong6729.github.io/post/"},{"@type":"ListItem","position":2,"name":"[자바 ORM 표준 JPA 프로그래밍 - 기본편] 객체지향 쿼리 언어1 - 기본문법","item":"https://yosong6729.github.io/post/%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5-%EC%BF%BC%EB%A6%AC-%EC%96%B8%EC%96%B41---%EA%B8%B0%EB%B3%B8%EB%AC%B8%EB%B2%95/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[자바 ORM 표준 JPA 프로그래밍 - 기본편] 객체지향 쿼리 언어1 - 기본문법","name":"[자바 ORM 표준 JPA 프로그래밍 - 기본편] 객체지향 쿼리 언어1 - 기본문법","description":"객체지향 쿼리 언어 소개 JPA는 다양한 쿼리 방법을 지원 JPQL JPA Criteria QueryDSL 네이티브 SQL JDBC API 직접 사용, MyBatis, SpringJdbcTemplate 함께 사용 JPQL 소개 가장 단순한 조회 방법 EntityManager.find() 객체 그래프 탐색(a.getB().getC()) JPQL JPA를 사용하면 엔티티 객체를 중심으로 개발 문제는 검색 쿼리 검색을 할 때도 테이블이 아닌 엔티티 객체를 대상으로 검색 모든 DB 데이터를 객체로 변환해서 검색하는 것은 불가능 애플리케이션이 필요한 데이터만 DB에서 불러오려면 결국 검색 조건이 포함된 SQL이 필요 JPA는 SQL을 추상화한 JPQL이라는 객체 지향 쿼리 언어 제공 SQL과 문법 유사, SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN 지원 JPQL은 엔티티 객체를 대상으로 쿼리 SQL은 데이터베이스 테이블을 대상으로 쿼리 //검색 String jpql = \u0026#34;select m From Member m where m.","keywords":["JPA"],"articleBody":"객체지향 쿼리 언어 소개 JPA는 다양한 쿼리 방법을 지원 JPQL JPA Criteria QueryDSL 네이티브 SQL JDBC API 직접 사용, MyBatis, SpringJdbcTemplate 함께 사용 JPQL 소개 가장 단순한 조회 방법 EntityManager.find() 객체 그래프 탐색(a.getB().getC()) JPQL JPA를 사용하면 엔티티 객체를 중심으로 개발 문제는 검색 쿼리 검색을 할 때도 테이블이 아닌 엔티티 객체를 대상으로 검색 모든 DB 데이터를 객체로 변환해서 검색하는 것은 불가능 애플리케이션이 필요한 데이터만 DB에서 불러오려면 결국 검색 조건이 포함된 SQL이 필요 JPA는 SQL을 추상화한 JPQL이라는 객체 지향 쿼리 언어 제공 SQL과 문법 유사, SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN 지원 JPQL은 엔티티 객체를 대상으로 쿼리 SQL은 데이터베이스 테이블을 대상으로 쿼리 //검색 String jpql = \"select m From Member m where m.name like ‘%hello%'\"; List\u003cMember\u003e result = em.createQuery(jpql, Member.class) .getResultList(); 테이블이 아닌 객체를 대상으로 검색하는 객체 지향 쿼리 SQL을 추상화해서 특정 데이터베이스 SQL에 의존X JPQL을 한마디로 정의하면 객체 지향 SQL JPQL과 실행된 SQL //검색 String jpql = \"select m from Member m where m.age \u003e 18\"; List\u003cMember\u003e result = em.createQuery(jpql, Member.class) .getResultList(); 실행된 SQL select m.id as id, m.age as age, m.USERNAME as USERNAME, m.TEAM_ID as TEAM_ID from Member m where m.age\u003e18 Criteria 소개 //Criteria 사용 준비 CriteriaBuilder cb = em.getCriteriaBuilder(); CriteriaQuery\u003cMember\u003e query = cb.createQuery(Member.class); //루트 클래스 (조회를 시작할 클래스) Root\u003cMember\u003e m = query.from(Member.class); //쿼리 생성 CriteriaQuery cq = query.select(m).where(cb.equal(m.get(\"username\"), “kim”)); List\u003cMember\u003e resultList = em.createQuery(cq).getResultList(); 문자가 아닌 자바코드로 JPQL을 작성할 수 있음 JPQL 빌더 역할 JPA 공식 기능 단점: 너무 복잡하고 실용성이 없다. Criteria 대신에 QueryDSL 사용 권장 QueryDSL 소개 //JPQL //select m from Member m where m.age \u003e 18 JPAFactoryQuery query = new JPAQueryFactory(em); QMember m = QMember.member; List\u003cMember\u003e list = query.selectFrom(m) .where(m.age.gt(18)) .orderBy(m.name.desc()) fetch(); 문자가 아닌 자바코드로 JPQL을 작성할 수 있음 JPQL 빌더 역할 컴파일 시점에 문법 오류를 찾을 수 있음 동적쿼리 작성 편리함 단순하고 쉬움 실무 사용 권장 네이티브 SQL 소개 JPA가 제공하는 SQL을 직접 사용하는 기능 JPQL로 해결할 수 없는 특정 데이터베이스에 의존적인 기능 예) 오라클 CONNECT BY, 특정 DB만 사용하는 SQL 힌트 String sql = \"SELECT ID, AGE, TEAM_ID, NAME FROM MEMBER WHERE NAME = ‘kim’\"; List\u003cMember\u003e resultList = em.createNativeQuery(sql, Member.class).getResultList(); JDBC 직접 사용, SpringJdbcTemplate 등 JPA를 사용하면서 JDBC 커넥션을 직접 사용하거나, 스프링 JdbcTemplate, 마이바티스등을 함께 사용 가능 단 영속성 컨텍스트를 적절한 시점에 강제로 플러시 필요 예) JPA를 우회해서 SQL을 실행하기 직전에 영속성 컨텍스트 수동 플러시 JPQL(Java Persistence Query Language) JPQL 소개 JPQL은 객체지향 쿼리 언어다.따라서 테이블을 대상으로 쿼리 하는 것이 아니라 엔티티 객체를 대상으로 쿼리한다. JPQL은 SQL을 추상화해서 특정데이터베이스 SQL에 의존하지 않는다. JPQL은 결국 SQL로 변환된다. JPQL 문법 select_문 :: = select_절 from_절 [where_절] [groupby_절] [having_절] [orderby_절] update_문 :: = update_절 [where_절] delete_문 :: = delete_절 [where_절] select m from Member as m where m.age \u003e 18 엔티티와 속성은 대소문자 구분O (Member, age) JPQL 키워드는 대소문자 구분X (SELECT, FROM, where) 엔티티 이름 사용, 테이블 이름이 아님(Member) 별칭은 필수(m) (as는 생략가능) 집합과 정렬 select COUNT(m), //회원수 SUM(m.age), //나이 합 AVG(m.age), //평균 나이 MAX(m.age), //최대 나이 MIN(m.age) //최소 나이 from Member m GROUP BY, HAVING, ORDER BY 모두 가능하다.\nTypeQuery, Query TypeQuery: 반환 타입이 명확할 때 사용 Query: 반환 타입이 명확하지 않을 때 사용 TypedQuery\u003cMember\u003e query = em.createQuery(\"SELECT m FROM Member m\", Member.class); //username은 String, age는 int 이기때문에 반환 타입이 명확하지 않음 Query query = em.createQuery(\"SELECT m.username, m.age from Member m\"); 결과 조회 API query.getResultList(): 결과가 하나 이상일 때, 리스트 반환 결과가 없으면 빈 리스트 반환 query.getSingleResult(): 결과가 정확히 하나, 단일 객체 반환 결과가 없으면: javax.persistence.NoResultException 둘 이상이면: javax.persistence.NonUniqueResultException 파라미터 바인딩 - 이름 기준, 위치 기준 //이름 기준 SELECT m FROM Member m where m.username=:username query.setParameter(\"username\", usernameParam); //위치 기준 SELECT m FROM Member m where m.username=?1 query.setParameter(1, usernameParam); 위치 기준은 중간에 순서를 하나 추가하게 되면 순서가 밀려서 오류가 날수 있기때문에 사용하지 않는게 좋다.\n프로젝션 SELECT 절에 조회할 대상을 지정하는 것 프로젝션 대상: 엔티티, 임베디드 타입, 스칼라 타입(숫자, 문자등 기본 데이터 타입) 엔티티 프로젝션 SELECT m FROM Member m SELECT m.team FROM Member m 임베디드 타입 프로젝션 SELECT m.address FROM Member m 스칼라 타입 프로젝션 SELECT m.username, m.age FROM Member m DISTINCT로 중복 제거 프로젝션 - 여러 값 조회 username은 String타입이고 age는 int 타입이다.\nSELECT m.username, m.age FROM Member m Query 타입으로 조회 2.Object[] 타입으로 조회 List resultList = em.createQuery(\"select m.username, m.age from Member m\") .getResultList(); Object o = resultList.get(0); Object[] result = (Oject[]) o; //result[0] -\u003e member1 //resu;t[1] -\u003e 10 List\u003cObject[]\u003e resultList = em.createQuery(\"select m.username, m.age from Member m\") .getResultList(); Object[] result = resultList.get(0); //result[0] -\u003e member1 //resu;t[1] -\u003e 10 3.new 명령어로 조회 public class MemberDTO{ private String username; private int age; ... } List\u003cMemberDTO\u003e result = resultList = em.createQuery(\"select new jpql.MemberDTO(m.username, m.age) from Member m\", MemberDTO.class) .getResultList(); MemberDTO memberDTO = result.get(0); //memberDTO.getUsername() -\u003e member1 //memberDTO.getAge() -\u003e 10 단순 값을 DTO로 바로 조회 SELECT new jpabook.jpql.UserDTO(m.username, m.age) FROM Member m 패키지 명을 포함한 전체 클래스 명 입력 순서와 타입이 일치하는 생성자 필요 페이징 API JPA는 페이징을 다음 두 API로 추상화 setFirstResult(int startPosition) : 조회 시작 위치(0부터 시작) setMaxResults(int maxResult) : 조회할 데이터 수 페이징 API 예시\n//페이징 쿼리 String jpql = \"select m from Member m order by m.name desc\"; List\u003cMember\u003e resultList = em.createQuery(jpql, Member.class) .setFirstResult(10) .setMaxResults(20) .getResultList(); MySQL 방언\nSELECT M.ID AS ID, M.AGE AS AGE, M.TEAM_ID AS TEAM_ID, M.NAME AS NAME FROM MEMBER M ORDER BY M.NAME DESC LIMIT ?, ? Oracle 방언\nSELECT * FROM ( SELECT ROW_.*, ROWNUM ROWNUM_ FROM ( SELECT M.ID AS ID, M.AGE AS AGE, M.TEAM_ID AS TEAM_ID, M.NAME AS NAME FROM MEMBER M ORDER BY M.NAME ) ROW_ WHERE ROWNUM \u003c= ? ) WHERE ROWNUM_ \u003e ? 조인 내부 조인: SELECT m FROM Member m [INNER] JOIN m.team t String query = \"select m from Member m inner join m.team t\"; //inner 생략가능 List\u003cMember\u003e result = em.createQuery(query, Member.class) .getResultList(); 외부 조인: SELECT m FROM Member m LEFT [OUTER] JOIN m.team t String query = \"select m from Member m letf outer join m.team t\"; //outer 생략가능 List\u003cMember\u003e result = em.createQuery(query, Member.class) .getResultList(); 세타 조인: select count(m) from Member m, Team t where m.username = t.name String query = \"select m from Member m, Team t where m.username = t.name\"; List\u003cMember\u003e result = em.createQuery(query, Member.class) .getResultList(); ON 절\nON절을 활용한 조인(JPA 2.1부터 지원) 조인 대상 필터링 연관관계 없는 엔티티 외부 조인(하이버네이트 5.1부터) 1. 조인 대상 필터링 예) 회원과 팀을 조인하면서, 팀 이름이 A인 팀만 조인 JPQL: SELECT m, t FROM Member m LEFT JOIN m.team t on t.name = 'A' SQL: SELECT m.*, t.* FROM Member m LEFT JOIN Team t ON m.TEAM_ID=t.id and t.name='A' 2. 연관관계 없는 엔티티 외부 조인 예) 회원의 이름과 팀의 이름이 같은 대상 외부 조인 JPQL: SELECT m, t FROM Member m LEFT JOIN Team t on m.username = t.name SQL: SELECT m.*, t.* FROM Member m LEFT JOIN Team t ON m.username = t.name 서브 쿼리 나이가 평균보다 많은 회원 select m from Member m where m.age \u003e (select avg(m2.age) from Member m2) 한 건이라도 주문한 고객 select m from Member m where (select count(o) from Order o where m = o.member) \u003e 0 서브 쿼리 지원 함수 [NOT] EXISTS (subquery): 서브쿼리에 결과가 존재하면 참 {ALL | ANY | SOME} (subquery) ALL 모두 만족하면 참 ANY, SOME: 같은 의미, 조건을 하나라도 만족하면 참 [NOT] IN (subquery): 서브쿼리의 결과 중 하나라도 같은 것이 있으면 참 예제\n팀A 소속인 회원 select m from Member m where exists (select t from m.team t where t.name = ‘팀A') 전체 상품 각각의 재고보다 주문량이 많은 주문들 select o from Order o where o.orderAmount \u003e ALL (select p.stockAmount from Product p) 어떤 팀이든 팀에 소속된 회원 select m from Member m where m.team = ANY (select t from Team t) JPA 서브 쿼리 한계 JPA는 WHERE, HAVING 절에서만 서브 쿼리 사용 가능 SELECT 절도 가능(하이버네이트에서 지원) FROM 절의 서브 쿼리는 현재 JPQL에서 불가능 조인으로 풀 수 있으면 풀어서 해결 하이버네이트6 변경 사항 하이버네이트6 부터는 FROM 절의 서브쿼리를 지원합니다. JPQL 타입 표현 문자: ‘HELLO’, ‘She’’s’ 숫자: 10L(Long), 10D(Double), 10F(Float) Boolean: TRUE, FALSE ENUM: jpabook.MemberType.Admin (패키지명 포함) 엔티티 타입: TYPE(m) = Member (상속 관계에서 사용) em.createQuery(\"select i from Item i where type(i) = Book\", Item.class) .getResultList(); JPQL 기타 SQL과 문법이 같은 식 EXISTS, IN AND, OR, NOT =, \u003e, \u003e=, \u003c, \u003c=, \u003c\u003e BETWEEN, LIKE, IS NULL 조건식 - CASE 식 기본 CASE 식\nString query = \"select \" + \"case when m.age \u003c= 10 then '학생요금' \" + \" when m.age \u003e= 60 then '경로요금' \" + \"else '일반요금' \" + \"end \" + \"from Member m\"; List\u003cString\u003e result = em.createQuery(query, String.class) .getResultList(); 단순 CASE 식\nselect case t.name when '팀A' then '인센티브110%' when '팀B' then '인센티브120%' else '인센티브105%' end from Team t COALESCE: 하나씩 조회해서 null이 아니면 반환 NULLIF: 두 값이 같으면 null 반환, 다르면 첫번째 값 반환 사용자 이름이 없으면 이름 없는 회원을 반환\nselect coalesce(m.username,'이름 없는 회원') from Member m 사용자 이름이 ‘관리자’면 null을 반환하고 나머지는 본인의 이름을반환\nselect NULLIF(m.username, '관리자') from Member m JPQL 기본 함수 CONCAT //오류나면 Un-inject Language String query = \"select 'a' || 'b' From Member m; String query = \"select concat('a', 'b') From Member m; SUBSTRING String query = \"select substring(m.username, 2, 3) From Member m; TRIM LOWER, UPPER LENGTH LOCATE ABS, SQRT, MOD SIZE, INDEX(JPA 용도) //Team의 members의 컬렉션 크기를 반환 String query = \"select size(t.members) From Team t\"; //@OrderColumn을 사용한 경우에 사용가능, 사용 비추천 String query = \"select index(t.members) From Team t\"; 사용자 정의 함수 호출 하이버네이트는 사용전 방언에 추가해야 한다. 사용하는 DB 방언을 상속받고, 사용자 정의 함수를 등록한다. public class MyH2Dialect extends H2Dialect { public MyH2Dialect(){ regusterFunction(\"group_concat\", new StandardSQLFunction(\"group_concat\", StandardBasicTypes.STRING)) } } 등록 방법은 다 외우는 것은 불가능하기 떄문에 H2Dialect를 참고해서 작성해야한다.\nselect function('group_concat', i.name) from Item i 설정 파일에도 MyH2Dialect로 바꿔줘야한다.\n","wordCount":"1563","inLanguage":"en","image":"https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-09-18T22:20:14+09:00","dateModified":"2024-09-18T22:20:14+09:00","author":{"@type":"Person","name":"yosong6729"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yosong6729.github.io/post/%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5-%EC%BF%BC%EB%A6%AC-%EC%96%B8%EC%96%B41---%EA%B8%B0%EB%B3%B8%EB%AC%B8%EB%B2%95/"},"publisher":{"@type":"Organization","name":"Yosong6729 Blog","logo":{"@type":"ImageObject","url":"https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yosong6729.github.io/ accesskey=h title="Yosong6729 블로그 (Alt + H)"><img src=https://yosong6729.github.io/apple-touch-icon.png alt aria-label=logo height=35>Yosong6729 블로그</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yosong6729.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://yosong6729.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yosong6729.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://yosong6729.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">[자바 ORM 표준 JPA 프로그래밍 - 기본편] 객체지향 쿼리 언어1 - 기본문법</h1><div class=post-meta><span title='2024-09-18 22:20:14 +0900 KST'>September 18, 2024</span>&nbsp;·&nbsp;yosong6729&nbsp;|&nbsp;<a href=https://github.com/yosong6729/blog/tree/main/content/post/%ea%b0%9d%ec%b2%b4%ec%a7%80%ed%96%a5%20%ec%bf%bc%eb%a6%ac%20%ec%96%b8%ec%96%b41%20-%20%ea%b8%b0%eb%b3%b8%eb%ac%b8%eb%b2%95/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%ea%b0%9d%ec%b2%b4%ec%a7%80%ed%96%a5-%ec%bf%bc%eb%a6%ac-%ec%96%b8%ec%96%b4-%ec%86%8c%ea%b0%9c aria-label="객체지향 쿼리 언어 소개">객체지향 쿼리 언어 소개</a><ul><li><a href=#jpa%eb%8a%94-%eb%8b%a4%ec%96%91%ed%95%9c-%ec%bf%bc%eb%a6%ac-%eb%b0%a9%eb%b2%95%ec%9d%84-%ec%a7%80%ec%9b%90 aria-label="JPA는 다양한 쿼리 방법을 지원">JPA는 다양한 쿼리 방법을 지원</a></li><li><a href=#jpql-%ec%86%8c%ea%b0%9c aria-label="JPQL 소개">JPQL 소개</a></li><li><a href=#jpql aria-label=JPQL>JPQL</a></li><li><a href=#jpql%ea%b3%bc-%ec%8b%a4%ed%96%89%eb%90%9c-sql aria-label="JPQL과 실행된 SQL">JPQL과 실행된 SQL</a></li><li><a href=#criteria-%ec%86%8c%ea%b0%9c aria-label="Criteria 소개">Criteria 소개</a></li><li><a href=#querydsl-%ec%86%8c%ea%b0%9c aria-label="QueryDSL 소개">QueryDSL 소개</a></li><li><a href=#%eb%84%a4%ec%9d%b4%ed%8b%b0%eb%b8%8c-sql-%ec%86%8c%ea%b0%9c aria-label="네이티브 SQL 소개">네이티브 SQL 소개</a></li><li><a href=#jdbc-%ec%a7%81%ec%a0%91-%ec%82%ac%ec%9a%a9-springjdbctemplate-%eb%93%b1 aria-label="JDBC 직접 사용, SpringJdbcTemplate 등">JDBC 직접 사용, SpringJdbcTemplate 등</a></li></ul></li><li><a href=#jpqljava-persistence-query-language aria-label="JPQL(Java Persistence Query Language)">JPQL(Java Persistence Query Language)</a><ul><li><a href=#jpql-%ec%86%8c%ea%b0%9c-1 aria-label="JPQL 소개">JPQL 소개</a></li><li><a href=#jpql-%eb%ac%b8%eb%b2%95 aria-label="JPQL 문법">JPQL 문법</a></li><li><a href=#%ec%a7%91%ed%95%a9%ea%b3%bc-%ec%a0%95%eb%a0%ac aria-label="집합과 정렬">집합과 정렬</a></li><li><a href=#typequery-query aria-label="TypeQuery, Query">TypeQuery, Query</a></li><li><a href=#%ea%b2%b0%ea%b3%bc-%ec%a1%b0%ed%9a%8c-api aria-label="결과 조회 API">결과 조회 API</a></li><li><a href=#%ed%8c%8c%eb%9d%bc%eb%af%b8%ed%84%b0-%eb%b0%94%ec%9d%b8%eb%94%a9---%ec%9d%b4%eb%a6%84-%ea%b8%b0%ec%a4%80-%ec%9c%84%ec%b9%98-%ea%b8%b0%ec%a4%80 aria-label="파라미터 바인딩 - 이름 기준, 위치 기준">파라미터 바인딩 - 이름 기준, 위치 기준</a></li><li><a href=#%ed%94%84%eb%a1%9c%ec%a0%9d%ec%85%98 aria-label=프로젝션>프로젝션</a></li><li><a href=#%ed%94%84%eb%a1%9c%ec%a0%9d%ec%85%98---%ec%97%ac%eb%9f%ac-%ea%b0%92-%ec%a1%b0%ed%9a%8c aria-label="프로젝션 - 여러 값 조회">프로젝션 - 여러 값 조회</a></li><li><a href=#%ed%8e%98%ec%9d%b4%ec%a7%95-api aria-label="페이징 API">페이징 API</a></li><li><a href=#%ec%a1%b0%ec%9d%b8 aria-label=조인>조인</a></li><li><a href=#1-%ec%a1%b0%ec%9d%b8-%eb%8c%80%ec%83%81-%ed%95%84%ed%84%b0%eb%a7%81 aria-label="1. 조인 대상 필터링">1. 조인 대상 필터링</a></li><li><a href=#2-%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84-%ec%97%86%eb%8a%94-%ec%97%94%ed%8b%b0%ed%8b%b0-%ec%99%b8%eb%b6%80-%ec%a1%b0%ec%9d%b8 aria-label="2. 연관관계 없는 엔티티 외부 조인">2. 연관관계 없는 엔티티 외부 조인</a></li><li><a href=#%ec%84%9c%eb%b8%8c-%ec%bf%bc%eb%a6%ac aria-label="서브 쿼리">서브 쿼리</a></li><li><a href=#%ec%84%9c%eb%b8%8c-%ec%bf%bc%eb%a6%ac-%ec%a7%80%ec%9b%90-%ed%95%a8%ec%88%98 aria-label="서브 쿼리 지원 함수">서브 쿼리 지원 함수</a></li><li><a href=#jpa-%ec%84%9c%eb%b8%8c-%ec%bf%bc%eb%a6%ac-%ed%95%9c%ea%b3%84 aria-label="JPA 서브 쿼리 한계">JPA 서브 쿼리 한계</a></li><li><a href=#%ed%95%98%ec%9d%b4%eb%b2%84%eb%84%a4%ec%9d%b4%ed%8a%b86-%eb%b3%80%ea%b2%bd-%ec%82%ac%ed%95%ad aria-label="하이버네이트6 변경 사항">하이버네이트6 변경 사항</a></li><li><a href=#jpql-%ed%83%80%ec%9e%85-%ed%91%9c%ed%98%84 aria-label="JPQL 타입 표현">JPQL 타입 표현</a></li><li><a href=#jpql-%ea%b8%b0%ed%83%80 aria-label="JPQL 기타">JPQL 기타</a></li><li><a href=#%ec%a1%b0%ea%b1%b4%ec%8b%9d---case-%ec%8b%9d aria-label="조건식 - CASE 식">조건식 - CASE 식</a></li><li><a href=#jpql-%ea%b8%b0%eb%b3%b8-%ed%95%a8%ec%88%98 aria-label="JPQL 기본 함수">JPQL 기본 함수</a></li><li><a href=#%ec%82%ac%ec%9a%a9%ec%9e%90-%ec%a0%95%ec%9d%98-%ed%95%a8%ec%88%98-%ed%98%b8%ec%b6%9c aria-label="사용자 정의 함수 호출">사용자 정의 함수 호출</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=객체지향-쿼리-언어-소개>객체지향 쿼리 언어 소개<a hidden class=anchor aria-hidden=true href=#객체지향-쿼리-언어-소개>#</a></h2><h3 id=jpa는-다양한-쿼리-방법을-지원>JPA는 다양한 쿼리 방법을 지원<a hidden class=anchor aria-hidden=true href=#jpa는-다양한-쿼리-방법을-지원>#</a></h3><ul><li><strong>JPQL</strong></li><li>JPA Criteria</li><li><strong>QueryDSL</strong></li><li>네이티브 SQL</li><li>JDBC API 직접 사용, MyBatis, SpringJdbcTemplate 함께
사용</li></ul><h3 id=jpql-소개>JPQL 소개<a hidden class=anchor aria-hidden=true href=#jpql-소개>#</a></h3><ul><li>가장 단순한 조회 방법<ul><li>EntityManager.find()</li><li>객체 그래프 탐색(a.getB().getC())</li></ul></li></ul><h3 id=jpql>JPQL<a hidden class=anchor aria-hidden=true href=#jpql>#</a></h3><ul><li>JPA를 사용하면 엔티티 객체를 중심으로 개발</li><li>문제는 검색 쿼리</li><li>검색을 할 때도 테이블이 아닌 엔티티 객체를 대상으로 검색</li><li>모든 DB 데이터를 객체로 변환해서 검색하는 것은 불가능</li><li>애플리케이션이 필요한 데이터만 DB에서 불러오려면 결국 검색 조건이 포함된 SQL이 필요</li><li>JPA는 SQL을 추상화한 <strong>JPQL이라는 객체 지향 쿼리 언어 제공</strong></li><li>SQL과 문법 유사, SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN 지원</li><li>JPQL은 엔티티 객체를 대상으로 쿼리</li><li>SQL은 데이터베이스 테이블을 대상으로 쿼리</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//검색 </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>jpql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select m From Member m where m.name like ‘%hello%&#39;&#34;</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>jpql</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><ul><li>테이블이 아닌 객체를 대상으로 검색하는 객체 지향 쿼리</li><li>SQL을 추상화해서 특정 데이터베이스 SQL에 의존X</li><li>JPQL을 한마디로 정의하면 <strong>객체 지향 SQL</strong></li></ul><h3 id=jpql과-실행된-sql>JPQL과 실행된 SQL<a hidden class=anchor aria-hidden=true href=#jpql과-실행된-sql>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//검색 </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>String</span><span class=w> </span><span class=n>jpql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select m from Member m where m.age &gt; 18&#34;</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>jpql</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=err>실행된</span><span class=w> </span><span class=k>SQL</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>select</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>m</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>m</span><span class=p>.</span><span class=n>age</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>m</span><span class=p>.</span><span class=n>USERNAME</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>USERNAME</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>m</span><span class=p>.</span><span class=n>TEAM_ID</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>TEAM_ID</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>from</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>where</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>m</span><span class=p>.</span><span class=n>age</span><span class=o>&gt;</span><span class=mi>18</span><span class=w>
</span></span></span></code></pre></div><h3 id=criteria-소개>Criteria 소개<a hidden class=anchor aria-hidden=true href=#criteria-소개>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//Criteria 사용 준비 </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>CriteriaBuilder</span><span class=w> </span><span class=n>cb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>getCriteriaBuilder</span><span class=p>();</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>CriteriaQuery</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cb</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//루트 클래스 (조회를 시작할 클래스) </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Root</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>query</span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//쿼리 생성 CriteriaQuery&lt;Member&gt; cq =  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>query</span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=n>m</span><span class=p>).</span><span class=na>where</span><span class=p>(</span><span class=n>cb</span><span class=p>.</span><span class=na>equal</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>),</span><span class=w> </span><span class=err>“</span><span class=n>kim</span><span class=err>”</span><span class=p>));</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>resultList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>cq</span><span class=p>).</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><ul><li>문자가 아닌 자바코드로 JPQL을 작성할 수 있음</li><li>JPQL 빌더 역할</li><li>JPA 공식 기능</li><li><strong>단점: 너무 복잡하고 실용성이 없다.</strong></li><li>Criteria 대신에 <strong>QueryDSL 사용 권장</strong></li></ul><h3 id=querydsl-소개>QueryDSL 소개<a hidden class=anchor aria-hidden=true href=#querydsl-소개>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//JPQL </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//select m from Member m where m.age &gt; 18</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>JPAFactoryQuery</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JPAQueryFactory</span><span class=p>(</span><span class=n>em</span><span class=p>);</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>QMember</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>QMember</span><span class=p>.</span><span class=na>member</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>query</span><span class=p>.</span><span class=na>selectFrom</span><span class=p>(</span><span class=n>m</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>age</span><span class=p>.</span><span class=na>gt</span><span class=p>(</span><span class=n>18</span><span class=p>))</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>orderBy</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>name</span><span class=p>.</span><span class=na>desc</span><span class=p>())</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=n>fetch</span><span class=p>();</span><span class=w> 
</span></span></span></code></pre></div><ul><li>문자가 아닌 자바코드로 JPQL을 작성할 수 있음</li><li>JPQL 빌더 역할</li><li>컴파일 시점에 문법 오류를 찾을 수 있음</li><li>동적쿼리 작성 편리함</li><li>단순하고 쉬움</li><li><strong>실무 사용 권장</strong></li></ul><h3 id=네이티브-sql-소개>네이티브 SQL 소개<a hidden class=anchor aria-hidden=true href=#네이티브-sql-소개>#</a></h3><ul><li>JPA가 제공하는 SQL을 직접 사용하는 기능</li><li>JPQL로 해결할 수 없는 특정 데이터베이스에 의존적인 기능</li><li>예) 오라클 CONNECT BY, 특정 DB만 사용하는 SQL 힌트</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;SELECT ID, AGE, TEAM_ID, NAME FROM MEMBER WHERE NAME = ‘kim’&#34;</span><span class=p>;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>resultList</span><span class=w> </span><span class=o>=</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>em</span><span class=p>.</span><span class=na>createNativeQuery</span><span class=p>(</span><span class=n>sql</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><h3 id=jdbc-직접-사용-springjdbctemplate-등>JDBC 직접 사용, SpringJdbcTemplate 등<a hidden class=anchor aria-hidden=true href=#jdbc-직접-사용-springjdbctemplate-등>#</a></h3><ul><li>JPA를 사용하면서 JDBC 커넥션을 직접 사용하거나, 스프링 JdbcTemplate, 마이바티스등을 함께 사용 가능</li><li>단 <strong>영속성 컨텍스트를 적절한 시점에 강제로 플러시</strong> 필요</li><li>예) JPA를 우회해서 SQL을 실행하기 직전에 영속성 컨텍스트 수동 플러시</li></ul><hr><h2 id=jpqljava-persistence-query-language>JPQL(Java Persistence Query Language)<a hidden class=anchor aria-hidden=true href=#jpqljava-persistence-query-language>#</a></h2><h3 id=jpql-소개-1>JPQL 소개<a hidden class=anchor aria-hidden=true href=#jpql-소개-1>#</a></h3><ul><li>JPQL은 객체지향 쿼리 언어다.따라서 테이블을 대상으로 쿼리 하는 것이 아니라 엔티티 객체를 대상으로 쿼리한다.</li><li>JPQL은 SQL을 추상화해서 특정데이터베이스 SQL에 의존하지 않는다.</li><li>JPQL은 결국 SQL로 변환된다.</li></ul><p><img loading=lazy src=images/image.png alt=image.png></p><h3 id=jpql-문법>JPQL 문법<a hidden class=anchor aria-hidden=true href=#jpql-문법>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>select_문</span><span class=w> </span><span class=p>::</span><span class=w> </span><span class=o>=</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>select_절</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>from_절</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=n>where_절</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=n>groupby_절</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=n>having_절</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=n>orderby_절</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>update_문</span><span class=w> </span><span class=p>::</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>update_절</span><span class=w> </span><span class=p>[</span><span class=n>where_절</span><span class=p>]</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>delete_문</span><span class=w> </span><span class=p>::</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>delete_절</span><span class=w> </span><span class=p>[</span><span class=n>where_절</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><ul><li>select m from <strong>Member</strong> as m where <strong>m.age</strong> > 18</li><li>엔티티와 속성은 대소문자 구분O (Member, age)</li><li>JPQL 키워드는 대소문자 구분X (SELECT, FROM, where)</li><li>엔티티 이름 사용, 테이블 이름이 아님(Member)</li><li><strong>별칭은 필수(m)</strong> (as는 생략가능)</li></ul><h3 id=집합과-정렬>집합과 정렬<a hidden class=anchor aria-hidden=true href=#집합과-정렬>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>COUNT</span><span class=p>(</span><span class=n>m</span><span class=p>),</span><span class=w>   </span><span class=o>//</span><span class=err>회원수</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=n>age</span><span class=p>),</span><span class=w> </span><span class=o>//</span><span class=err>나이</span><span class=w> </span><span class=err>합</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>AVG</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=n>age</span><span class=p>),</span><span class=w> </span><span class=o>//</span><span class=err>평균</span><span class=w> </span><span class=err>나이</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>MAX</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=n>age</span><span class=p>),</span><span class=w> </span><span class=o>//</span><span class=err>최대</span><span class=w> </span><span class=err>나이</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>MIN</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=n>age</span><span class=p>)</span><span class=w>  </span><span class=o>//</span><span class=err>최소</span><span class=w> </span><span class=err>나이</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w>
</span></span></span></code></pre></div><p>GROUP BY, HAVING, ORDER BY 모두 가능하다.</p><h3 id=typequery-query>TypeQuery, Query<a hidden class=anchor aria-hidden=true href=#typequery-query>#</a></h3><ul><li>TypeQuery: 반환 타입이 명확할 때 사용</li><li>Query: 반환 타입이 명확하지 않을 때 사용</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>TypedQuery</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;SELECT m FROM Member m&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//username은 String, age는 int 이기때문에 반환 타입이 명확하지 않음</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;SELECT m.username, m.age from Member m&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h3 id=결과-조회-api>결과 조회 API<a hidden class=anchor aria-hidden=true href=#결과-조회-api>#</a></h3><ul><li>query.getResultList(): <strong>결과가 하나 이상</strong>일 때, 리스트 반환<ul><li>결과가 없으면 빈 리스트 반환</li></ul></li><li>query.getSingleResult(): <strong>결과가 정확히 하나</strong>, 단일 객체 반환<ul><li>결과가 없으면: javax.persistence.NoResultException</li><li>둘 이상이면: javax.persistence.NonUniqueResultException</li></ul></li></ul><h3 id=파라미터-바인딩---이름-기준-위치-기준>파라미터 바인딩 - 이름 기준, 위치 기준<a hidden class=anchor aria-hidden=true href=#파라미터-바인딩---이름-기준-위치-기준>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//이름 기준</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>SELECT</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=n>FROM</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=n>where</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=na>username</span><span class=o>=</span><span class=p>:</span><span class=n>username</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>query</span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>usernameParam</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//위치 기준</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>SELECT</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=n>FROM</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=n>where</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=na>username</span><span class=o>=?</span><span class=n>1</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>query</span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>usernameParam</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>위치 기준은 중간에 순서를 하나 추가하게 되면 순서가 밀려서 오류가 날수 있기때문에 사용하지 않는게 좋다.</p><h3 id=프로젝션>프로젝션<a hidden class=anchor aria-hidden=true href=#프로젝션>#</a></h3><ul><li>SELECT 절에 조회할 대상을 지정하는 것</li><li>프로젝션 대상: 엔티티, 임베디드 타입, 스칼라 타입(숫자, 문자등 기본 데이터 타입)</li></ul><blockquote><p><details><summary markdown=span><strong>엔티티</strong> 프로젝션</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>team</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w>
</span></span></span></code></pre></div></details></p></blockquote><blockquote><p><details><summary markdown=span><strong>임베디드</strong> <strong>타입</strong> 프로젝션</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>address</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w>
</span></span></span></code></pre></div></details></p></blockquote><blockquote><p><details><summary markdown=span><strong>스칼라</strong> <strong>타입</strong> 프로젝션</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>age</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w>
</span></span></span></code></pre></div></details></p></blockquote><ul><li>DISTINCT로 중복 제거</li></ul><h3 id=프로젝션---여러-값-조회>프로젝션 - 여러 값 조회<a hidden class=anchor aria-hidden=true href=#프로젝션---여러-값-조회>#</a></h3><p>username은 String타입이고 age는 int 타입이다.</p><ul><li>SELECT <strong>m.username, m.age</strong> FROM Member m</li><li><ol><li>Query 타입으로 조회</li></ol></li></ul><blockquote><p><details><summary markdown=span>2.Object[] 타입으로 조회</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=w> </span><span class=n>resultList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;select m.username, m.age from Member m&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Object</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>resultList</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Oject</span><span class=o>[]</span><span class=p>)</span><span class=w> </span><span class=n>o</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//result[0] -&gt; member1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//resu;t[1] -&gt; 10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>[]&gt;</span><span class=w> </span><span class=n>resultList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;select m.username, m.age from Member m&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>resultList</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//result[0] -&gt; member1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//resu;t[1] -&gt; 10</span><span class=w>
</span></span></span></code></pre></div></details></p></blockquote><blockquote><p><details><summary markdown=span>3.new 명령어로 조회</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberDTO</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberDTO</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>resultList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;select new jpql.MemberDTO(m.username, m.age) from Member m&#34;</span><span class=p>,</span><span class=w> </span><span class=n>MemberDTO</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MemberDTO</span><span class=w> </span><span class=n>memberDTO</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>result</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//memberDTO.getUsername() -&gt; member1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//memberDTO.getAge() -&gt; 10</span><span class=w>
</span></span></span></code></pre></div><ul><li>단순 값을 DTO로 바로 조회
SELECT <strong>new</strong> jpabook.jpql.UserDTO(m.username, m.age) FROM
Member m</li><li>패키지 명을 포함한 전체 클래스 명 입력</li><li>순서와 타입이 일치하는 생성자 필요</li></ul></details></p></blockquote><h3 id=페이징-api>페이징 API<a hidden class=anchor aria-hidden=true href=#페이징-api>#</a></h3><ul><li>JPA는 페이징을 다음 두 API로 추상화</li><li><strong>setFirstResult</strong>(int startPosition) : 조회 시작 위치(0부터 시작)</li><li><strong>setMaxResults</strong>(int maxResult) : 조회할 데이터 수</li></ul><p><strong>페이징 API 예시</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//페이징 쿼리 </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>jpql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select m from Member m order by m.name desc&#34;</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>resultList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>jpql</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>.</span><span class=na>setFirstResult</span><span class=p>(</span><span class=n>10</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>.</span><span class=na>setMaxResults</span><span class=p>(</span><span class=n>20</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p><strong>MySQL 방언</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>M</span><span class=p>.</span><span class=n>ID</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>ID</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>M</span><span class=p>.</span><span class=n>AGE</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>AGE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>M</span><span class=p>.</span><span class=n>TEAM_ID</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>TEAM_ID</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>M</span><span class=p>.</span><span class=n>NAME</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>NAME</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MEMBER</span><span class=w> </span><span class=n>M</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>M</span><span class=p>.</span><span class=n>NAME</span><span class=w> </span><span class=k>DESC</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=o>?</span><span class=p>,</span><span class=w> </span><span class=o>?</span><span class=w>
</span></span></span></code></pre></div><p><strong>Oracle 방언</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>(</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>ROW_</span><span class=p>.</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>ROWNUM</span><span class=w> </span><span class=n>ROWNUM_</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=w> </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>M</span><span class=p>.</span><span class=n>ID</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>ID</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>M</span><span class=p>.</span><span class=n>AGE</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>AGE</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>M</span><span class=p>.</span><span class=n>TEAM_ID</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>TEAM_ID</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>M</span><span class=p>.</span><span class=n>NAME</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>NAME</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>FROM</span><span class=w> </span><span class=n>MEMBER</span><span class=w> </span><span class=n>M</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>M</span><span class=p>.</span><span class=n>NAME</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w> </span><span class=n>ROW_</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>ROWNUM</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>ROWNUM_</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=o>?</span><span class=w>
</span></span></span></code></pre></div><h3 id=조인>조인<a hidden class=anchor aria-hidden=true href=#조인>#</a></h3><ul><li>내부 조인:
SELECT m FROM Member m [INNER] JOIN m.team t</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select m from Member m inner join m.team t&#34;</span><span class=p>;</span><span class=w> </span><span class=c1>//inner 생략가능</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>query</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><ul><li>외부 조인:
SELECT m FROM Member m LEFT [OUTER] JOIN m.team t</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select m from Member m letf outer join m.team t&#34;</span><span class=p>;</span><span class=w> </span><span class=c1>//outer 생략가능</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>query</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><ul><li>세타 조인:
select count(m) from Member m, Team t where m.username = t.name</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select m from Member m, Team t where m.username = t.name&#34;</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>query</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p><strong>ON 절</strong></p><ul><li>ON절을 활용한 조인(JPA 2.1부터 지원)<ul><li><ol><li>조인 대상 필터링</li></ol></li><li><ol start=2><li>연관관계 없는 엔티티 외부 조인(하이버네이트 5.1부터)</li></ol></li></ul></li></ul><h3 id=1-조인-대상-필터링>1. 조인 대상 필터링<a hidden class=anchor aria-hidden=true href=#1-조인-대상-필터링>#</a></h3><ul><li>예) 회원과 팀을 조인하면서, 팀 이름이 A인 팀만 조인</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>JPQL</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>m</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>FROM</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>team</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;A&#39;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SQL</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>Team</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>TEAM_ID</span><span class=o>=</span><span class=n>t</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>name</span><span class=o>=</span><span class=s1>&#39;A&#39;</span><span class=w>
</span></span></span></code></pre></div><h3 id=2-연관관계-없는-엔티티-외부-조인>2. 연관관계 없는 엔티티 외부 조인<a hidden class=anchor aria-hidden=true href=#2-연관관계-없는-엔티티-외부-조인>#</a></h3><ul><li>예) 회원의 이름과 팀의 이름이 같은 대상 외부 조인</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>JPQL</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>m</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>FROM</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>Team</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>name</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SQL</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>Team</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>name</span><span class=w>
</span></span></span></code></pre></div><h3 id=서브-쿼리>서브 쿼리<a hidden class=anchor aria-hidden=true href=#서브-쿼리>#</a></h3><ul><li>나이가 평균보다 많은 회원</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>age</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>avg</span><span class=p>(</span><span class=n>m2</span><span class=p>.</span><span class=n>age</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m2</span><span class=p>)</span><span class=w> 
</span></span></span></code></pre></div><ul><li>한 건이라도 주문한 고객</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>o</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>Order</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>member</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span></code></pre></div><h3 id=서브-쿼리-지원-함수>서브 쿼리 지원 함수<a hidden class=anchor aria-hidden=true href=#서브-쿼리-지원-함수>#</a></h3><ul><li>[NOT] EXISTS (subquery): 서브쿼리에 결과가 존재하면 참<ul><li>{ALL | ANY | SOME} (subquery)</li><li>ALL 모두 만족하면 참</li><li>ANY, SOME: 같은 의미, 조건을 하나라도 만족하면 참</li></ul></li><li>[NOT] IN (subquery): 서브쿼리의 결과 중 하나라도 같은 것이 있으면 참</li></ul><p><strong>예제</strong></p><ul><li>팀A 소속인 회원</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>team</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>‘팀</span><span class=n>A</span><span class=s1>&#39;)
</span></span></span></code></pre></div><ul><li>전체 상품 각각의 재고보다 주문량이 많은 주문들</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>Order</span><span class=w> </span><span class=n>o</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>orderAmount</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=k>ALL</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>stockAmount</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=n>p</span><span class=p>)</span><span class=w> 
</span></span></span></code></pre></div><ul><li>어떤 팀이든 팀에 소속된 회원</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>team</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>ANY</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Team</span><span class=w> </span><span class=n>t</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h3 id=jpa-서브-쿼리-한계>JPA 서브 쿼리 한계<a hidden class=anchor aria-hidden=true href=#jpa-서브-쿼리-한계>#</a></h3><ul><li>JPA는 WHERE, HAVING 절에서만 서브 쿼리 사용 가능</li><li>SELECT 절도 가능(하이버네이트에서 지원)</li><li><strong>FROM 절의 서브 쿼리는 현재 JPQL에서 불가능</strong><ul><li><strong>조인으로 풀 수 있으면 풀어서 해결</strong></li></ul></li></ul><h3 id=하이버네이트6-변경-사항>하이버네이트6 변경 사항<a hidden class=anchor aria-hidden=true href=#하이버네이트6-변경-사항>#</a></h3><ul><li>하이버네이트6 부터는 FROM 절의 서브쿼리를 지원합니다.</li></ul><h3 id=jpql-타입-표현>JPQL 타입 표현<a hidden class=anchor aria-hidden=true href=#jpql-타입-표현>#</a></h3><ul><li>문자: ‘HELLO’, ‘She’’s’</li><li>숫자: 10L(Long), 10D(Double), 10F(Float)</li><li>Boolean: TRUE, FALSE</li><li>ENUM: jpabook.MemberType.Admin (패키지명 포함)</li><li>엔티티 타입: TYPE(m) = Member (상속 관계에서 사용)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;select i from Item i where type(i) = Book&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Item</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><h3 id=jpql-기타>JPQL 기타<a hidden class=anchor aria-hidden=true href=#jpql-기타>#</a></h3><ul><li>SQL과 문법이 같은 식</li><li>EXISTS, IN</li><li>AND, OR, NOT</li><li>=, >, >=, &lt;, &lt;=, &lt;></li><li>BETWEEN, LIKE, <strong>IS NULL</strong></li></ul><h3 id=조건식---case-식>조건식 - CASE 식<a hidden class=anchor aria-hidden=true href=#조건식---case-식>#</a></h3><p>기본 CASE 식</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;select &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;case when m.age &lt;= 10 then &#39;학생요금&#39; &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=s>&#34;     when m.age &gt;= 60 then &#39;경로요금&#39; &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;else &#39;일반요금&#39; &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=s>&#34;end &#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;from Member m&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>query</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>단순 CASE 식</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>name</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>when</span><span class=w> </span><span class=s1>&#39;팀A&#39;</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=s1>&#39;인센티브110%&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>when</span><span class=w> </span><span class=s1>&#39;팀B&#39;</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=s1>&#39;인센티브120%&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=s1>&#39;인센티브105%&#39;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>end</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>Team</span><span class=w> </span><span class=n>t</span><span class=w>
</span></span></span></code></pre></div><ul><li>COALESCE: 하나씩 조회해서 null이 아니면 반환</li><li>NULLIF: 두 값이 같으면 null 반환, 다르면 첫번째 값 반환</li></ul><p>사용자 이름이 없으면 이름 없는 회원을 반환</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>coalesce</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=n>username</span><span class=p>,</span><span class=s1>&#39;이름 없는 회원&#39;</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w>
</span></span></span></code></pre></div><p>사용자 이름이 ‘관리자’면 null을 반환하고 나머지는 본인의 이름을반환</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>NULLIF</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;관리자&#39;</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w>
</span></span></span></code></pre></div><h3 id=jpql-기본-함수>JPQL 기본 함수<a hidden class=anchor aria-hidden=true href=#jpql-기본-함수>#</a></h3><ul><li>CONCAT</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//오류나면 Un-inject Language</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select &#39;a&#39; || &#39;b&#39; From Member m;
</span></span></span><span class=line><span class=cl><span class=s>String query = &#34;</span><span class=n>select</span><span class=w> </span><span class=nf>concat</span><span class=p>(</span><span class=sc>&#39;a&#39;</span><span class=p>,</span><span class=w> </span><span class=sc>&#39;b&#39;</span><span class=p>)</span><span class=w> </span><span class=n>From</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><ul><li>SUBSTRING</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select substring(m.username, 2, 3) From Member m;
</span></span></span></code></pre></div><ul><li>TRIM</li><li>LOWER, UPPER</li><li>LENGTH</li><li>LOCATE</li><li>ABS, SQRT, MOD</li><li>SIZE, INDEX(JPA 용도)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//Team의 members의 컬렉션 크기를 반환</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select size(t.members) From Team t&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//@OrderColumn을 사용한 경우에 사용가능, 사용 비추천</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select index(t.members) From Team t&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=사용자-정의-함수-호출>사용자 정의 함수 호출<a hidden class=anchor aria-hidden=true href=#사용자-정의-함수-호출>#</a></h3><ul><li>하이버네이트는 사용전 방언에 추가해야 한다.<ul><li>사용하는 DB 방언을 상속받고, 사용자 정의 함수를 등록한다.</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MyH2Dialect</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>H2Dialect</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>MyH2Dialect</span><span class=p>(){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>regusterFunction</span><span class=p>(</span><span class=s>&#34;group_concat&#34;</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StandardSQLFunction</span><span class=p>(</span><span class=s>&#34;group_concat&#34;</span><span class=p>,</span><span class=w> </span><span class=n>StandardBasicTypes</span><span class=p>.</span><span class=na>STRING</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>등록 방법은 다 외우는 것은 불가능하기 떄문에 H2Dialect를 참고해서 작성해야한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>function</span><span class=p>(</span><span class=s1>&#39;group_concat&#39;</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Item</span><span class=w> </span><span class=n>i</span><span class=w>
</span></span></span></code></pre></div><p>설정 파일에도 MyH2Dialect로 바꿔줘야한다.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://yosong6729.github.io/tags/jpa/>JPA</a></li></ul><nav class=paginav><a class=prev href=https://yosong6729.github.io/post/%EA%B0%9D%EC%B2%B4%EC%A7%80%ED%96%A5-%EC%BF%BC%EB%A6%AC-%EC%96%B8%EC%96%B42---%EC%A4%91%EA%B8%89%EB%AC%B8%EB%B2%95/><span class=title>« Prev</span><br><span>[자바 ORM 표준 JPA 프로그래밍 - 기본편] 객체지향 쿼리 언어2 - 중급문법</span>
</a><a class=next href=https://yosong6729.github.io/post/%EA%B0%92-%ED%83%80%EC%9E%85/><span class=title>Next »</span><br><span>[자바 ORM 표준 JPA 프로그래밍 - 기본편] 값 타입</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://yosong6729.github.io/>Yosong6729 Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>