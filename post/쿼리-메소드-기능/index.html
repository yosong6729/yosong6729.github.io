<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>쿼리 메소드 기능 | Yosong6729 Blog</title>
<meta name=keywords content="spring data JPA"><meta name=description content="해당 글은 김영한님의 인프런 강의 스프링부트와 JPA활용2 - API 개발과 성능 최적화을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
쿼리 메소드 기능 3가지
메소드 이름으로 쿼리 생성 메소드 이름으로 JPA NamedQuery 호출 @Query 어노테이션을 사용해서 리포지토리 인터페이스 쿼리 직접 정의 메소드 이름으로 쿼리 생성 메소드 이름을 분석해서 JPQL 쿼리를 실행한다.
이름과 나이를 기준으로 회원을 조회하는 상황이다.
순수 JPA 리포지토리
public List<Member> findByUsernameAndAgeGreaterThen(String username, int age) { return em."><meta name=author content="yosong6729"><link rel=canonical href=https://yosong6729.github.io/post/%EC%BF%BC%EB%A6%AC-%EB%A9%94%EC%86%8C%EB%93%9C-%EA%B8%B0%EB%8A%A5/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://yosong6729.github.io/post/%EC%BF%BC%EB%A6%AC-%EB%A9%94%EC%86%8C%EB%93%9C-%EA%B8%B0%EB%8A%A5/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="쿼리 메소드 기능"><meta property="og:description" content="해당 글은 김영한님의 인프런 강의 스프링부트와 JPA활용2 - API 개발과 성능 최적화을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
쿼리 메소드 기능 3가지
메소드 이름으로 쿼리 생성 메소드 이름으로 JPA NamedQuery 호출 @Query 어노테이션을 사용해서 리포지토리 인터페이스 쿼리 직접 정의 메소드 이름으로 쿼리 생성 메소드 이름을 분석해서 JPQL 쿼리를 실행한다.
이름과 나이를 기준으로 회원을 조회하는 상황이다.
순수 JPA 리포지토리
public List<Member> findByUsernameAndAgeGreaterThen(String username, int age) { return em."><meta property="og:type" content="article"><meta property="og:url" content="https://yosong6729.github.io/post/%EC%BF%BC%EB%A6%AC-%EB%A9%94%EC%86%8C%EB%93%9C-%EA%B8%B0%EB%8A%A5/"><meta property="og:image" content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-09-30T22:22:10+09:00"><meta property="article:modified_time" content="2024-09-30T22:22:10+09:00"><meta property="og:site_name" content="Yosong6729 Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="쿼리 메소드 기능"><meta name=twitter:description content="해당 글은 김영한님의 인프런 강의 스프링부트와 JPA활용2 - API 개발과 성능 최적화을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
쿼리 메소드 기능 3가지
메소드 이름으로 쿼리 생성 메소드 이름으로 JPA NamedQuery 호출 @Query 어노테이션을 사용해서 리포지토리 인터페이스 쿼리 직접 정의 메소드 이름으로 쿼리 생성 메소드 이름을 분석해서 JPQL 쿼리를 실행한다.
이름과 나이를 기준으로 회원을 조회하는 상황이다.
순수 JPA 리포지토리
public List<Member> findByUsernameAndAgeGreaterThen(String username, int age) { return em."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yosong6729.github.io/post/"},{"@type":"ListItem","position":2,"name":"쿼리 메소드 기능","item":"https://yosong6729.github.io/post/%EC%BF%BC%EB%A6%AC-%EB%A9%94%EC%86%8C%EB%93%9C-%EA%B8%B0%EB%8A%A5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"쿼리 메소드 기능","name":"쿼리 메소드 기능","description":"해당 글은 김영한님의 인프런 강의 스프링부트와 JPA활용2 - API 개발과 성능 최적화을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n쿼리 메소드 기능 3가지\n메소드 이름으로 쿼리 생성 메소드 이름으로 JPA NamedQuery 호출 @Query 어노테이션을 사용해서 리포지토리 인터페이스 쿼리 직접 정의 메소드 이름으로 쿼리 생성 메소드 이름을 분석해서 JPQL 쿼리를 실행한다.\n이름과 나이를 기준으로 회원을 조회하는 상황이다.\n순수 JPA 리포지토리\npublic List\u0026lt;Member\u0026gt; findByUsernameAndAgeGreaterThen(String username, int age) { return em.","keywords":["spring data JPA"],"articleBody":" 해당 글은 김영한님의 인프런 강의 스프링부트와 JPA활용2 - API 개발과 성능 최적화을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n쿼리 메소드 기능 3가지\n메소드 이름으로 쿼리 생성 메소드 이름으로 JPA NamedQuery 호출 @Query 어노테이션을 사용해서 리포지토리 인터페이스 쿼리 직접 정의 메소드 이름으로 쿼리 생성 메소드 이름을 분석해서 JPQL 쿼리를 실행한다.\n이름과 나이를 기준으로 회원을 조회하는 상황이다.\n순수 JPA 리포지토리\npublic List\u003cMember\u003e findByUsernameAndAgeGreaterThen(String username, int age) { return em.createQuery(\"select m from Member m where m.username = :username and m.age \u003e :age\", Member.class) .setParameter(\"username\", username) .setParameter(\"age\", age) .getResultList(); } 순수 JPA 테스트 코드\n@Test public void findByUsernameAndAgeGreaterThen() { Member m1 = new Member(\"AAA\", 10); Member m2 = new Member(\"AAA\", 20); memberJpaRepository.save(m1); memberJpaRepository.save(m2); List\u003cMember\u003e result = memberJpaRepository.findByUsernameAndAgeGreaterThen(\"AAA\", 15); assertThat(result.get(0).getUsername()).isEqualTo(\"AAA\"); assertThat(result.get(0).getAge()).isEqualTo(20); assertThat(result.size()).isEqualTo(1); } 스프링 데이터 JPA\npublic interface MemberRepository extends JpaRepository\u003cMember, Long\u003e { List\u003cMember\u003e findByUsernameAndAgeGreaterThan(String username, int age); } 쿼리 결과\n스프링 데이터 JPA는 메소드 이름을 분석해서 JPQL을 생성하고 실행한다.\n메소드이름의 Username은 파라미터의 username과 equal 조건이고 Age는 GreatherThan이여서 파라미터의 age보다 크거나 작다의 조건이 된다.\n쿼리 메소드 필터 조건\n스프링 데이터 JPA 공식 문서 참고\n스프링 데이터 JPA가 제공하는 쿼리 메소드 기능\n조회: find…By, read…By, query…By, get…By 공식 문서 참고 ex) findHelloBy 처럼 …에 식별하기 위한 내용(설명)이 들어가도 된다. COUNT: count…By 반환타입 EXISTS: exists…By 반환타입 삭제: delete…By, remove…By DISTINCT: findDistinct, findMemberDistinctBy LIMIT: findFirst3, findFirst, findTop, findTop3 공식 문서 참고 이 기능은 엔티티의 필드명이 변경되면 인터페이스에 정의한 메서드 이름도 꼭 함께 변경해야 한다. 그렇지않으면 애플리케이션을 시작하는 시점에 오류가 발생한다. 이렇게 애플리케이션 로딩 시점에 오류를 인지할 수 있는 것이 스프링 데이터 JPA의 매우 큰 장점이다.\nJPA NamedQuery @NamedQuery 어노테이션으로 Named 쿼리 정의\n@NamedQuery( name=\"Member.findByUsername\", query = \"select m from Member m where m.username = :username\" ) public class Member { //... } JPA를 직접 사용해서 Named 쿼리 호출\n@Repository public class MemberJpaRepository { //... public List\u003cMember\u003e findByUsername(String username) { return em.createNamedQuery(\"Member.findByUsername\", Member.class) .setParameter(\"username\", username) .getResultList(); } } 스프링 데이터 JPA로 NamedQuery 사용\n@Query(name = \"Member.findByUsername\") List\u003cMember\u003e findByUsername(@Param(\"username\") String username); @Query를 생략하고 메서드 이름만을 Named쿼리를 호출할수 있다.\n스프링 데이터 JPA로 Named 쿼리 호출\npublic interface MemberRepository extends JpaRepository\u003cMember, Long\u003e { // 여기서 선언한 Member 도메인 클래스 List\u003cMember\u003e findByUsername(@Param(\"username\") String username); } 스프링 데이터 JPA는 선언한 “도메인 클래스 + .(점) + 메서드 이름”으로 Named 쿼리를 찾아서 실행 실행할 Named 쿼리가 없을시 메서드 이름으로 쿼리 생성 전약을 사용 스프링 데이터 JPA를 사용하면 실무에서 Named Query를 직접 등록해서 사용하는 일은 드물다. 대신 @Query를 사용해서 리파지토리 메소드에 쿼리를 직접 정의한다\n@Query, 리포지토리 메소드에 쿼리 정의하기 메서드 JPQL 쿼리 작성\npublic interface MemberRepository extends JpaRepository\u003cMember, Long\u003e { @Query(\"select m from Member m where m.username = :username and m.age = :age\") List\u003cMember\u003e findUser(@Param(\"username\") String username, @Param(\"age\") int age);\t} @org.springframework.data.jpa.repository.Query 어노테이션을 사용 실행할 메서드에 정적 쿼리를 직접 작성하므로 이름 없는 Named 쿼리라 할 수 있다. JPA Named 쿼리처럼 @Query(…)에서 m.usererrss 처럼 잘못 작성하면 어플리케이션 실행 시점에 문법 오류를 발견할수 있는 큰 장점이 있다. 메서드 이름으로 쿼리 생성 기능은 파라미터가 증가하면 메서드 이름이 지저분해지기때문에 @Query 기능을 자주 사용함\n@Query, 값, DTO 조회하기 단순히 값 하나를 조회\n@Query(\"select m.username from Member m\") List\u003cString\u003e findUsernameList(); JPA 값 타입(@Embedded)도 이 방식으로 조회할 수 있다.\nMemberDto\n@Data public class MemberDto { private Long id; private String username; private String teamName; public MemberDto(Long id, String username, String teamName) { this.id = id; this.username = username; this.teamName = teamName; } } DTO로 직접 조회\n@Query(\"select new study.data_jpa.dto.MemberDto(m.id, m.username, t.name) from Member m join m.team t\") List\u003cMemberDto\u003e findMemberDto(); DTO로 직접 조회하려면 JPA의 new 명령어를 사용해야하고 생성자가 맞는 DTO가 필요하다.(JPA 사용 방식과 동일)\n파라미터 바인딩 파라미터 바인딩은 위치 기반, 이름 기반이 있다.\nselect m from Member m where m.username = ?0 //위치 기반 select m from Member m where m.username = :name //이름 기반 위치 기반은 순서 실수가 바뀌거나하면 심각한 오류가 발생할수 있기때문에 코드 가독성과 유지보수를 위해 이름 기반 파라미터 바인딩을 사용하는것이 좋다.\n파라미터 바인딩\npublic interface MemberRepository extends JpaRepository\u003cMember, Long\u003e { @Query(\"select m from Member m where m.username = :username and m.age = :age\") List\u003cMember\u003e findUser(@Param(\"username\") String username, @Param(\"age\") int age); } 컬렉션 파라미터 바인딩\n@Query(\"select m from Member m where m.username in :names\") List\u003cMember\u003e findByNames(@Param(\"names\") List\u003cString\u003e names); //Collection가능 Collcetion 타입으로 in절을 지원한다.\n반환 타입 스프링 데이터 JPA는 유연한 반환 타입을 지원한다.\nList\u003cMember\u003e findByUsername(String name); //컬렉션 Member findByUsername(String name); //단건 Optional\u003cMember\u003e findByUsername(String name); //단건 Optional 자세한건 스프링 데이터 JPA 공식 문서를 참고하면 된다.\n조회 결과 많거나 없으면 어떻게 될까?\n컬렉션 결과 없음: **빈 컬렉션 반환(**실무에서 if(…≠ null) 쓰는거 조심), 즉 null이 아님을 보장한다. 단건 조회 결과 없음: null 반환 결과가 2건 이상: javax.persistence.NonUniqueResultException 예외 발생 단건으로 지정한 메서드를 호출하면 스프링 데이터 JPA는 내부에서 JPQL의 Query.getSingleResult() 메서드를 호출한다. 이 메서드를 호출했을 때 조회 결과가 없으면 javax.persistence.NoResultException\n예외가 발생하는데 개발자 입장에서 다루기가 상당히 불편하다. 스프링 데이터 JPA는 단건을 조회할 때 이 예외가 발생하면 예외를 무시하고 대신에 null을 반환한다.\n","wordCount":"770","inLanguage":"en","image":"https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-09-30T22:22:10+09:00","dateModified":"2024-09-30T22:22:10+09:00","author":{"@type":"Person","name":"yosong6729"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yosong6729.github.io/post/%EC%BF%BC%EB%A6%AC-%EB%A9%94%EC%86%8C%EB%93%9C-%EA%B8%B0%EB%8A%A5/"},"publisher":{"@type":"Organization","name":"Yosong6729 Blog","logo":{"@type":"ImageObject","url":"https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yosong6729.github.io/ accesskey=h title="Yosong6729 블로그 (Alt + H)"><img src=https://yosong6729.github.io/apple-touch-icon.png alt aria-label=logo height=35>Yosong6729 블로그</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yosong6729.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://yosong6729.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yosong6729.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://yosong6729.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">쿼리 메소드 기능</h1><div class=post-meta><span title='2024-09-30 22:22:10 +0900 KST'>September 30, 2024</span>&nbsp;·&nbsp;yosong6729&nbsp;|&nbsp;<a href=https://github.com/yosong6729/blog/tree/main/content/post/%ec%bf%bc%eb%a6%ac%20%eb%a9%94%ec%86%8c%eb%93%9c%20%ea%b8%b0%eb%8a%a5/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%eb%a9%94%ec%86%8c%eb%93%9c-%ec%9d%b4%eb%a6%84%ec%9c%bc%eb%a1%9c-%ec%bf%bc%eb%a6%ac-%ec%83%9d%ec%84%b1 aria-label="메소드 이름으로 쿼리 생성">메소드 이름으로 쿼리 생성</a></li><li><a href=#jpa-namedquery aria-label="JPA NamedQuery">JPA NamedQuery</a></li><li><a href=#query-%eb%a6%ac%ed%8f%ac%ec%a7%80%ed%86%a0%eb%a6%ac-%eb%a9%94%ec%86%8c%eb%93%9c%ec%97%90-%ec%bf%bc%eb%a6%ac-%ec%a0%95%ec%9d%98%ed%95%98%ea%b8%b0 aria-label="@Query, 리포지토리 메소드에 쿼리 정의하기">@Query, 리포지토리 메소드에 쿼리 정의하기</a></li><li><a href=#query-%ea%b0%92-dto-%ec%a1%b0%ed%9a%8c%ed%95%98%ea%b8%b0 aria-label="@Query, 값, DTO 조회하기">@Query, 값, DTO 조회하기</a></li><li><a href=#%ed%8c%8c%eb%9d%bc%eb%af%b8%ed%84%b0-%eb%b0%94%ec%9d%b8%eb%94%a9 aria-label="파라미터 바인딩">파라미터 바인딩</a></li><li><a href=#%eb%b0%98%ed%99%98-%ed%83%80%ec%9e%85 aria-label="반환 타입">반환 타입</a></li></ul></div></details></div><div class=post-content><blockquote><p>해당 글은 김영한님의 인프런 강의 <a href=https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-API%EA%B0%9C%EB%B0%9C-%EC%84%B1%EB%8A%A5%EC%B5%9C%EC%A0%81%ED%99%94>스프링부트와 JPA활용2 - API 개발과 성능 최적화</a>을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.</p></blockquote><hr><p>쿼리 메소드 기능 3가지</p><ul><li>메소드 이름으로 쿼리 생성</li><li>메소드 이름으로 JPA NamedQuery 호출</li><li>@Query 어노테이션을 사용해서 리포지토리 인터페이스 쿼리 직접 정의</li></ul><h2 id=메소드-이름으로-쿼리-생성>메소드 이름으로 쿼리 생성<a hidden class=anchor aria-hidden=true href=#메소드-이름으로-쿼리-생성>#</a></h2><p>메소드 이름을 분석해서 JPQL 쿼리를 실행한다.</p><p>이름과 나이를 기준으로 회원을 조회하는 상황이다.</p><p><strong>순수 JPA 리포지토리</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsernameAndAgeGreaterThen</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;select m from Member m where m.username = :username and m.age &gt; :age&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;age&#34;</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>순수 JPA 테스트 코드</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>findByUsernameAndAgeGreaterThen</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>m1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;AAA&#34;</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>m2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;AAA&#34;</span><span class=p>,</span><span class=w> </span><span class=n>20</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>m1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>m2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>findByUsernameAndAgeGreaterThen</span><span class=p>(</span><span class=s>&#34;AAA&#34;</span><span class=p>,</span><span class=w> </span><span class=n>15</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>0</span><span class=p>).</span><span class=na>getUsername</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=s>&#34;AAA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>0</span><span class=p>).</span><span class=na>getAge</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>20</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>size</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>스프링 데이터 JPA</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>MemberRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Member</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsernameAndAgeGreaterThan</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>쿼리 결과</strong></p><p><img loading=lazy src=images/image.png alt=image.png></p><p>스프링 데이터 JPA는 메소드 이름을 분석해서 JPQL을 생성하고 실행한다.</p><p>메소드이름의 Username은 파라미터의 username과 equal 조건이고 Age는 GreatherThan이여서 파라미터의 age보다 크거나 작다의 조건이 된다.</p><p><strong>쿼리 메소드 필터 조건</strong></p><p><a href=https://docs.spring.io/spring-data/jpa/reference/jpa/query-methods.html#jpa.query-methods.query-creation>스프링 데이터 JPA 공식 문서 참고</a></p><p><strong>스프링 데이터 JPA가 제공하는 쿼리 메소드 기능</strong></p><ul><li>조회: find…By, read…By, query…By, get…By<ul><li><a href=https://docs.spring.io/spring-data/jpa/reference/jpa/query-methods.html#jpa.query-methods.query-creation>공식 문서 참고</a></li><li>ex) findHelloBy 처럼 …에 식별하기 위한 내용(설명)이 들어가도 된다.</li></ul></li><li>COUNT: count…By 반환타입</li><li>EXISTS: exists…By 반환타입</li><li>삭제: delete…By, remove…By</li><li>DISTINCT: findDistinct, findMemberDistinctBy</li><li>LIMIT: findFirst3, findFirst, findTop, findTop3<ul><li><a href=https://docs.spring.io/spring-data/jpa/reference/repositories/query-methods-details.html#repositories.limit-query-result>공식 문서 참고</a></li></ul></li></ul><blockquote><p>이 기능은 엔티티의 필드명이 변경되면 인터페이스에 정의한 메서드 이름도 꼭 함께 변경해야 한다. 그렇지않으면 애플리케이션을 시작하는 시점에 오류가 발생한다.
이렇게 애플리케이션 로딩 시점에 오류를 인지할 수 있는 것이 스프링 데이터 JPA의 매우 큰 장점이다.</p></blockquote><hr><h2 id=jpa-namedquery>JPA NamedQuery<a hidden class=anchor aria-hidden=true href=#jpa-namedquery>#</a></h2><p>@NamedQuery 어노테이션으로 Named 쿼리 정의</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@NamedQuery</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>name</span><span class=o>=</span><span class=s>&#34;Member.findByUsername&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select m from Member m where m.username = :username&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Member</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>JPA를 직접 사용해서 Named 쿼리 호출</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberJpaRepository</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsername</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createNamedQuery</span><span class=p>(</span><span class=s>&#34;Member.findByUsername&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>스프링 데이터 JPA로 NamedQuery 사용</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Query</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Member.findByUsername&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsername</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>@Query를 생략하고 메서드 이름만을 Named쿼리를 호출할수 있다.</p><p><strong>스프링 데이터 JPA로 Named 쿼리 호출</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>MemberRepository</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Member</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// 여기서 선언한 Member 도메인 클래스</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsername</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol><li>스프링 데이터 JPA는 선언한 “도메인 클래스 + .(점) + 메서드 이름”으로 Named 쿼리를 찾아서 실행</li><li>실행할 Named 쿼리가 없을시 메서드 이름으로 쿼리 생성 전약을 사용</li></ol><blockquote><p>스프링 데이터 JPA를 사용하면 실무에서 Named Query를 직접 등록해서 사용하는 일은 드물다. 대신 @Query를 사용해서 리파지토리 메소드에 쿼리를 직접 정의한다</p></blockquote><hr><h2 id=query-리포지토리-메소드에-쿼리-정의하기>@Query, 리포지토리 메소드에 쿼리 정의하기<a hidden class=anchor aria-hidden=true href=#query-리포지토리-메소드에-쿼리-정의하기>#</a></h2><p><strong>메서드 JPQL 쿼리 작성</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>MemberRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Member</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;select m from Member m where m.username = :username and m.age = :age&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findUser</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;age&#34;</span><span class=p>)</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>);</span><span class=w>		
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>@org.springframework.data.jpa.repository.Query 어노테이션을 사용</li><li>실행할 메서드에 정적 쿼리를 직접 작성하므로 이름 없는 Named 쿼리라 할 수 있다.</li><li>JPA Named 쿼리처럼 @Query(…)에서 m.usererrss 처럼 잘못 작성하면 어플리케이션 실행 시점에 문법 오류를 발견할수 있는 큰 장점이 있다.</li></ul><blockquote><p>메서드 이름으로 쿼리 생성 기능은 파라미터가 증가하면 메서드 이름이 지저분해지기때문에 @Query 기능을 자주 사용함</p></blockquote><hr><h2 id=query-값-dto-조회하기>@Query, 값, DTO 조회하기<a hidden class=anchor aria-hidden=true href=#query-값-dto-조회하기>#</a></h2><p><strong>단순히 값 하나를 조회</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;select m.username from Member m&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findUsernameList</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>JPA 값 타입(@Embedded)도 이 방식으로 조회할 수 있다.</p><p><strong>MemberDto</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberDto</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>teamName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>MemberDto</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>teamName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>teamName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>teamName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>DTO로 직접 조회</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;select new study.data_jpa.dto.MemberDto(m.id, m.username, t.name) from Member m join m.team t&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findMemberDto</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>DTO로 직접 조회하려면 JPA의 new 명령어를 사용해야하고 생성자가 맞는 DTO가 필요하다.(JPA 사용 방식과 동일)</p><hr><h2 id=파라미터-바인딩>파라미터 바인딩<a hidden class=anchor aria-hidden=true href=#파라미터-바인딩>#</a></h2><p>파라미터 바인딩은 위치 기반, 이름 기반이 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>select</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=n>where</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=na>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=n>0</span><span class=w> </span><span class=c1>//위치 기반</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>select</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=n>where</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=na>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>:</span><span class=n>name</span><span class=w> </span><span class=c1>//이름 기반</span><span class=w>
</span></span></span></code></pre></div><p>위치 기반은 순서 실수가 바뀌거나하면 심각한 오류가 발생할수 있기때문에 코드 가독성과 유지보수를 위해 이름 기반 파라미터 바인딩을 사용하는것이 좋다.</p><p><strong>파라미터 바인딩</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>MemberRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Member</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;select m from Member m where m.username = :username and m.age = :age&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findUser</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;age&#34;</span><span class=p>)</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>컬렉션 파라미터 바인딩</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;select m from Member m where m.username in :names&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByNames</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;names&#34;</span><span class=p>)</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>names</span><span class=p>);</span><span class=w> </span><span class=c1>//Collection가능</span><span class=w>
</span></span></span></code></pre></div><p>Collcetion 타입으로 in절을 지원한다.</p><hr><h2 id=반환-타입>반환 타입<a hidden class=anchor aria-hidden=true href=#반환-타입>#</a></h2><p>스프링 데이터 JPA는 유연한 반환 타입을 지원한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsername</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>);</span><span class=w> </span><span class=c1>//컬렉션</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Member</span><span class=w> </span><span class=nf>findByUsername</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>);</span><span class=w> </span><span class=c1>//단건</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsername</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>);</span><span class=w> </span><span class=c1>//단건 Optional</span><span class=w>
</span></span></span></code></pre></div><p>자세한건 <a href=https://docs.spring.io/spring-data/jpa/reference/repositories/query-return-types-reference.html#appendix.query.return.types>스프링 데이터 JPA 공식 문서</a>를 참고하면 된다.</p><p><strong>조회 결과 많거나 없으면 어떻게 될까?</strong></p><ul><li>컬렉션<ul><li>결과 없음: **빈 컬렉션 반환(**실무에서 if(…≠ null) 쓰는거 조심), 즉 <strong>null이 아님을 보장</strong>한다.</li></ul></li><li>단건 조회<ul><li>결과 없음: null 반환</li><li>결과가 2건 이상: javax.persistence.NonUniqueResultException 예외 발생</li></ul></li></ul><blockquote><p>단건으로 지정한 메서드를 호출하면 스프링 데이터 JPA는 내부에서 JPQL의 Query.getSingleResult() 메서드를 호출한다. 이 메서드를 호출했을 때 조회 결과가 없으면 javax.persistence.NoResultException</p><p>예외가 발생하는데 개발자 입장에서 다루기가 상당히 불편하다. 스프링 데이터 JPA는 단건을 조회할 때 이 예외가 발생하면 예외를 무시하고 대신에 null을 반환한다.</p></blockquote><hr></div><footer class=post-footer><ul class=post-tags><li><a href=https://yosong6729.github.io/tags/spring-data-jpa/>Spring Data JPA</a></li></ul><nav class=paginav><a class=next href=https://yosong6729.github.io/post/%EA%B3%B5%ED%86%B5-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4-%EA%B8%B0%EB%8A%A5/><span class=title>Next »</span><br><span>공통 인터페이스 기능</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://yosong6729.github.io/>Yosong6729 Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>