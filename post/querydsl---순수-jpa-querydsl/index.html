<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Querydsl] 순수 JPA와 Querydsl | Yosong6729 Blog</title>
<meta name=keywords content="Querydsl"><meta name=description content="해당 글은 김영한님의 인프런 강의 실전! Querydsl을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
순수 JPA 리포지토리와 Querydsl 순수 JPA 리포지토리
@Repository public class MemberJpaRepository { private final EntityManager em; private final JPAQueryFactory queryFactory; public MemberJpaRepository(EntityManager em) { this.em = em; this.queryFactory = new JPAQueryFactory(em); } public void save(Member member) { em.persist(member); } public Optional<Member> findById(Long id) { Member findMember = em.find(Member.class, id); return Optional."><meta name=author content="yosong6729"><link rel=canonical href=https://yosong6729.github.io/post/querydsl---%EC%88%9C%EC%88%98-jpa-querydsl/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://yosong6729.github.io/post/querydsl---%EC%88%9C%EC%88%98-jpa-querydsl/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="[Querydsl] 순수 JPA와 Querydsl"><meta property="og:description" content="해당 글은 김영한님의 인프런 강의 실전! Querydsl을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
순수 JPA 리포지토리와 Querydsl 순수 JPA 리포지토리
@Repository public class MemberJpaRepository { private final EntityManager em; private final JPAQueryFactory queryFactory; public MemberJpaRepository(EntityManager em) { this.em = em; this.queryFactory = new JPAQueryFactory(em); } public void save(Member member) { em.persist(member); } public Optional<Member> findById(Long id) { Member findMember = em.find(Member.class, id); return Optional."><meta property="og:type" content="article"><meta property="og:url" content="https://yosong6729.github.io/post/querydsl---%EC%88%9C%EC%88%98-jpa-querydsl/"><meta property="og:image" content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-10-10T17:34:13+09:00"><meta property="article:modified_time" content="2024-10-10T17:34:13+09:00"><meta property="og:site_name" content="Yosong6729 Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[Querydsl] 순수 JPA와 Querydsl"><meta name=twitter:description content="해당 글은 김영한님의 인프런 강의 실전! Querydsl을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
순수 JPA 리포지토리와 Querydsl 순수 JPA 리포지토리
@Repository public class MemberJpaRepository { private final EntityManager em; private final JPAQueryFactory queryFactory; public MemberJpaRepository(EntityManager em) { this.em = em; this.queryFactory = new JPAQueryFactory(em); } public void save(Member member) { em.persist(member); } public Optional<Member> findById(Long id) { Member findMember = em.find(Member.class, id); return Optional."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yosong6729.github.io/post/"},{"@type":"ListItem","position":2,"name":"[Querydsl] 순수 JPA와 Querydsl","item":"https://yosong6729.github.io/post/querydsl---%EC%88%9C%EC%88%98-jpa-querydsl/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Querydsl] 순수 JPA와 Querydsl","name":"[Querydsl] 순수 JPA와 Querydsl","description":"해당 글은 김영한님의 인프런 강의 실전! Querydsl을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n순수 JPA 리포지토리와 Querydsl 순수 JPA 리포지토리\n@Repository public class MemberJpaRepository { private final EntityManager em; private final JPAQueryFactory queryFactory; public MemberJpaRepository(EntityManager em) { this.em = em; this.queryFactory = new JPAQueryFactory(em); } public void save(Member member) { em.persist(member); } public Optional\u0026lt;Member\u0026gt; findById(Long id) { Member findMember = em.find(Member.class, id); return Optional.","keywords":["Querydsl"],"articleBody":" 해당 글은 김영한님의 인프런 강의 실전! Querydsl을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n순수 JPA 리포지토리와 Querydsl 순수 JPA 리포지토리\n@Repository public class MemberJpaRepository { private final EntityManager em; private final JPAQueryFactory queryFactory; public MemberJpaRepository(EntityManager em) { this.em = em; this.queryFactory = new JPAQueryFactory(em); } public void save(Member member) { em.persist(member); } public Optional\u003cMember\u003e findById(Long id) { Member findMember = em.find(Member.class, id); return Optional.ofNullable(findMember); } public List\u003cMember\u003e findAll() { return em.createQuery(\"select m From Member m\", Member.class) .getResultList(); } public List\u003cMember\u003e findByUsername(String username) { return em.createQuery(\"select m From Member m\" + \" where m.username = :username\", Member.class) .setParameter(\"username\", username) .getResultList(); } } 기본적인 member저장, 단건 조회, 모두 조회, username으로 조회를 JPA로 작성했다.\n순수 JPA 리포지토리 테스트\n@SpringBootTest @Transactional class MemberJpaRepositoryTest { @Autowired EntityManager em; @Autowired MemberJpaRepository memberJpaRepository; @Test public void basicTest() { Member member = new Member(\"member1\", 10); memberJpaRepository.save(member); Member findMember = memberJpaRepository.findById(member.getId()).get(); assertThat(findMember).isEqualTo(member); List\u003cMember\u003e result1 = memberJpaRepository.findAll(); assertThat(result1).containsExactly(member); List\u003cMember\u003e result2 = memberJpaRepository.findByUsername(\"member1\"); assertThat(result2).containsExactly(member); } } 리포지토리에 작성한 순수 JPA를 테스트한 코드이고 이상없이 동작한다.\nQuerydsl 사용 순수 JPA 리포지토리 - Querydsl 추가\npublic List\u003cMember\u003e findAll_Querydsl() { return queryFactory .selectFrom(member) .fetch(); } public List\u003cMember\u003e findByUsername_Querydsl(String username) { return queryFactory .selectFrom(member) .where(member.username.eq(username)) .fetch(); } member를 모두 조회하는것과 username으로 member를 조회하는 코드를 Querydsl로 작성해 보았다.\nQuerydsl 테스트 추가\n@Test public void basicTest() { Member member = new Member(\"member1\", 10); memberJpaRepository.save(member); Member findMember = memberJpaRepository.findById(member.getId()).get(); assertThat(findMember).isEqualTo(member); List\u003cMember\u003e result1 = memberJpaRepository.findAll_Querydsl(); assertThat(result1).containsExactly(member); List\u003cMember\u003e result2 = memberJpaRepository.findByUsername_Querydsl(\"member1\"); assertThat(result2).containsExactly(member); } 리포지토리에 작성한 Querydsl 코드를 테스트 코드이고 문제없이 작동한다.\nJPAQueryFactory 스프링 빈 등록 다음과 같이 JPQQueryFactory를 스프링 빈으로 등록해서 주입받아 사용해도 된다.\n@Bean JPAQueryFactory jpaQueryFactory(EntityManager em) { return new JPAQueryFactory(em); } 동시성 문제는 걱정하지 않아도 된다. 왜냐하면 여기서 스프링이 주입해주는 엔티티 매니저는 실제 동작 시점에 진짜 엔티티 매니저를 찾아주는 프록시용 가짜 엔티티 매니저이다. 이 가짜 엔티티 매니저는 실제 사용 시점에 트랜잭션 단위로 실제 엔티티 매니저(영속성 컨텍스트)를 할당해준다. 더 자세한 내용은 자바 ORM 표준 JPA 책 13.1 트랜잭션 범위의 영속성 컨텍스트를 참고하자.\n동적 쿼리와 성능 최적화 조회 - Builder 사용 MemberTeamDto - 조회 최적화용 DTO 추가\n@Data public class MemberTeamDto { private Long memberId; private String username; private int age; private Long teamId; private String teamName; @QueryProjection public MemberTeamDto(Long memberId, String username, int age, Long teamId, String teamName) { this.memberId = memberId; this.username = username; this.age = age; this.teamId = teamId; this.teamName = teamName; } } @QueryProjection을 추가했고 QMemberTeamDto를 생성하기위해서 ./gradlew complieJava를 실행해야한다.\n@QueryProjection을 사용하면 해당 DTO가 Querydsl을 의존하게 되는데 이런 의존이 싫으면 해당 에노테이션을 제거하고 Projection.bean(), fiedls(), constructor()을 사용하면 된다.\n회원 검색 조건\n@Data public class MemberSearchCondition { //회원명, 팀명, 나이(ageGoe, ageLoe) private String username; private String teamName; private Integer ageGoe; private Integer ageLoe; } 동적쿼리 - Builder 사용 Builder를 사용한 예제\npublic List\u003cMemberTeamDto\u003e searchByBuilder(MemberSearchCondition condition) { BooleanBuilder builder = new BooleanBuilder(); if (hasText(condition.getUsername())) { builder.and(member.username.eq(condition.getUsername())); } if (hasText(condition.getTeamName())) { builder.and(team.name.eq(condition.getTeamName())); } if (condition.getAgeGoe() != null) { builder.and(member.age.goe(condition.getAgeGoe())); } if (condition.getAgeLoe() != null) { builder.and(member.age.loe(condition.getAgeLoe())); } return queryFactory .select(new QMemberTeamDto( member.id, member.username, member.age, team.id, team.name )) .from(member) .leftJoin(member.team, team) .where(builder) .fetch(); } Builder를 사용하고 회원 명, 팀명, 나이 조건을 동적으로 추가해서 Querydsl을 작성한다.\n조회 예제 테스트\n@Test public void searchTest() { Team teamA = new Team(\"teamA\"); Team teamB = new Team(\"teamB\"); em.persist(teamA); em.persist(teamB); Member member1 = new Member(\"member1\", 10, teamA); Member member2 = new Member(\"member2\", 20, teamA); Member member3 = new Member(\"member3\", 30, teamB); Member member4 = new Member(\"member4\", 40, teamB); em.persist(member1); em.persist(member2); em.persist(member3); em.persist(member4); MemberSearchCondition condition = new MemberSearchCondition(); condition.setAgeGoe(35); condition.setAgeLoe(40); condition.setTeamName(\"teamB\"); List\u003cMemberTeamDto\u003e result = memberJpaRepository.searchByBuilder(condition); assertThat(result).extracting(\"username\").containsExactly(\"member4\"); } username의 조건은 없고, 나이는 35이상, 40 이하로 했고 팀명은 teamB로 테스트한 결과 member4가 나오고 올바르게 동작한것을 확인했다.\n쿼리 결과를 보면 where절에 username의 조건은 없고 팀명과 나이의 조건이 들어간것을 확인할수 있다.\n동적 쿼리와 성능 최적화 조회 - Where절 파라미터 사용 Where절에 파라미터를 사용한 예제\npublic List\u003cMemberTeamDto\u003e search(MemberSearchCondition condition) { return queryFactory .select(new QMemberTeamDto( member.id, member.username, member.age, team.id, team.name )) .from(member) .leftJoin(member.team, team) .where( usernameEq(condition.getUsername()), teamNameEq(condition.getTeamName()), ageGoe(condition.getAgeGoe()), ageLoe(condition.getAgeLoe()) ) .fetch(); } private BooleanExpression usernameEq(String username) { return hasText(username) ? member.username.eq(username) : null; } private BooleanExpression teamNameEq(String teamName) { return hasText(teamName) ? team.name.eq(teamName) : null; } private BooleanExpression ageGoe(Integer ageGoe) { return ageGoe != null ? member.age.goe(ageGoe) : null; } private BooleanExpression ageLoe(Integer ageLoe) { return ageLoe != null ? member.age.loe(ageLoe) : null; } where 절에 들어가는 타입은 Predicate도 가능하지만 나중에 조합이 가능하게 하려면 BooleanExpression으로 해야하기때문에 BooleanExpression으로 해주는것이 좋다.\nwhere 절에 파라미터 방식을 사용하면 조건 재사용 가능\n다음과 같이 where절에 파라미터 방식을 사용하면 재사용이 가능하다.\npublic List\u003cMember\u003e findMember(MemberSearchCondition condition) { return queryFactory .selectFrom(member) .leftJoin(member.team, team) .where(usernameEq(condition.getUsername()), teamNameEq(condition.getTeamName()), ageGoe(condition.getAgeGoe()), ageLoe(condition.getAgeLoe())) .fetch(); } 조회 API 컨트롤러 개발 이후에 편리한 데이터 확인을 위해서 샘플 데이터를 추가하고 테스트 케이스 실행에 영향을 주지 않도록 다음과 같이 프로파일을 설정한다.\n프로파일 설정\nsrc/main/resources/application.properties\nspring.profiles.active=local 테스트트 기존 applicaiton.properties를 복사해서 다음 경로로 복사하고, 프로파일을 test로 수정\nsrc/test/resources/application.properties\nspring.profiles.active=test 위 처럼 분리하면 main 소스코드와 테스트 소스 코드 실행시 프로파일을 분리할 수 있다.\n샘플 데이터 추가\n@Profile(\"local\") @Component @RequiredArgsConstructor public class InitMember { private final InitMemberService initMemberService; @PostConstruct public void init() { initMemberService.init(); } @Component static class InitMemberService { @PersistenceContext private EntityManager em; @Transactional public void init() { Team teamA = new Team(\"teamA\"); Team teamB = new Team(\"teamB\"); em.persist(teamA); em.persist(teamB); for (int i = 0; i \u003c 100; i++) { Team selectedTeam = i % 2 == 0 ? teamA : teamB; em.persist(new Member(\"member\" + i, i, selectedTeam)); } } } } InitMember.init() 메서드 안에 InitMemberService.init() 메서드의 내용을 그대로 작성하면 안되는지 궁금증이 생길수 있는데 스프링 라이프 사이클 때문에 @PostConstruct, @Transaction을 분리해야하기때문에 위 처럼 분리해줘야 한다.\n조회 컨트롤러\n@RestController @RequiredArgsConstructor public class MemberController { private final MemberJpaRepository memberJpaRepository; @GetMapping(\"/v1/members\") public List\u003cMemberTeamDto\u003e searchMemberV1(MemberSearchCondition condition) { return memberJpaRepository.search(condition); } } 스프링 서버 시작시 local인지 test인지 다음과 같이 확인이 가능하다.\npostman으로 http://localhost:8080/v1/members?teamName=teamB\u0026ageGoe=31\u0026ageLoe=35 로 실행시 다음과 같이 올바르게 결과가 나오는 것을 확인할수 있다.\n쿼리 결과도 다음과 같이 팀명과 나이 조건이 들어간것을 확인할수 있다.\n","wordCount":"941","inLanguage":"en","image":"https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-10T17:34:13+09:00","dateModified":"2024-10-10T17:34:13+09:00","author":{"@type":"Person","name":"yosong6729"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yosong6729.github.io/post/querydsl---%EC%88%9C%EC%88%98-jpa-querydsl/"},"publisher":{"@type":"Organization","name":"Yosong6729 Blog","logo":{"@type":"ImageObject","url":"https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yosong6729.github.io/ accesskey=h title="Yosong6729 블로그 (Alt + H)"><img src=https://yosong6729.github.io/apple-touch-icon.png alt aria-label=logo height=35>Yosong6729 블로그</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yosong6729.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://yosong6729.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yosong6729.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://yosong6729.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">[Querydsl] 순수 JPA와 Querydsl</h1><div class=post-meta><span title='2024-10-10 17:34:13 +0900 KST'>October 10, 2024</span>&nbsp;·&nbsp;yosong6729&nbsp;|&nbsp;<a href=https://github.com/yosong6729/blog/tree/main/content/post/Querydsl%20-%20%ec%88%9c%ec%88%98%20JPA%20Querydsl/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%ec%88%9c%ec%88%98-jpa-%eb%a6%ac%ed%8f%ac%ec%a7%80%ed%86%a0%eb%a6%ac%ec%99%80-querydsl aria-label="순수 JPA 리포지토리와 Querydsl">순수 JPA 리포지토리와 Querydsl</a><ul><li><a href=#querydsl-%ec%82%ac%ec%9a%a9 aria-label="Querydsl 사용">Querydsl 사용</a></li><li><a href=#jpaqueryfactory-%ec%8a%a4%ed%94%84%eb%a7%81-%eb%b9%88-%eb%93%b1%eb%a1%9d aria-label="JPAQueryFactory 스프링 빈 등록">JPAQueryFactory 스프링 빈 등록</a></li></ul></li><li><a href=#%eb%8f%99%ec%a0%81-%ec%bf%bc%eb%a6%ac%ec%99%80-%ec%84%b1%eb%8a%a5-%ec%b5%9c%ec%a0%81%ed%99%94-%ec%a1%b0%ed%9a%8c---builder-%ec%82%ac%ec%9a%a9 aria-label="동적 쿼리와 성능 최적화 조회 - Builder 사용">동적 쿼리와 성능 최적화 조회 - Builder 사용</a><ul><li><a href=#%eb%8f%99%ec%a0%81%ec%bf%bc%eb%a6%ac---builder-%ec%82%ac%ec%9a%a9 aria-label="동적쿼리 - Builder 사용">동적쿼리 - Builder 사용</a></li></ul></li><li><a href=#%eb%8f%99%ec%a0%81-%ec%bf%bc%eb%a6%ac%ec%99%80-%ec%84%b1%eb%8a%a5-%ec%b5%9c%ec%a0%81%ed%99%94-%ec%a1%b0%ed%9a%8c---where%ec%a0%88-%ed%8c%8c%eb%9d%bc%eb%af%b8%ed%84%b0-%ec%82%ac%ec%9a%a9 aria-label="동적 쿼리와 성능 최적화 조회 - Where절 파라미터 사용">동적 쿼리와 성능 최적화 조회 - Where절 파라미터 사용</a></li><li><a href=#%ec%a1%b0%ed%9a%8c-api-%ec%bb%a8%ed%8a%b8%eb%a1%a4%eb%9f%ac-%ea%b0%9c%eb%b0%9c aria-label="조회 API 컨트롤러 개발">조회 API 컨트롤러 개발</a></li></ul></div></details></div><div class=post-content><blockquote><p>해당 글은 김영한님의 인프런 강의 <a href=https://www.inflearn.com/course/querydsl-%EC%8B%A4%EC%A0%84>실전! Querydsl</a>을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.</p></blockquote><hr><h2 id=순수-jpa-리포지토리와-querydsl>순수 JPA 리포지토리와 Querydsl<a hidden class=anchor aria-hidden=true href=#순수-jpa-리포지토리와-querydsl>#</a></h2><p><strong>순수 JPA 리포지토리</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberJpaRepository</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>EntityManager</span><span class=w> </span><span class=n>em</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JPAQueryFactory</span><span class=w> </span><span class=n>queryFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>MemberJpaRepository</span><span class=p>(</span><span class=n>EntityManager</span><span class=w> </span><span class=n>em</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>em</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>queryFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JPAQueryFactory</span><span class=p>(</span><span class=n>em</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findById</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>findMember</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Optional</span><span class=p>.</span><span class=na>ofNullable</span><span class=p>(</span><span class=n>findMember</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAll</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;select m From Member m&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsername</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;select m From Member m&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=s>&#34; where m.username = :username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>기본적인 member저장, 단건 조회, 모두 조회, username으로 조회를 JPA로 작성했다.</p><p><strong>순수 JPA 리포지토리 테스트</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>MemberJpaRepositoryTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>EntityManager</span><span class=w> </span><span class=n>em</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MemberJpaRepository</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>basicTest</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>findMember</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result1</span><span class=p>).</span><span class=na>containsExactly</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>findByUsername</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result2</span><span class=p>).</span><span class=na>containsExactly</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>리포지토리에 작성한 순수 JPA를 테스트한 코드이고 이상없이 동작한다.</p><h3 id=querydsl-사용>Querydsl 사용<a hidden class=anchor aria-hidden=true href=#querydsl-사용>#</a></h3><p><strong>순수 JPA 리포지토리 - Querydsl 추가</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAll_Querydsl</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>queryFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>selectFrom</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>fetch</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsername_Querydsl</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>queryFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>selectFrom</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>username</span><span class=p>.</span><span class=na>eq</span><span class=p>(</span><span class=n>username</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>fetch</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>member를 모두 조회하는것과 username으로 member를 조회하는 코드를 Querydsl로 작성해 보았다.</p><p><strong>Querydsl 테스트 추가</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>basicTest</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>findMember</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>findAll_Querydsl</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result1</span><span class=p>).</span><span class=na>containsExactly</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>result2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>findByUsername_Querydsl</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result2</span><span class=p>).</span><span class=na>containsExactly</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>리포지토리에 작성한 Querydsl 코드를 테스트 코드이고 문제없이 작동한다.</p><h3 id=jpaqueryfactory-스프링-빈-등록>JPAQueryFactory 스프링 빈 등록<a hidden class=anchor aria-hidden=true href=#jpaqueryfactory-스프링-빈-등록>#</a></h3><p>다음과 같이 JPQQueryFactory를 스프링 빈으로 등록해서 주입받아 사용해도 된다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>JPAQueryFactory</span><span class=w> </span><span class=nf>jpaQueryFactory</span><span class=p>(</span><span class=n>EntityManager</span><span class=w> </span><span class=n>em</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JPAQueryFactory</span><span class=p>(</span><span class=n>em</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>동시성 문제는 걱정하지 않아도 된다. 왜냐하면 여기서 스프링이 주입해주는 엔티티 매니저는 실제 동작 시점에 진짜 엔티티 매니저를 찾아주는 프록시용 가짜 엔티티 매니저이다. 이 가짜 엔티티 매니저는 실제 사용 시점에 트랜잭션 단위로 실제 엔티티 매니저(영속성 컨텍스트)를 할당해준다.
더 자세한 내용은 자바 ORM 표준 JPA 책 13.1 트랜잭션 범위의 영속성 컨텍스트를 참고하자.</p></blockquote><hr><h2 id=동적-쿼리와-성능-최적화-조회---builder-사용>동적 쿼리와 성능 최적화 조회 - Builder 사용<a hidden class=anchor aria-hidden=true href=#동적-쿼리와-성능-최적화-조회---builder-사용>#</a></h2><p><strong>MemberTeamDto - 조회 최적화용 DTO 추가</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberTeamDto</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>memberId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>teamId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>teamName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@QueryProjection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>MemberTeamDto</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>memberId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>teamId</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>teamName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>memberId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>teamId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>teamId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>teamName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>teamName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>@QueryProjection을 추가했고 QMemberTeamDto를 생성하기위해서 ./gradlew complieJava를 실행해야한다.</p><blockquote><p>@QueryProjection을 사용하면 해당 DTO가 Querydsl을 의존하게 되는데 이런 의존이 싫으면 해당 에노테이션을 제거하고 Projection.bean(), fiedls(), constructor()을 사용하면 된다.</p></blockquote><p><strong>회원 검색 조건</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberSearchCondition</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//회원명, 팀명, 나이(ageGoe, ageLoe)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>teamName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>ageGoe</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>ageLoe</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=동적쿼리---builder-사용>동적쿼리 - Builder 사용<a hidden class=anchor aria-hidden=true href=#동적쿼리---builder-사용>#</a></h3><p><strong>Builder를 사용한 예제</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>searchByBuilder</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>BooleanBuilder</span><span class=w> </span><span class=n>builder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BooleanBuilder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>hasText</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>builder</span><span class=p>.</span><span class=na>and</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>username</span><span class=p>.</span><span class=na>eq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>hasText</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getTeamName</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>builder</span><span class=p>.</span><span class=na>and</span><span class=p>(</span><span class=n>team</span><span class=p>.</span><span class=na>name</span><span class=p>.</span><span class=na>eq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getTeamName</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeGoe</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>builder</span><span class=p>.</span><span class=na>and</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>age</span><span class=p>.</span><span class=na>goe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeGoe</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeLoe</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>builder</span><span class=p>.</span><span class=na>and</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>age</span><span class=p>.</span><span class=na>loe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeLoe</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>queryFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>QMemberTeamDto</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>username</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>age</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>team</span><span class=p>.</span><span class=na>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>team</span><span class=p>.</span><span class=na>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>leftJoin</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>team</span><span class=p>,</span><span class=w> </span><span class=n>team</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=n>builder</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>fetch</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Builder를 사용하고 회원 명, 팀명, 나이 조건을 동적으로 추가해서 Querydsl을 작성한다.</p><p><strong>조회 예제 테스트</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>searchTest</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Team</span><span class=w> </span><span class=n>teamA</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>(</span><span class=s>&#34;teamA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Team</span><span class=w> </span><span class=n>teamB</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>(</span><span class=s>&#34;teamB&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>teamA</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>teamB</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>,</span><span class=w> </span><span class=n>teamA</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member2&#34;</span><span class=p>,</span><span class=w> </span><span class=n>20</span><span class=p>,</span><span class=w> </span><span class=n>teamA</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member3&#34;</span><span class=p>,</span><span class=w> </span><span class=n>30</span><span class=p>,</span><span class=w> </span><span class=n>teamB</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member4</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member4&#34;</span><span class=p>,</span><span class=w> </span><span class=n>40</span><span class=p>,</span><span class=w> </span><span class=n>teamB</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member4</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>MemberSearchCondition</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>condition</span><span class=p>.</span><span class=na>setAgeGoe</span><span class=p>(</span><span class=n>35</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>condition</span><span class=p>.</span><span class=na>setAgeLoe</span><span class=p>(</span><span class=n>40</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>condition</span><span class=p>.</span><span class=na>setTeamName</span><span class=p>(</span><span class=s>&#34;teamB&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>searchByBuilder</span><span class=p>(</span><span class=n>condition</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertThat</span><span class=p>(</span><span class=n>result</span><span class=p>).</span><span class=na>extracting</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>).</span><span class=na>containsExactly</span><span class=p>(</span><span class=s>&#34;member4&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>username의 조건은 없고, 나이는 35이상, 40 이하로 했고 팀명은 teamB로 테스트한 결과 member4가 나오고 올바르게 동작한것을 확인했다.</p><p>쿼리 결과를 보면 where절에 username의 조건은 없고 팀명과 나이의 조건이 들어간것을 확인할수 있다.</p><p><img loading=lazy src=images/image.png alt=image.png></p><hr><h2 id=동적-쿼리와-성능-최적화-조회---where절-파라미터-사용>동적 쿼리와 성능 최적화 조회 - Where절 파라미터 사용<a hidden class=anchor aria-hidden=true href=#동적-쿼리와-성능-최적화-조회---where절-파라미터-사용>#</a></h2><p><strong>Where절에 파라미터를 사용한 예제</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>search</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>queryFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>QMemberTeamDto</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>username</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>member</span><span class=p>.</span><span class=na>age</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>team</span><span class=p>.</span><span class=na>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>team</span><span class=p>.</span><span class=na>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>leftJoin</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>team</span><span class=p>,</span><span class=w> </span><span class=n>team</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>usernameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>teamNameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getTeamName</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ageGoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeGoe</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ageLoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeLoe</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>fetch</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=n>BooleanExpression</span><span class=w> </span><span class=nf>usernameEq</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>hasText</span><span class=p>(</span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>member</span><span class=p>.</span><span class=na>username</span><span class=p>.</span><span class=na>eq</span><span class=p>(</span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=n>BooleanExpression</span><span class=w> </span><span class=nf>teamNameEq</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>teamName</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>hasText</span><span class=p>(</span><span class=n>teamName</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>team</span><span class=p>.</span><span class=na>name</span><span class=p>.</span><span class=na>eq</span><span class=p>(</span><span class=n>teamName</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=n>BooleanExpression</span><span class=w> </span><span class=nf>ageGoe</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>ageGoe</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ageGoe</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>member</span><span class=p>.</span><span class=na>age</span><span class=p>.</span><span class=na>goe</span><span class=p>(</span><span class=n>ageGoe</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=n>BooleanExpression</span><span class=w> </span><span class=nf>ageLoe</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>ageLoe</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ageLoe</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>member</span><span class=p>.</span><span class=na>age</span><span class=p>.</span><span class=na>loe</span><span class=p>(</span><span class=n>ageLoe</span><span class=p>)</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>where 절에 들어가는 타입은 Predicate도 가능하지만 나중에 조합이 가능하게 하려면 BooleanExpression으로 해야하기때문에 BooleanExpression으로 해주는것이 좋다.</p><p><strong>where 절에 파라미터 방식을 사용하면 조건 재사용 가능</strong></p><p>다음과 같이 where절에 파라미터 방식을 사용하면 재사용이 가능하다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findMember</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>queryFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>selectFrom</span><span class=p>(</span><span class=n>member</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>leftJoin</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>team</span><span class=p>,</span><span class=w> </span><span class=n>team</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>where</span><span class=p>(</span><span class=n>usernameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>teamNameEq</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getTeamName</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>ageGoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeGoe</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>ageLoe</span><span class=p>(</span><span class=n>condition</span><span class=p>.</span><span class=na>getAgeLoe</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>fetch</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><hr><h2 id=조회-api-컨트롤러-개발>조회 API 컨트롤러 개발<a hidden class=anchor aria-hidden=true href=#조회-api-컨트롤러-개발>#</a></h2><p>이후에 편리한 데이터 확인을 위해서 샘플 데이터를 추가하고 테스트 케이스 실행에 영향을 주지 않도록 다음과 같이 프로파일을 설정한다.</p><p><strong>프로파일 설정</strong></p><p>src/main/resources/application.properties</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>spring.profiles.active=local</span><span class=w>
</span></span></span></code></pre></div><p>테스트트 기존 applicaiton.properties를 복사해서 다음 경로로 복사하고, 프로파일을 test로 수정</p><p>src/test/resources/application.properties</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>spring.profiles.active=test</span><span class=w>
</span></span></span></code></pre></div><p>위 처럼 분리하면 main 소스코드와 테스트 소스 코드 실행시 프로파일을 분리할 수 있다.</p><p><strong>샘플 데이터 추가</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Profile</span><span class=p>(</span><span class=s>&#34;local&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequiredArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>InitMember</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>InitMemberService</span><span class=w> </span><span class=n>initMemberService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostConstruct</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>init</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>initMemberService</span><span class=p>.</span><span class=na>init</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>InitMemberService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@PersistenceContext</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=n>EntityManager</span><span class=w> </span><span class=n>em</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>init</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Team</span><span class=w> </span><span class=n>teamA</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>(</span><span class=s>&#34;teamA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Team</span><span class=w> </span><span class=n>teamB</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>(</span><span class=s>&#34;teamB&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>teamA</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>teamB</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>100</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Team</span><span class=w> </span><span class=n>selectedTeam</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>2</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>teamA</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>teamB</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>selectedTeam</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>InitMember.init() 메서드 안에 InitMemberService.init() 메서드의 내용을 그대로 작성하면 안되는지 궁금증이 생길수 있는데 스프링 라이프 사이클 때문에 @PostConstruct, @Transaction을 분리해야하기때문에 위 처럼 분리해줘야 한다.</p><p><strong>조회 컨트롤러</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequiredArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MemberJpaRepository</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/v1/members&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberTeamDto</span><span class=o>&gt;</span><span class=w> </span><span class=nf>searchMemberV1</span><span class=p>(</span><span class=n>MemberSearchCondition</span><span class=w> </span><span class=n>condition</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>search</span><span class=p>(</span><span class=n>condition</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>스프링 서버 시작시 local인지 test인지 다음과 같이 확인이 가능하다.</p><p><img loading=lazy src=images/image%201.png alt=image.png></p><p>postman으로 http://localhost:8080/v1/members?teamName=teamB&amp;ageGoe=31&amp;ageLoe=35 로 실행시 다음과 같이 올바르게 결과가 나오는 것을 확인할수 있다.</p><p><img loading=lazy src=images/image%202.png alt=image.png></p><p>쿼리 결과도 다음과 같이 팀명과 나이 조건이 들어간것을 확인할수 있다.</p><p><img loading=lazy src=images/image%203.png alt=image.png></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://yosong6729.github.io/tags/querydsl/>Querydsl</a></li></ul><nav class=paginav><a class=next href=https://yosong6729.github.io/post/querydsl---%EC%A4%91%EA%B8%89-%EB%AC%B8%EB%B2%95/><span class=title>Next »</span><br><span>[Querydsl] 중급 문법</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://yosong6729.github.io/>Yosong6729 Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>