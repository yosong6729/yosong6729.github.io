<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[자바 ORM 표준 JPA 프로그래밍 - 기본편] 연관관계 매핑 기초 | Yosong6729 Blog</title>
<meta name=keywords content="JPA"><meta name=description content='해당 글은 김영한님의 인프런 강의 자바 ORM 표준 JPA 프로그래밍 - 기본편을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
연관관계가 필요한 이유 ‘객체지향 설계의 목표는 자율적인 객체들의 협력 공동체를 만드는 것이다.’
– 조영호(객체지향의 사실과 오해) -
예제 시나리오 회원과 팀이 있다. 회원은 하나의 팀에만 소속될 수 있다. 회원과 팀은 다대일 관계다. 객체를 테이블에 맞추어 모델링 연관관계가 없는 객체이다.
@Entity public class Member { @Id @GeneratedValue private Long id; @Column(name = "USERNAME") private String name; @Column(name = "TEAM_ID") private Long teamId; … } @Entity public class Team { @Id @GeneratedValue private Long id; private String name; … } 참조 대신에 외래 키를 그대로 사용한다.'><meta name=author content="yosong6729"><link rel=canonical href=https://yosong6729.github.io/post/%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EA%B8%B0%EC%B4%88/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://yosong6729.github.io/post/%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EA%B8%B0%EC%B4%88/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="[자바 ORM 표준 JPA 프로그래밍 - 기본편] 연관관계 매핑 기초"><meta property="og:description" content='해당 글은 김영한님의 인프런 강의 자바 ORM 표준 JPA 프로그래밍 - 기본편을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
연관관계가 필요한 이유 ‘객체지향 설계의 목표는 자율적인 객체들의 협력 공동체를 만드는 것이다.’
– 조영호(객체지향의 사실과 오해) -
예제 시나리오 회원과 팀이 있다. 회원은 하나의 팀에만 소속될 수 있다. 회원과 팀은 다대일 관계다. 객체를 테이블에 맞추어 모델링 연관관계가 없는 객체이다.
@Entity public class Member { @Id @GeneratedValue private Long id; @Column(name = "USERNAME") private String name; @Column(name = "TEAM_ID") private Long teamId; … } @Entity public class Team { @Id @GeneratedValue private Long id; private String name; … } 참조 대신에 외래 키를 그대로 사용한다.'><meta property="og:type" content="article"><meta property="og:url" content="https://yosong6729.github.io/post/%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EA%B8%B0%EC%B4%88/"><meta property="og:image" content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-09-11T16:47:33+09:00"><meta property="article:modified_time" content="2024-09-11T16:47:33+09:00"><meta property="og:site_name" content="Yosong6729 Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[자바 ORM 표준 JPA 프로그래밍 - 기본편] 연관관계 매핑 기초"><meta name=twitter:description content='해당 글은 김영한님의 인프런 강의 자바 ORM 표준 JPA 프로그래밍 - 기본편을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
연관관계가 필요한 이유 ‘객체지향 설계의 목표는 자율적인 객체들의 협력 공동체를 만드는 것이다.’
– 조영호(객체지향의 사실과 오해) -
예제 시나리오 회원과 팀이 있다. 회원은 하나의 팀에만 소속될 수 있다. 회원과 팀은 다대일 관계다. 객체를 테이블에 맞추어 모델링 연관관계가 없는 객체이다.
@Entity public class Member { @Id @GeneratedValue private Long id; @Column(name = "USERNAME") private String name; @Column(name = "TEAM_ID") private Long teamId; … } @Entity public class Team { @Id @GeneratedValue private Long id; private String name; … } 참조 대신에 외래 키를 그대로 사용한다.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yosong6729.github.io/post/"},{"@type":"ListItem","position":2,"name":"[자바 ORM 표준 JPA 프로그래밍 - 기본편] 연관관계 매핑 기초","item":"https://yosong6729.github.io/post/%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EA%B8%B0%EC%B4%88/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[자바 ORM 표준 JPA 프로그래밍 - 기본편] 연관관계 매핑 기초","name":"[자바 ORM 표준 JPA 프로그래밍 - 기본편] 연관관계 매핑 기초","description":"해당 글은 김영한님의 인프런 강의 자바 ORM 표준 JPA 프로그래밍 - 기본편을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n연관관계가 필요한 이유 ‘객체지향 설계의 목표는 자율적인 객체들의 협력 공동체를 만드는 것이다.’\n– 조영호(객체지향의 사실과 오해) -\n예제 시나리오 회원과 팀이 있다. 회원은 하나의 팀에만 소속될 수 있다. 회원과 팀은 다대일 관계다. 객체를 테이블에 맞추어 모델링 연관관계가 없는 객체이다.\n@Entity public class Member { @Id @GeneratedValue private Long id; @Column(name = \u0026#34;USERNAME\u0026#34;) private String name; @Column(name = \u0026#34;TEAM_ID\u0026#34;) private Long teamId; … } @Entity public class Team { @Id @GeneratedValue private Long id; private String name; … } 참조 대신에 외래 키를 그대로 사용한다.","keywords":["JPA"],"articleBody":"해당 글은 김영한님의 인프런 강의 자바 ORM 표준 JPA 프로그래밍 - 기본편을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n연관관계가 필요한 이유 ‘객체지향 설계의 목표는 자율적인 객체들의 협력 공동체를 만드는 것이다.’\n– 조영호(객체지향의 사실과 오해) -\n예제 시나리오 회원과 팀이 있다. 회원은 하나의 팀에만 소속될 수 있다. 회원과 팀은 다대일 관계다. 객체를 테이블에 맞추어 모델링 연관관계가 없는 객체이다.\n@Entity public class Member { @Id @GeneratedValue private Long id; @Column(name = \"USERNAME\") private String name; @Column(name = \"TEAM_ID\") private Long teamId; … } @Entity public class Team { @Id @GeneratedValue private Long id; private String name; … } 참조 대신에 외래 키를 그대로 사용한다.\n//팀 저장 Team team = new Team(); team.setName(\"TeamA\"); em.persist(team); //영속상태가 되면 무조건 pk값이 세팅되고 영속 상태가됨 //회원 저장 Member member = new Member(); member.setName(\"member1\"); **member.setTeamId(team.getId());** em.persist(member); 외래 키 식별자를 직접 다룬다. setTeamId()로 외래 키를 다루는것은 객체지향스럽지 않다.\n식별자로 다시 조회, 객체 지향적인 방법은 아니다.\n//조회 Member findMember = em.find(Member.class, member.getId()); //연관관계가 없음 Team findTeam = em.find(Team.class, team.getId()); 객체를 테이블에 맞추어 데이터 중심으로 모델링 하면, 협력 관계를 만들 수 없다.\n테이블은 외래 키로 조인을 사용해서 연관된 테이블을 찾는다. 객체는 참조를 사용해서 연관된 객체를 찾는다. 테이블과 객체 사이에는 이런 큰 간격이 있다. 단방향 연관관계 객체 지향 모델링 객체 연관관계 사용\nMember에 Team의 id가 아니라 Team의 참조값을 그대로 가져온다.\n@Entity public class Member { @Id @GeneratedValue private Long id; @Column(name = \"USERNAME\") private String name; private int age; // @Column(name = \"TEAM_ID\") // private Long teamId; @ManyToOne @JoinColumn(name = \"TEAM_ID\") private Team team; … 객체의 참조와 테이블의 외래 키를 매핑\n하나의 팀에 여러 멤버가 소속되기 때문에 private Team team;에 @ManyToOne을 사용하여 매핑해준다.\n객체 연관관계의 Team team과 테이블 연관관계 TEAM_ID(FK)를 매핑하기 위해 @JoinColumn(name = “TEAM_ID”)를 사용하여 매핑해준다.\nORM 매핑\n객체의 Team과 테이블 TEAM_ID를 매핑을 하면 위 사진 처럼 된다고 이해하면 된다.\n연관관계 저장\n//팀 저장 Team team = new Team(); team.setName(\"TeamA\"); em.persist(team); //회원 저장 Member member = new Member(); member.setName(\"member1\"); **member.setTeam(team); //단방향 연관관계 설정, 참조 저장** em.persist(member); member.setTeam(team)을 하게되면 jpa가 알아서 팀에서 PK값을 꺼내서 FK 값에 insert할떄 FK값을 사용한다.\n참조로 연관관계 조회 - 객체 그래프 탐색\n//조회 Member findMember = em.find(Member.class, member.getId()); //참조를 사용해서 연관관계 조회 Team findTeam = findMember.getTeam(); findMember.getTeam()으로 findMember의 Team을 바로 가져올수 있게된다.\n연관관계 수정\n// 새로운 팀B Team teamB = new Team(); teamB.setName(\"TeamB\"); em.persist(teamB); // 회원1에 새로운 팀B 설정 **member.setTeam(teamB);** setTeam()을 사용하여 팀을 바꿀수 있고 DB의 외래키 값이 업데이트 된다. 이런 방식으로 연관관계를 수정할 수 있다.\n양방향 연관관계와 연관관계의 주인 양방향 매핑 이전 예제에서는 Member가 Team을 가져서 Member에서 Team으로는 갈수 있지만 Team에서는 Member로 갈수있는 방법이 없었다. 그래서 Team에 List member를 추가해주어서 양방향으로 만들어 주었다.\n테이블은 외래키 하나만 넣어주면 양쪽으로 다 볼수있다는 점이 객체 참조와 테이블의 외래키의 가장 큰 차이점이다.\nMember 엔티티는 단방향과 동일\n@Entity public class Member { @Id @GeneratedValue private Long id; @Column(name = \"USERNAME\") private String name; private int age; @ManyToOne @JoinColumn(name = \"TEAM_ID\") private Team team; … Team 엔티티는 컬렉션 추가\n@Entity public class Team { @Id @GeneratedValue private Long id; private String name; @OneToMany(mappedBy = \"team\") List\u003cMember\u003e members = new ArrayList\u003cMember\u003e(); … } 하나의 Team에는 여러 Member가 포함되어 있기 떄문에 List타입으로 member를 만들고 @OneToMany를 사용한다. members가 Member객체의 team 변수명과 연결되어 있다는 것을 (mappedBy = “team”)으로 표시한다.\n반대 방향으로 객체 그래프 탐색\n//조회 Team findTeam = em.find(Team.class, team.getId()); int memberSize = findTeam.getMembers().size(); //역방향 조회 양방향 연관관계로 findTeam.getMembers()로 역방향으로 값을 가져올수 있게 된다.\n연관관계의 주인과 mappedBy mappedBy = JPA의 멘탈붕괴 난이도 mappedBy는 처음에는 이해하기 어렵다. 객체와 테이블간에 연관관계를 맺는 차이를 이해해야 한다. 객체와 테이블이 관계를 맺는 차이 객체 연관관계 = 2개 회원 -\u003e 팀 연관관계 1개(단방향) 팀 -\u003e 회원 연관관계 1개(단방향) 테이블 연관관계 = 1개 회원 ↔ 팀의 연관관계 1개(양방향) 객체의 양방향 관계 객체의 양방향 관계는 사실 양방향 관계가 아니라 서로 다른 단방향 관계 2개다. 객체를 양방향으로 참조하려면 단방향 연관관계를 2개 만들어야 한다. A → B (a.getB()) class A { B b; } B → A (b.geA()) class B { A a; } 테이블의 양방향 연관관계 테이블은 외래 키 하나로 두 테이블의 연관관계를 관리 MEMBER.TEAM_ID 외래 키 하나로 양방향 연관관계 가짐(양쪽으로 조인할 수 있다.) SELECT * FROM MEMBER M JOIN TEAM T ON M.TEAM_ID = T.TEAM_ID // 반대 가능 SELECT * FROM TEAM T JOIN MEMBER M ON T.TEAM_ID = M.TEAM_ID 둘 중 하나로 외래 키를 관리해야 한다. 내가 멤버를 바꾸고 싶거나 다른 새로운 팀에 들어가고 싶을때 멤버의 팀의 값을 바꿔야 될지, 팀에 있는 List members를 바꿔야 할지 고민이다.\n이런 고민을 덜기 위해서 둘 중 하나를 주인을 정하는 것이 연관관계의 주인이다.\n연관관계의 주인(Owner) 양방향 매핑 규칙\n객체의 두 관계중 하나를 연관관계의 주인으로 지정 연관관계의 주인만이 외래 키를 관리(등록, 수정) 주인이 아닌쪽은 읽기만 가능 주인은 mappedBy 속성 사용X 주인이 아니면 mappedBy 속성으로 주인 지정 누구를 주인으로? 외래 키가 있는 있는 곳을 주인으로 정해라 여기서는 Member.team이 연관관계의 주인 List members에 값을 넣어도 변화가 생기지 않고 값을 조회하는 것은 가능하다. DB에 없데이트 하거나 값을 넣을 경우에 Member 객체의 Team team을 참조한다.\n양방향 매핑시 가장 많이 하는 실수 연관 관계의 주인에 값을 입력하지 않는다.\nTeam team = new Team(); team.setName(\"TeamA\"); em.persist(team); Member member = new Member(); member.setName(\"member1\"); //역방향(주인이 아닌 방향)만 연관관계 설정 team.getMembers().add(member); em.persist(member); 역방향(주인이 아닌 방향)에만 member를 추가하게 된다면 DB에는 Member의 Team이 저장 되지 않는다.\n양방향 매핑시 연관관계의 주인에 값을 입력해야 한다. Team team = new Team(); team.setName(\"TeamA\"); em.persist(team); Member member = new Member(); member.setName(\"member1\"); team.getMembers().add(member); //연관관계의 주인에 값 설정 member.setTeam(team); //** em.persist(member); 연관관계의 주인에 값을 설정하게 되면 DB에 값이 저장된다.\n순수한 객체 관계를 고려하면 항상 양쪽다 값을 입력해야 한다.\n양방향 연관관계 주의 순수 객체 상태를 고려해서 항상 양쪽에 값을 설정하자 연관관계 편의 메소드를 생성하자 양방향 매핑시 무한 루프를 조심하자 예: toString(), lombok, JSON 생성 라이브러리 양방향 매핑 정리 단방향 매핑만으로도 이미 연관관계 매핑은 완료 양방향 매핑은 반대 방향으로 조회(객체 그래프 탐색) 기능이 추가 된 것 뿐 JPQL에서 역방향으로 탐색할 일이 많음 단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨(테이블에 영향을 주지 않음) 연관관계의 주인을 정하는 기준 비즈니스 로직을 기준으로 연관관계의 주인을 선택하면 안됨 연관관계의 주인은 외래 키의 위치를기준으로 정해야함 실전 예제 - 2. 연관관계 매핑 시작 테이블 구조 테이블 구조는 이전과 같다.\n객체 구조 참조를 사용하도록 변경한다.\n예제 코드는 김영한님의 인프런 강의 자바 ORM 표준 JPA 프로그래밍 - 기본편에서 확인 할수 있습니다.\n","wordCount":"992","inLanguage":"en","image":"https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-09-11T16:47:33+09:00","dateModified":"2024-09-11T16:47:33+09:00","author":{"@type":"Person","name":"yosong6729"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yosong6729.github.io/post/%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EA%B8%B0%EC%B4%88/"},"publisher":{"@type":"Organization","name":"Yosong6729 Blog","logo":{"@type":"ImageObject","url":"https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yosong6729.github.io/ accesskey=h title="Yosong6729 블로그 (Alt + H)"><img src=https://yosong6729.github.io/apple-touch-icon.png alt aria-label=logo height=35>Yosong6729 블로그</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yosong6729.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://yosong6729.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yosong6729.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://yosong6729.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">[자바 ORM 표준 JPA 프로그래밍 - 기본편] 연관관계 매핑 기초</h1><div class=post-meta><span title='2024-09-11 16:47:33 +0900 KST'>September 11, 2024</span>&nbsp;·&nbsp;yosong6729&nbsp;|&nbsp;<a href=https://github.com/yosong6729/blog/tree/main/content/post/%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84%20%eb%a7%a4%ed%95%91%20%ea%b8%b0%ec%b4%88/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84%ea%b0%80-%ed%95%84%ec%9a%94%ed%95%9c-%ec%9d%b4%ec%9c%a0 aria-label="연관관계가 필요한 이유">연관관계가 필요한 이유</a><ul><li><a href=#%ec%98%88%ec%a0%9c-%ec%8b%9c%eb%82%98%eb%a6%ac%ec%98%a4 aria-label="예제 시나리오">예제 시나리오</a></li><li><a href=#%ea%b0%9d%ec%b2%b4%eb%a5%bc-%ed%85%8c%ec%9d%b4%eb%b8%94%ec%97%90-%eb%a7%9e%ec%b6%94%ec%96%b4-%eb%aa%a8%eb%8d%b8%eb%a7%81 aria-label="객체를 테이블에 맞추어 모델링">객체를 테이블에 맞추어 모델링</a></li></ul></li><li><a href=#%eb%8b%a8%eb%b0%a9%ed%96%a5-%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84 aria-label="단방향 연관관계">단방향 연관관계</a><ul><li><a href=#%ea%b0%9d%ec%b2%b4-%ec%a7%80%ed%96%a5-%eb%aa%a8%eb%8d%b8%eb%a7%81 aria-label="객체 지향 모델링">객체 지향 모델링</a></li></ul></li><li><a href=#%ec%96%91%eb%b0%a9%ed%96%a5-%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84%ec%99%80-%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84%ec%9d%98-%ec%a3%bc%ec%9d%b8 aria-label="양방향 연관관계와 연관관계의 주인">양방향 연관관계와 연관관계의 주인</a><ul><li><a href=#%ec%96%91%eb%b0%a9%ed%96%a5-%eb%a7%a4%ed%95%91 aria-label="양방향 매핑">양방향 매핑</a></li><li><a href=#%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84%ec%9d%98-%ec%a3%bc%ec%9d%b8%ea%b3%bc-mappedby aria-label="연관관계의 주인과 mappedBy">연관관계의 주인과 mappedBy</a></li><li><a href=#%ea%b0%9d%ec%b2%b4%ec%99%80-%ed%85%8c%ec%9d%b4%eb%b8%94%ec%9d%b4-%ea%b4%80%ea%b3%84%eb%a5%bc-%eb%a7%ba%eb%8a%94-%ec%b0%a8%ec%9d%b4 aria-label="객체와 테이블이 관계를 맺는 차이">객체와 테이블이 관계를 맺는 차이</a></li><li><a href=#%ea%b0%9d%ec%b2%b4%ec%9d%98-%ec%96%91%eb%b0%a9%ed%96%a5-%ea%b4%80%ea%b3%84 aria-label="객체의 양방향 관계">객체의 양방향 관계</a></li><li><a href=#%ed%85%8c%ec%9d%b4%eb%b8%94%ec%9d%98-%ec%96%91%eb%b0%a9%ed%96%a5-%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84 aria-label="테이블의 양방향 연관관계">테이블의 양방향 연관관계</a></li><li><a href=#%eb%91%98-%ec%a4%91-%ed%95%98%eb%82%98%eb%a1%9c-%ec%99%b8%eb%9e%98-%ed%82%a4%eb%a5%bc-%ea%b4%80%eb%a6%ac%ed%95%b4%ec%95%bc-%ed%95%9c%eb%8b%a4 aria-label="둘 중 하나로 외래 키를 관리해야 한다.">둘 중 하나로 외래 키를 관리해야 한다.</a></li><li><a href=#%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84%ec%9d%98-%ec%a3%bc%ec%9d%b8owner aria-label="연관관계의 주인(Owner)">연관관계의 주인(Owner)</a></li><li><a href=#%eb%88%84%ea%b5%ac%eb%a5%bc-%ec%a3%bc%ec%9d%b8%ec%9c%bc%eb%a1%9c aria-label="누구를 주인으로?">누구를 주인으로?</a></li><li><a href=#%ec%96%91%eb%b0%a9%ed%96%a5-%eb%a7%a4%ed%95%91%ec%8b%9c-%ea%b0%80%ec%9e%a5-%eb%a7%8e%ec%9d%b4-%ed%95%98%eb%8a%94-%ec%8b%a4%ec%88%98 aria-label="양방향 매핑시 가장 많이 하는 실수">양방향 매핑시 가장 많이 하는 실수</a></li><li><a href=#%ec%96%91%eb%b0%a9%ed%96%a5-%eb%a7%a4%ed%95%91%ec%8b%9c-%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84%ec%9d%98-%ec%a3%bc%ec%9d%b8%ec%97%90-%ea%b0%92%ec%9d%84-%ec%9e%85%eb%a0%a5%ed%95%b4%ec%95%bc-%ed%95%9c%eb%8b%a4 aria-label="양방향 매핑시 연관관계의 주인에 값을 입력해야 한다.">양방향 매핑시 연관관계의 주인에 값을 입력해야 한다.</a></li><li><a href=#%ec%96%91%eb%b0%a9%ed%96%a5-%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84-%ec%a3%bc%ec%9d%98 aria-label="양방향 연관관계 주의">양방향 연관관계 주의</a></li><li><a href=#%ec%96%91%eb%b0%a9%ed%96%a5-%eb%a7%a4%ed%95%91-%ec%a0%95%eb%a6%ac aria-label="양방향 매핑 정리">양방향 매핑 정리</a></li><li><a href=#%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84%ec%9d%98-%ec%a3%bc%ec%9d%b8%ec%9d%84-%ec%a0%95%ed%95%98%eb%8a%94-%ea%b8%b0%ec%a4%80 aria-label="연관관계의 주인을 정하는 기준">연관관계의 주인을 정하는 기준</a></li></ul></li><li><a href=#%ec%8b%a4%ec%a0%84-%ec%98%88%ec%a0%9c---2-%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84-%eb%a7%a4%ed%95%91-%ec%8b%9c%ec%9e%91 aria-label="실전 예제 - 2. 연관관계 매핑 시작">실전 예제 - 2. 연관관계 매핑 시작</a><ul><li><a href=#%ed%85%8c%ec%9d%b4%eb%b8%94-%ea%b5%ac%ec%a1%b0 aria-label="테이블 구조">테이블 구조</a></li><li><a href=#%ea%b0%9d%ec%b2%b4-%ea%b5%ac%ec%a1%b0 aria-label="객체 구조">객체 구조</a></li></ul></li></ul></div></details></div><div class=post-content><p>해당 글은 김영한님의 인프런 강의 <a href=https://www.inflearn.com/course/ORM-JPA-Basic>자바 ORM 표준 JPA 프로그래밍 - 기본편</a>을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.</p><h2 id=연관관계가-필요한-이유>연관관계가 필요한 이유<a hidden class=anchor aria-hidden=true href=#연관관계가-필요한-이유>#</a></h2><p>‘객체지향 설계의 목표는 자율적인 <strong>객체들의 협력 공동체</strong>를 만드는 것이다.’<br>– 조영호(객체지향의 사실과 오해) -</p><h3 id=예제-시나리오>예제 시나리오<a hidden class=anchor aria-hidden=true href=#예제-시나리오>#</a></h3><ul><li>회원과 팀이 있다.</li><li>회원은 하나의 팀에만 소속될 수 있다.</li><li>회원과 팀은 다대일 관계다.</li></ul><h3 id=객체를-테이블에-맞추어-모델링>객체를 테이블에 맞추어 모델링<a hidden class=anchor aria-hidden=true href=#객체를-테이블에-맞추어-모델링>#</a></h3><p><img loading=lazy src=images/%ea%b0%9d%ec%b2%b4%eb%a5%bc%20%ed%85%8c%ec%9d%b4%eb%b8%94%ec%97%90%20%eb%a7%9e%ec%b6%94%ec%96%b4%20%eb%aa%a8%eb%8d%b8%eb%a7%81.png alt=image.png></p><p>연관관계가 없는 객체이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Member</span><span class=w> </span><span class=p>{</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Id</span><span class=w> </span><span class=nd>@GeneratedValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;USERNAME&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;TEAM_ID&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>teamId</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>…</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Team</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Id</span><span class=w> </span><span class=nd>@GeneratedValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>…</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>참조 대신에 외래 키를 그대로 사용한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w> </span><span class=c1>//팀 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Team</span><span class=w> </span><span class=n>team</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>team</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;TeamA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>team</span><span class=p>);</span><span class=w> </span><span class=c1>//영속상태가 되면 무조건 pk값이 세팅되고 영속 상태가됨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=c1>//회원 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>member</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=o>**</span><span class=n>member</span><span class=p>.</span><span class=na>setTeamId</span><span class=p>(</span><span class=n>team</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=o>**</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>외래 키 식별자를 직접 다룬다.
setTeamId()로 외래 키를 다루는것은 객체지향스럽지 않다.</p><blockquote><p>식별자로 다시 조회, 객체 지향적인 방법은 아니다.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Member</span><span class=w> </span><span class=n>findMember</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>member</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//연관관계가 없음</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Team</span><span class=w> </span><span class=n>findTeam</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>Team</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>team</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w> 
</span></span></span></code></pre></div><p><strong>객체를 테이블에 맞추어 데이터 중심으로 모델링 하면, 협력 관계를 만들 수 없다</strong>.</p><ul><li><strong>테이블은 외래 키로 조인</strong>을 사용해서 연관된 테이블을 찾는다.</li><li><strong>객체는 참조</strong>를 사용해서 연관된 객체를 찾는다.</li><li>테이블과 객체 사이에는 이런 큰 간격이 있다.</li></ul><h2 id=단방향-연관관계>단방향 연관관계<a hidden class=anchor aria-hidden=true href=#단방향-연관관계>#</a></h2><h3 id=객체-지향-모델링>객체 지향 모델링<a hidden class=anchor aria-hidden=true href=#객체-지향-모델링>#</a></h3><p><strong>객체 연관관계 사용</strong></p><p><img loading=lazy src=images/%ea%b0%9d%ec%b2%b4%20%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84%20%ec%82%ac%ec%9a%a9.png alt=image.png></p><p>Member에 Team의 id가 아니라 Team의 참조값을 그대로 가져온다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Member</span><span class=w> </span><span class=p>{</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Id</span><span class=w> </span><span class=nd>@GeneratedValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;USERNAME&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=c1>//  @Column(name = &#34;TEAM_ID&#34;)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=c1>//  private Long teamId;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@ManyToOne</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@JoinColumn</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;TEAM_ID&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>Team</span><span class=w> </span><span class=n>team</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>…</span><span class=w>
</span></span></span></code></pre></div><p><strong>객체의 참조와 테이블의 외래 키를 매핑</strong><br>하나의 팀에 여러 멤버가 소속되기 때문에 private Team team;에 @ManyToOne을 사용하여 매핑해준다.<br>객체 연관관계의 Team team과 테이블 연관관계 TEAM_ID(FK)를 매핑하기 위해 @JoinColumn(name = “TEAM_ID”)를 사용하여 매핑해준다.</p><p><img loading=lazy src=images/ORM%20%eb%a7%a4%ed%95%91.png alt=image.png>
<strong>ORM 매핑</strong><br>객체의 Team과 테이블 TEAM_ID를 매핑을 하면 위 사진 처럼 된다고 이해하면 된다.</p><p><strong>연관관계 저장</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//팀 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Team</span><span class=w> </span><span class=n>team</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>team</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;TeamA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>team</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//회원 저장</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>member</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>**</span><span class=n>member</span><span class=p>.</span><span class=na>setTeam</span><span class=p>(</span><span class=n>team</span><span class=p>);</span><span class=w> </span><span class=c1>//단방향 연관관계 설정, 참조 저장**</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>member.setTeam(team)을 하게되면 jpa가 알아서 팀에서 PK값을 꺼내서 FK 값에 insert할떄 FK값을 사용한다.</p><p><strong>참조로 연관관계 조회 - 객체 그래프 탐색</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Member</span><span class=w> </span><span class=n>findMember</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>member</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//참조를 사용해서 연관관계 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Team</span><span class=w> </span><span class=n>findTeam</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>findMember</span><span class=p>.</span><span class=na>getTeam</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>findMember.getTeam()으로 findMember의 Team을 바로 가져올수 있게된다.</p><p><strong>연관관계 수정</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 새로운 팀B</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Team</span><span class=w> </span><span class=n>teamB</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>teamB</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;TeamB&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>teamB</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 회원1에 새로운 팀B 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>**</span><span class=n>member</span><span class=p>.</span><span class=na>setTeam</span><span class=p>(</span><span class=n>teamB</span><span class=p>);</span><span class=o>**</span><span class=w>
</span></span></span></code></pre></div><p>setTeam()을 사용하여 팀을 바꿀수 있고 DB의 외래키 값이 업데이트 된다. 이런 방식으로 연관관계를 수정할 수 있다.</p><h2 id=양방향-연관관계와-연관관계의-주인>양방향 연관관계와 연관관계의 주인<a hidden class=anchor aria-hidden=true href=#양방향-연관관계와-연관관계의-주인>#</a></h2><h3 id=양방향-매핑>양방향 매핑<a hidden class=anchor aria-hidden=true href=#양방향-매핑>#</a></h3><p><img loading=lazy src=images/%ec%96%91%eb%b0%a9%ed%96%a5%20%eb%a7%a4%ed%95%91.png alt=image.png></p><p>이전 예제에서는 Member가 Team을 가져서 Member에서 Team으로는 갈수 있지만 Team에서는 Member로 갈수있는 방법이 없었다. 그래서 Team에 List member를 추가해주어서 양방향으로 만들어 주었다.</p><p>테이블은 외래키 하나만 넣어주면 양쪽으로 다 볼수있다는 점이 객체 참조와 테이블의 외래키의 가장 큰 차이점이다.</p><p><strong>Member 엔티티는 단방향과 동일</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Member</span><span class=w> </span><span class=p>{</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Id</span><span class=w> </span><span class=nd>@GeneratedValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;USERNAME&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@ManyToOne</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@JoinColumn</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;TEAM_ID&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>Team</span><span class=w> </span><span class=n>team</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>…</span><span class=w>
</span></span></span></code></pre></div><p><strong>Team 엔티티는 컬렉션 추가</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Team</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Id</span><span class=w> </span><span class=nd>@GeneratedValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@OneToMany</span><span class=p>(</span><span class=n>mappedBy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;team&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>members</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>…</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>하나의 Team에는 여러 Member가 포함되어 있기 떄문에 List타입으로 member를 만들고 @OneToMany를 사용한다. members가 Member객체의 team 변수명과 연결되어 있다는 것을 (mappedBy = “team”)으로 표시한다.</p><p><strong>반대 방향으로 객체 그래프 탐색</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Team</span><span class=w> </span><span class=n>findTeam</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>Team</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>team</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>int</span><span class=w> </span><span class=n>memberSize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>findTeam</span><span class=p>.</span><span class=na>getMembers</span><span class=p>().</span><span class=na>size</span><span class=p>();</span><span class=w> </span><span class=c1>//역방향 조회</span><span class=w>
</span></span></span></code></pre></div><p>양방향 연관관계로 findTeam.getMembers()로 역방향으로 값을 가져올수 있게 된다.</p><h3 id=연관관계의-주인과-mappedby>연관관계의 주인과 mappedBy<a hidden class=anchor aria-hidden=true href=#연관관계의-주인과-mappedby>#</a></h3><ul><li>mappedBy = JPA의 멘탈붕괴 난이도</li><li>mappedBy는 처음에는 이해하기 어렵다.</li><li>객체와 테이블간에 연관관계를 맺는 차이를 이해해야 한다.</li></ul><h3 id=객체와-테이블이-관계를-맺는-차이>객체와 테이블이 관계를 맺는 차이<a hidden class=anchor aria-hidden=true href=#객체와-테이블이-관계를-맺는-차이>#</a></h3><ul><li>객체 연관관계 = 2개<ul><li>회원 -> 팀 연관관계 1개(단방향)</li><li>팀 -> 회원 연관관계 1개(단방향)</li></ul></li><li>테이블 연관관계 = 1개<ul><li>회원 ↔ 팀의 연관관계 1개(양방향)</li></ul></li></ul><p><img loading=lazy src=images/%ea%b0%9d%ec%b2%b4%ec%99%80%20%ed%85%8c%ec%9d%b4%eb%b8%94%ec%9d%b4%20%ea%b4%80%ea%b3%84%eb%a5%bc%20%eb%a7%ba%eb%8a%94%20%ec%b0%a8%ec%9d%b4.png alt=image.png></p><h3 id=객체의-양방향-관계>객체의 양방향 관계<a hidden class=anchor aria-hidden=true href=#객체의-양방향-관계>#</a></h3><ul><li>객체의 <strong>양방향 관계는 사실 양방향 관계가 아니라 서로 다른 단방향 관계 2개다.</strong></li><li>객체를 양방향으로 참조하려면 <strong>단방향 연관관계를 2개</strong> 만들어야 한다.</li><li>A → B (a.getB())</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>A</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>B</span><span class=w> </span><span class=n>b</span><span class=p>;</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>B → A (b.geA())</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>B</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>A</span><span class=w> </span><span class=n>a</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=테이블의-양방향-연관관계>테이블의 양방향 연관관계<a hidden class=anchor aria-hidden=true href=#테이블의-양방향-연관관계>#</a></h3><ul><li>테이블은 <strong>외래 키 하나</strong>로 두 테이블의 연관관계를 관리</li><li>MEMBER.TEAM_ID 외래 키 하나로 양방향 연관관계 가짐(양쪽으로 조인할 수 있다.)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>MEMBER</span><span class=w> </span><span class=n>M</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>TEAM</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>M</span><span class=p>.</span><span class=n>TEAM_ID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>T</span><span class=p>.</span><span class=n>TEAM_ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=err>반대</span><span class=w> </span><span class=err>가능</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>TEAM</span><span class=w> </span><span class=n>T</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>JOIN</span><span class=w> </span><span class=n>MEMBER</span><span class=w> </span><span class=n>M</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>T</span><span class=p>.</span><span class=n>TEAM_ID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>M</span><span class=p>.</span><span class=n>TEAM_ID</span><span class=w>
</span></span></span></code></pre></div><h3 id=둘-중-하나로-외래-키를-관리해야-한다>둘 중 하나로 외래 키를 관리해야 한다.<a hidden class=anchor aria-hidden=true href=#둘-중-하나로-외래-키를-관리해야-한다>#</a></h3><p><img loading=lazy src=images/%ec%99%b8%eb%9e%98%ed%82%a4%20%ea%b4%80%eb%a6%ac.png alt="외래키 주인"></p><p>내가 멤버를 바꾸고 싶거나 다른 새로운 팀에 들어가고 싶을때 멤버의 팀의 값을 바꿔야 될지, 팀에 있는 List members를 바꿔야 할지 고민이다.</p><p>이런 고민을 덜기 위해서 둘 중 하나를 주인을 정하는 것이 <strong>연관관계의 주인</strong>이다.</p><h3 id=연관관계의-주인owner>연관관계의 주인(Owner)<a hidden class=anchor aria-hidden=true href=#연관관계의-주인owner>#</a></h3><p><strong>양방향 매핑 규칙</strong></p><ul><li>객체의 두 관계중 하나를 연관관계의 주인으로 지정</li><li><strong>연관관계의 주인만이 외래 키를 관리(등록, 수정)</strong></li><li><strong>주인이 아닌쪽은 읽기만 가능</strong></li><li>주인은 mappedBy 속성 사용X</li><li><strong>주인이 아니면 mappedBy 속성으로 주인 지정</strong></li></ul><h3 id=누구를-주인으로>누구를 주인으로?<a hidden class=anchor aria-hidden=true href=#누구를-주인으로>#</a></h3><ul><li><strong>외래 키가 있는 있는 곳을 주인으로 정해라</strong></li><li>여기서는 Member.team이 연관관계의 주인</li></ul><p><img loading=lazy src=images/%ec%99%b8%eb%9e%98%ed%82%a4%20%ec%a3%bc%ec%9d%b8.png alt=image.png></p><p>List members에 값을 넣어도 변화가 생기지 않고 값을 조회하는 것은 가능하다. DB에 없데이트 하거나 값을 넣을 경우에 Member 객체의 Team team을 참조한다.</p><h3 id=양방향-매핑시-가장-많이-하는-실수>양방향 매핑시 가장 많이 하는 실수<a hidden class=anchor aria-hidden=true href=#양방향-매핑시-가장-많이-하는-실수>#</a></h3><p>연관 관계의 주인에 값을 입력하지 않는다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Team</span><span class=w> </span><span class=n>team</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>team</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;TeamA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>team</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>member</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//역방향(주인이 아닌 방향)만 연관관계 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>team</span><span class=p>.</span><span class=na>getMembers</span><span class=p>().</span><span class=na>add</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=images/%ec%96%91%eb%b0%a9%ed%96%a5%20%eb%a7%a4%ed%95%91%20%ec%8b%a4%ec%88%98.png alt=image.png></p><p>역방향(주인이 아닌 방향)에만 member를 추가하게 된다면 DB에는 Member의 Team이 저장 되지 않는다.</p><h3 id=양방향-매핑시-연관관계의-주인에-값을-입력해야-한다>양방향 매핑시 연관관계의 주인에 값을 입력해야 한다.<a hidden class=anchor aria-hidden=true href=#양방향-매핑시-연관관계의-주인에-값을-입력해야-한다>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Team</span><span class=w> </span><span class=n>team</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Team</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>team</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;TeamA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>team</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>member</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>team</span><span class=p>.</span><span class=na>getMembers</span><span class=p>().</span><span class=na>add</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//연관관계의 주인에 값 설정 </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>member</span><span class=p>.</span><span class=na>setTeam</span><span class=p>(</span><span class=n>team</span><span class=p>);</span><span class=w> </span><span class=c1>//**</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p><img loading=lazy src=images/%ec%97%b0%ea%b4%80%ea%b4%80%ea%b3%84%ec%9d%98%20%ec%a3%bc%ec%9d%b8%20%ec%9e%85%eb%a0%a5.png alt=image.png></p><p>연관관계의 주인에 값을 설정하게 되면 DB에 값이 저장된다.</p><blockquote><p>순수한 객체 관계를 고려하면 항상 양쪽다 값을 입력해야 한다.</p></blockquote><h3 id=양방향-연관관계-주의>양방향 연관관계 주의<a hidden class=anchor aria-hidden=true href=#양방향-연관관계-주의>#</a></h3><ul><li><strong>순수 객체 상태를 고려해서 항상 양쪽에 값을 설정하자</strong></li><li>연관관계 편의 메소드를 생성하자</li><li>양방향 매핑시 무한 루프를 조심하자<ul><li>예: toString(), lombok, JSON 생성 라이브러리</li></ul></li></ul><h3 id=양방향-매핑-정리>양방향 매핑 정리<a hidden class=anchor aria-hidden=true href=#양방향-매핑-정리>#</a></h3><ul><li><strong>단방향 매핑만으로도 이미 연관관계 매핑은 완료</strong></li><li>양방향 매핑은 반대 방향으로 조회(객체 그래프 탐색) 기능이 추가 된 것 뿐</li><li>JPQL에서 역방향으로 탐색할 일이 많음</li><li>단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨(테이블에 영향을 주지 않음)</li></ul><h3 id=연관관계의-주인을-정하는-기준>연관관계의 주인을 정하는 기준<a hidden class=anchor aria-hidden=true href=#연관관계의-주인을-정하는-기준>#</a></h3><ul><li>비즈니스 로직을 기준으로 연관관계의 주인을 선택하면 안됨</li><li><strong>연관관계의 주인은 외래 키의 위치를기준으로 정해야함</strong></li></ul><h2 id=실전-예제---2-연관관계-매핑-시작>실전 예제 - 2. 연관관계 매핑 시작<a hidden class=anchor aria-hidden=true href=#실전-예제---2-연관관계-매핑-시작>#</a></h2><h3 id=테이블-구조>테이블 구조<a hidden class=anchor aria-hidden=true href=#테이블-구조>#</a></h3><p><img loading=lazy src=images/%ed%85%8c%ec%9d%b4%eb%b8%94%20%ea%b5%ac%ec%a1%b0.png alt=image.png></p><p>테이블 구조는 이전과 같다.</p><h3 id=객체-구조>객체 구조<a hidden class=anchor aria-hidden=true href=#객체-구조>#</a></h3><p><img loading=lazy src=images/%ea%b0%9d%ec%b2%b4%20%ea%b5%ac%ec%a1%b0.png alt=image.png></p><p>참조를 사용하도록 변경한다.</p><blockquote><p>예제 코드는 김영한님의 인프런 강의 <a href=https://www.inflearn.com/course/ORM-JPA-Basic>자바 ORM 표준 JPA 프로그래밍 - 기본편</a>에서 확인 할수 있습니다.</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://yosong6729.github.io/tags/jpa/>JPA</a></li></ul><nav class=paginav><a class=prev href=https://yosong6729.github.io/post/%EB%8B%A4%EC%96%91%ED%95%9C-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91/><span class=title>« Prev</span><br><span>[자바 ORM 표준 JPA 프로그래밍 - 기본편] 다양한 연관관계 매핑</span>
</a><a class=next href=https://yosong6729.github.io/post/%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%A7%A4%ED%95%91/><span class=title>Next »</span><br><span>[자바 ORM 표준 JPA 프로그래밍 - 기본편] 엔티티 매핑</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://yosong6729.github.io/>Yosong6729 Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>