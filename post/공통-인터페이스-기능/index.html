<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>공통 인터페이스 기능 | Yosong6729 Blog</title>
<meta name=keywords content="spring data JPA"><meta name=description content="해당 글은 김영한님의 인프런 강의 실전! 스프링 데이터 JPA을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
예제 도메인 모델을 엔티티 클래스와 ERD만 확인하고 넘어가겠다.
순수 JPA 기반 리포지토리 만들기 기본 CRUD 저장 변경 → 변경 감지 사용 삭제 전체 조회f 단건 조회 카운트 JPA에서 수정은 변경감지 기능을 사용하면 된다. 트랜잭션 안에서 엔티티를 조회한 다음에 데이터를 변경하면, 트랜잭션 종료 시점에 변경감지 기능이 작동해서 변경된 엔티티를 감지하고 UPDATE SQL을 실행한다."><meta name=author content="yosong6729"><link rel=canonical href=https://yosong6729.github.io/post/%EA%B3%B5%ED%86%B5-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4-%EA%B8%B0%EB%8A%A5/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://yosong6729.github.io/post/%EA%B3%B5%ED%86%B5-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4-%EA%B8%B0%EB%8A%A5/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="공통 인터페이스 기능"><meta property="og:description" content="해당 글은 김영한님의 인프런 강의 실전! 스프링 데이터 JPA을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
예제 도메인 모델을 엔티티 클래스와 ERD만 확인하고 넘어가겠다.
순수 JPA 기반 리포지토리 만들기 기본 CRUD 저장 변경 → 변경 감지 사용 삭제 전체 조회f 단건 조회 카운트 JPA에서 수정은 변경감지 기능을 사용하면 된다. 트랜잭션 안에서 엔티티를 조회한 다음에 데이터를 변경하면, 트랜잭션 종료 시점에 변경감지 기능이 작동해서 변경된 엔티티를 감지하고 UPDATE SQL을 실행한다."><meta property="og:type" content="article"><meta property="og:url" content="https://yosong6729.github.io/post/%EA%B3%B5%ED%86%B5-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4-%EA%B8%B0%EB%8A%A5/"><meta property="og:image" content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-09-29T20:01:38+09:00"><meta property="article:modified_time" content="2024-09-29T20:01:38+09:00"><meta property="og:site_name" content="Yosong6729 Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="공통 인터페이스 기능"><meta name=twitter:description content="해당 글은 김영한님의 인프런 강의 실전! 스프링 데이터 JPA을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
예제 도메인 모델을 엔티티 클래스와 ERD만 확인하고 넘어가겠다.
순수 JPA 기반 리포지토리 만들기 기본 CRUD 저장 변경 → 변경 감지 사용 삭제 전체 조회f 단건 조회 카운트 JPA에서 수정은 변경감지 기능을 사용하면 된다. 트랜잭션 안에서 엔티티를 조회한 다음에 데이터를 변경하면, 트랜잭션 종료 시점에 변경감지 기능이 작동해서 변경된 엔티티를 감지하고 UPDATE SQL을 실행한다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yosong6729.github.io/post/"},{"@type":"ListItem","position":2,"name":"공통 인터페이스 기능","item":"https://yosong6729.github.io/post/%EA%B3%B5%ED%86%B5-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4-%EA%B8%B0%EB%8A%A5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"공통 인터페이스 기능","name":"공통 인터페이스 기능","description":"해당 글은 김영한님의 인프런 강의 실전! 스프링 데이터 JPA을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n예제 도메인 모델을 엔티티 클래스와 ERD만 확인하고 넘어가겠다.\n순수 JPA 기반 리포지토리 만들기 기본 CRUD 저장 변경 → 변경 감지 사용 삭제 전체 조회f 단건 조회 카운트 JPA에서 수정은 변경감지 기능을 사용하면 된다. 트랜잭션 안에서 엔티티를 조회한 다음에 데이터를 변경하면, 트랜잭션 종료 시점에 변경감지 기능이 작동해서 변경된 엔티티를 감지하고 UPDATE SQL을 실행한다.","keywords":["spring data JPA"],"articleBody":" 해당 글은 김영한님의 인프런 강의 실전! 스프링 데이터 JPA을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n예제 도메인 모델을 엔티티 클래스와 ERD만 확인하고 넘어가겠다.\n순수 JPA 기반 리포지토리 만들기 기본 CRUD 저장 변경 → 변경 감지 사용 삭제 전체 조회f 단건 조회 카운트 JPA에서 수정은 변경감지 기능을 사용하면 된다. 트랜잭션 안에서 엔티티를 조회한 다음에 데이터를 변경하면, 트랜잭션 종료 시점에 변경감지 기능이 작동해서 변경된 엔티티를 감지하고 UPDATE SQL을 실행한다.\n순수 JPA 기반 리포지토리 - 회원\n@Repository public class MemberJpaRepository { @PersistenceContext private EntityManager em; public Member save(Member member) { em.persist(member); return member; } public void delete(Member member) { em.remove(member); } public List\u003cMember\u003e findAll() { return em.createQuery(\"select m from Member m\", Member.class) .getResultList(); } public Optional\u003cMember\u003e findById(Long id) { Member member = em.find(Member.class, id); return Optional.ofNullable(member); } public long count() { return em.createQuery(\"select count(m) from Member m\", Long.class) .getSingleResult(); } public Member find(Long id) { return em.find(Member.class, id); } } 순수 JPA 기반 리포지토리 - 팀\n@Repository public class TeamJpaRepository { @PersistenceContext private EntityManager em; public Team save(Team team) { em.persist(team); return team; } public void delete(Team team) { em.remove(team); } public List\u003cTeam\u003e findAll() { return em.createQuery(\"select t from Team t\", Team.class) .getResultList(); } public Optional\u003cTeam\u003e findById(Long id) { Team team = em.find(Team.class, id); return Optional.ofNullable(team); } public long count() { return em.createQuery(\"select count(t) from Team t\", Long.class) .getSingleResult(); } } 회원 리포지토리와 거의 동일하다\n순수 JPA 기반 리포지토리 테스트\n@SpringBootTest @Transactional @Rollback(value = false) class MemberJpaRepositoryTest { @Autowired MemberJpaRepository memberJpaRepository; @Test public void testMember() throws Exception{ //given Member member = new Member(\"memberA\"); //when Member savedMember = memberJpaRepository.save(member); Member findMember = memberJpaRepository.find(savedMember.getId()); //then assertThat(findMember.getId()).isEqualTo(member.getId()); assertThat(findMember.getUsername()).isEqualTo(member.getUsername()); assertThat(findMember).isEqualTo(member); } @Test public void basicCRUD() throws Exception{ //given Member member1 = new Member(\"member1\"); Member member2 = new Member(\"member2\"); memberJpaRepository.save(member1); memberJpaRepository.save(member2); //단건 조회 검증 Member findMember1 = memberJpaRepository.findById(member1.getId()).get(); Member findMember2 = memberJpaRepository.findById(member2.getId()).get(); assertThat(findMember1).isEqualTo(member1); assertThat(findMember2).isEqualTo(member2); //리스트 조회 검증 List\u003cMember\u003e all = memberJpaRepository.findAll(); assertThat(all.size()).isEqualTo(2); //카운트 검증 long count = memberJpaRepository.count(); assertThat(count).isEqualTo(2); //삭제 검증 memberJpaRepository.delete(member1); memberJpaRepository.delete(member2); long deletedCount = memberJpaRepository.count(); assertThat(deletedCount).isEqualTo(0); } } 위 테스트를 통해서 기본 CRUD를 검증한다.\n공통 인터페이스 설정 JavaConfig 설정(스프링 부트 사용시 생략 가능)\n@Configuration @EnableJpaRepositories(basePackages = \"jpabook.jpashop.repository\") public class AppConfig {} 스프링 부트를 사용하면 @SpringBootApplication 위치를 지정하여 해당 패키지와 하위 패키지를 인식한다. @SpringBootApplication은 대부분 최상단에 위치해 있기 때문에 대부분 스캔 대상이 된다.\n만약 위치가 달라지면 @EnableJpaRepositories가 필요하다.\n스프링 데이터 JPA가 구현 클래스 대신 생성\norg.springframework.data.repository.Repository 를 구현한 클래스는 스캔 대상이다 Spring Data JPA가 JpaRepository를 상속한것이 있으면 구현체를 대신 만들어준다. memberRepository.getClass()의 결과는 아래와 같다. Spring Data JPA가 프록시로 구현 클래스를 만들어서 주입해준것이다.\n@Repository 애노테이션은 생략 가능하다. 컴포넌트 스캔을 스프링 데이터 JPA가 자동으로 처리 JPA 예외를 스프링 예외로 변환하는 과정도 자동으로 처리 공통 인터페이스 적용 위에서 작성했던 순수 JPA로 구현한 MemberJpaRepository 대신에 스프링 데이터 JPA가 제공하는 공통 인터페이스를 사용한다.\n스프링 데이터 JPA 기반 MemberRepository\npublic interface MemberRepository extends JpaRepository\u003cMember, Long\u003e { } MemberRepository 테스트\n@SpringBootTest @Transactional @Rollback(value = false) class MemberRepositoryTest { @Autowired MemberRepository memberRepository; @Test public void testMember() { Member member = new Member(\"memberA\"); Member savedMember = memberRepository.save(member); Member findMember = memberRepository.findById(savedMember.getId()).get(); assertThat(findMember.getId()).isEqualTo(member.getId()); assertThat(findMember.getId()).isEqualTo(member.getId()); assertThat(findMember).isEqualTo(member); } @Test public void basicCRUD() throws Exception{ //given Member member1 = new Member(\"member1\"); Member member2 = new Member(\"member2\"); memberRepository.save(member1); memberRepository.save(member2); //단건 조회 검증 Member findMember1 = memberRepository.findById(member1.getId()).get(); Member findMember2 = memberRepository.findById(member2.getId()).get(); assertThat(findMember1).isEqualTo(member1); assertThat(findMember2).isEqualTo(member2); //리스트 조회 검증 List\u003cMember\u003e all = memberRepository.findAll(); assertThat(all.size()).isEqualTo(2); //카운트 검증 long count = memberRepository.count(); assertThat(count).isEqualTo(2); //삭제 검증 memberRepository.delete(member1); memberRepository.delete(member2); long deletedCount = memberRepository.count(); assertThat(deletedCount).isEqualTo(0); } } 기존 순수 JPA 기반 테스트에서 사용했던 코드를 그대로 스프링 데이터 JPA 리포지토리에 사용해도 동일한 방식으로 동작한다.\nTeamRepository 생성\npublic interface TeamRepository extends JpaRepository\u003cTeam, Long\u003e { } TeamRepository의 테스트는 위와 동일하기 때문에 생략한다.\nGeneric T는 엔티티 타입, ID는 식별자 타입(PK)이다.\n공통 인터페이스 분석 JpaRepository 인터페이스: 공통 CRUD 제공 제네릭은 \u003c엔티티 타입, 식별자 타입\u003e 설정 공통 인터페이스 구성\nRepository, CrudRepository, PagingAndSortingRepository 인터페이스는 스프링 데이터의 공통 부분이ㅏ.\nJpaRepository 인터페이스는 JPA의 특화된 기능을 제공한다.\n주의\nT findOne(ID) → Optional findById(ID) 변경 boolean exists(ID) → boolean existsById(ID) 변경 제네릭 타입\nT: 엔티티 ID: 엔티티의 식별자 타입 S: 엔티티와 그 자식 타입 주요 메서드\nsave(S): 새로운 엔티티는 저장하고 이미 있는 엔티티는 병합한다. delete(T): 엔티티 하나를 삭제한다. 내부에서 EntityManager.remove() 호출 findById(ID): 엔티티 하나를 조회한다. 내붕서 EntityManger.find() 호출 getOne(ID): 엔티티를 프록시로 조회한다. 내부에서 EntityManger.getReference() 호출 findAll(…): 모든 엔티티를 조회한다. 정렬(Sort)이나 페이징(Pageable)조건을 파라미터로 제공할 수 있다. ","wordCount":"691","inLanguage":"en","image":"https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-09-29T20:01:38+09:00","dateModified":"2024-09-29T20:01:38+09:00","author":{"@type":"Person","name":"yosong6729"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yosong6729.github.io/post/%EA%B3%B5%ED%86%B5-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4-%EA%B8%B0%EB%8A%A5/"},"publisher":{"@type":"Organization","name":"Yosong6729 Blog","logo":{"@type":"ImageObject","url":"https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yosong6729.github.io/ accesskey=h title="Yosong6729 블로그 (Alt + H)"><img src=https://yosong6729.github.io/apple-touch-icon.png alt aria-label=logo height=35>Yosong6729 블로그</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yosong6729.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://yosong6729.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yosong6729.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://yosong6729.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">공통 인터페이스 기능</h1><div class=post-meta><span title='2024-09-29 20:01:38 +0900 KST'>September 29, 2024</span>&nbsp;·&nbsp;yosong6729&nbsp;|&nbsp;<a href=https://github.com/yosong6729/blog/tree/main/content/post/%ea%b3%b5%ed%86%b5%20%ec%9d%b8%ed%84%b0%ed%8e%98%ec%9d%b4%ec%8a%a4%20%ea%b8%b0%eb%8a%a5/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%ec%88%9c%ec%88%98-jpa-%ea%b8%b0%eb%b0%98-%eb%a6%ac%ed%8f%ac%ec%a7%80%ed%86%a0%eb%a6%ac-%eb%a7%8c%eb%93%a4%ea%b8%b0 aria-label="순수 JPA 기반 리포지토리 만들기">순수 JPA 기반 리포지토리 만들기</a></li><li><a href=#%ea%b3%b5%ed%86%b5-%ec%9d%b8%ed%84%b0%ed%8e%98%ec%9d%b4%ec%8a%a4-%ec%84%a4%ec%a0%95 aria-label="공통 인터페이스 설정">공통 인터페이스 설정</a><ul><li><a href=#%ea%b3%b5%ed%86%b5-%ec%9d%b8%ed%84%b0%ed%8e%98%ec%9d%b4%ec%8a%a4-%ec%a0%81%ec%9a%a9 aria-label="공통 인터페이스 적용">공통 인터페이스 적용</a></li></ul></li><li><a href=#%ea%b3%b5%ed%86%b5-%ec%9d%b8%ed%84%b0%ed%8e%98%ec%9d%b4%ec%8a%a4-%eb%b6%84%ec%84%9d aria-label="공통 인터페이스 분석">공통 인터페이스 분석</a></li></ul></div></details></div><div class=post-content><blockquote><p>해당 글은 김영한님의 인프런 강의 <a href=https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%8D%B0%EC%9D%B4%ED%84%B0-JPA-%EC%8B%A4%EC%A0%84>실전! 스프링 데이터 JPA</a>을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.</p></blockquote><hr><p>예제 도메인 모델을 엔티티 클래스와 ERD만 확인하고 넘어가겠다.</p><p><img loading=lazy src=images/image.png alt=image.png></p><hr><h2 id=순수-jpa-기반-리포지토리-만들기>순수 JPA 기반 리포지토리 만들기<a hidden class=anchor aria-hidden=true href=#순수-jpa-기반-리포지토리-만들기>#</a></h2><ul><li>기본 CRUD<ul><li>저장</li><li>변경 → 변경 감지 사용</li><li>삭제</li><li>전체 조회f</li><li>단건 조회</li><li>카운트</li></ul></li></ul><blockquote><p>JPA에서 수정은 변경감지 기능을 사용하면 된다.
트랜잭션 안에서 엔티티를 조회한 다음에 데이터를 변경하면, 트랜잭션 종료 시점에 변경감지 기능이 작동해서 변경된 엔티티를 감지하고 UPDATE SQL을 실행한다.</p></blockquote><p><strong>순수 JPA 기반 리포지토리 - 회원</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberJpaRepository</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PersistenceContext</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>EntityManager</span><span class=w> </span><span class=n>em</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>member</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>em</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAll</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;select m from Member m&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findById</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Optional</span><span class=p>.</span><span class=na>ofNullable</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=nf>count</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;select count(m) from Member m&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getSingleResult</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=nf>find</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>Member</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>순수 JPA 기반 리포지토리 - 팀</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TeamJpaRepository</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PersistenceContext</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>EntityManager</span><span class=w> </span><span class=n>em</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Team</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=n>Team</span><span class=w> </span><span class=n>team</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>em</span><span class=p>.</span><span class=na>persist</span><span class=p>(</span><span class=n>team</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>team</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=n>Team</span><span class=w> </span><span class=n>team</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>em</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>team</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Team</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAll</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;select t from Team t&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Team</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getResultList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Team</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findById</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Team</span><span class=w> </span><span class=n>team</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>Team</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Optional</span><span class=p>.</span><span class=na>ofNullable</span><span class=p>(</span><span class=n>team</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=nf>count</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>em</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=s>&#34;select count(t) from Team t&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>getSingleResult</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>회원 리포지토리와 거의 동일하다</p><p><strong>순수 JPA 기반 리포지토리 테스트</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Rollback</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>MemberJpaRepositoryTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MemberJpaRepository</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testMember</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;memberA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//when</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>savedMember</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>findMember</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>find</span><span class=p>(</span><span class=n>savedMember</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember</span><span class=p>.</span><span class=na>getUsername</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>getUsername</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>basicCRUD</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>member1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>member2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>member1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>member2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//단건 조회 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>findMember1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>member1</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>findMember2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>member2</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember1</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember2</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//리스트 조회 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>all</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>all</span><span class=p>.</span><span class=na>size</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//카운트 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>count</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>count</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//삭제 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>delete</span><span class=p>(</span><span class=n>member1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>delete</span><span class=p>(</span><span class=n>member2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>deletedCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberJpaRepository</span><span class=p>.</span><span class=na>count</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>deletedCount</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>위 테스트를 통해서 기본 CRUD를 검증한다.</p><hr><h2 id=공통-인터페이스-설정>공통 인터페이스 설정<a hidden class=anchor aria-hidden=true href=#공통-인터페이스-설정>#</a></h2><p><strong>JavaConfig 설정(스프링 부트 사용시 생략 가능)</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w> </span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nd>@EnableJpaRepositories</span><span class=p>(</span><span class=n>basePackages</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;jpabook.jpashop.repository&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AppConfig</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span></code></pre></div><p>스프링 부트를 사용하면 @SpringBootApplication 위치를 지정하여 해당 패키지와 하위 패키지를 인식한다. @SpringBootApplication은 대부분 최상단에 위치해 있기 때문에 대부분 스캔 대상이 된다.</p><p>만약 위치가 달라지면 @EnableJpaRepositories가 필요하다.</p><p><strong>스프링 데이터 JPA가 구현 클래스 대신 생성</strong></p><p><img loading=lazy src=images/image%201.png alt=image.png></p><ul><li>org.springframework.data.repository.Repository 를 구현한 클래스는 스캔 대상이다</li><li>Spring Data JPA가 JpaRepository를 상속한것이 있으면 구현체를 대신 만들어준다.</li><li>memberRepository.getClass()의 결과는 아래와 같다.</li></ul><p><img loading=lazy src=images/image%202.png alt=image.png></p><p>Spring Data JPA가 프록시로 구현 클래스를 만들어서 주입해준것이다.</p><ul><li>@Repository 애노테이션은 생략 가능하다.<ul><li>컴포넌트 스캔을 스프링 데이터 JPA가 자동으로 처리</li><li>JPA 예외를 스프링 예외로 변환하는 과정도 자동으로 처리</li></ul></li></ul><hr><h3 id=공통-인터페이스-적용>공통 인터페이스 적용<a hidden class=anchor aria-hidden=true href=#공통-인터페이스-적용>#</a></h3><p>위에서 작성했던 순수 JPA로 구현한 MemberJpaRepository 대신에 스프링 데이터 JPA가 제공하는 공통 인터페이스를 사용한다.</p><p><strong>스프링 데이터 JPA 기반 MemberRepository</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>MemberRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Member</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p><strong>MemberRepository 테스트</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Rollback</span><span class=p>(</span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>MemberRepositoryTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MemberRepository</span><span class=w> </span><span class=n>memberRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testMember</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;memberA&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>savedMember</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>findMember</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>savedMember</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>basicCRUD</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>member1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>member2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>(</span><span class=s>&#34;member2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>member1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>member2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//단건 조회 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>findMember1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>member1</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>findMember2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>member2</span><span class=p>.</span><span class=na>getId</span><span class=p>()).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember1</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>findMember2</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>member2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//리스트 조회 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>all</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>all</span><span class=p>.</span><span class=na>size</span><span class=p>()).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//카운트 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>count</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>count</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//삭제 검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>delete</span><span class=p>(</span><span class=n>member1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>delete</span><span class=p>(</span><span class=n>member2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>deletedCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>count</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>assertThat</span><span class=p>(</span><span class=n>deletedCount</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>기존 순수 JPA 기반 테스트에서 사용했던 코드를 그대로 스프링 데이터 JPA 리포지토리에 사용해도 동일한 방식으로 동작한다.</p><p><strong>TeamRepository 생성</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>TeamRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Team</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>TeamRepository의 테스트는 위와 동일하기 때문에 생략한다.</p><p>Generic T는 엔티티 타입, ID는 식별자 타입(PK)이다.</p><hr><h2 id=공통-인터페이스-분석>공통 인터페이스 분석<a hidden class=anchor aria-hidden=true href=#공통-인터페이스-분석>#</a></h2><ul><li>JpaRepository 인터페이스: 공통 CRUD 제공</li><li>제네릭은 &lt;엔티티 타입, 식별자 타입> 설정</li></ul><p><strong>공통 인터페이스 구성</strong></p><p><img loading=lazy src=images/image%203.png alt=image.png></p><p>Repository, CrudRepository, PagingAndSortingRepository 인터페이스는 스프링 데이터의 공통 부분이ㅏ.</p><p>JpaRepository 인터페이스는 JPA의 특화된 기능을 제공한다.</p><p><strong>주의</strong></p><ul><li>T findOne(ID) → Optional findById(ID) 변경</li><li>boolean exists(ID) → boolean existsById(ID) 변경</li></ul><p><strong>제네릭 타입</strong></p><ul><li>T: 엔티티</li><li>ID: 엔티티의 식별자 타입</li><li>S: 엔티티와 그 자식 타입</li></ul><p><strong>주요 메서드</strong></p><ul><li>save(S): 새로운 엔티티는 저장하고 이미 있는 엔티티는 병합한다.</li><li>delete(T): 엔티티 하나를 삭제한다. 내부에서 EntityManager.remove() 호출</li><li>findById(ID): 엔티티 하나를 조회한다. 내붕서 EntityManger.find() 호출</li><li>getOne(ID): 엔티티를 프록시로 조회한다. 내부에서 EntityManger.getReference() 호출</li><li>findAll(…): 모든 엔티티를 조회한다. 정렬(Sort)이나 페이징(Pageable)조건을 파라미터로 제공할 수 있다.</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://yosong6729.github.io/tags/spring-data-jpa/>Spring Data JPA</a></li></ul><nav class=paginav><a class=next href=https://yosong6729.github.io/post/osiv-%EC%84%B1%EB%8A%A5%EA%B3%BC-%EC%B5%9C%EC%A0%81%ED%99%94/><span class=title>Next »</span><br><span>OSIV 성능과 최적화</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://yosong6729.github.io/>Yosong6729 Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>