<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>API 개발 기본 | Yosong6729 Blog</title>
<meta name=keywords content="spring boot,JPA"><meta name=description content='해당 글은 김영한님의 인프런 강의 스프링부트와 JPA활용2 - API 개발과 성능 최적화을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
회원 등록 API 회원 등록 API
@RestController @RequiredArgsConstructor public class MemberApiController { private final MemberService memberService; @PostMapping("/api/v1/members") public CreateMemberResponse saveMemberV1(@RequestBody @Valid Member member) { Long id = memberService.join(member); return new CreateMemberResponse(id); } @Data static class CreateMemberRequest { private String name; } @Data static class CreateMemberResponse { private Long id; public CreateMemberResponse(Long id) { this.'><meta name=author content="yosong6729"><link rel=canonical href=https://yosong6729.github.io/post/api-%EA%B0%9C%EB%B0%9C-%EA%B8%B0%EB%B3%B8/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://yosong6729.github.io/post/api-%EA%B0%9C%EB%B0%9C-%EA%B8%B0%EB%B3%B8/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="API 개발 기본"><meta property="og:description" content='해당 글은 김영한님의 인프런 강의 스프링부트와 JPA활용2 - API 개발과 성능 최적화을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
회원 등록 API 회원 등록 API
@RestController @RequiredArgsConstructor public class MemberApiController { private final MemberService memberService; @PostMapping("/api/v1/members") public CreateMemberResponse saveMemberV1(@RequestBody @Valid Member member) { Long id = memberService.join(member); return new CreateMemberResponse(id); } @Data static class CreateMemberRequest { private String name; } @Data static class CreateMemberResponse { private Long id; public CreateMemberResponse(Long id) { this.'><meta property="og:type" content="article"><meta property="og:url" content="https://yosong6729.github.io/post/api-%EA%B0%9C%EB%B0%9C-%EA%B8%B0%EB%B3%B8/"><meta property="og:image" content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-09-23T16:35:17+09:00"><meta property="article:modified_time" content="2024-09-23T16:35:17+09:00"><meta property="og:site_name" content="Yosong6729 Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="API 개발 기본"><meta name=twitter:description content='해당 글은 김영한님의 인프런 강의 스프링부트와 JPA활용2 - API 개발과 성능 최적화을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.
회원 등록 API 회원 등록 API
@RestController @RequiredArgsConstructor public class MemberApiController { private final MemberService memberService; @PostMapping("/api/v1/members") public CreateMemberResponse saveMemberV1(@RequestBody @Valid Member member) { Long id = memberService.join(member); return new CreateMemberResponse(id); } @Data static class CreateMemberRequest { private String name; } @Data static class CreateMemberResponse { private Long id; public CreateMemberResponse(Long id) { this.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yosong6729.github.io/post/"},{"@type":"ListItem","position":2,"name":"API 개발 기본","item":"https://yosong6729.github.io/post/api-%EA%B0%9C%EB%B0%9C-%EA%B8%B0%EB%B3%B8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"API 개발 기본","name":"API 개발 기본","description":"해당 글은 김영한님의 인프런 강의 스프링부트와 JPA활용2 - API 개발과 성능 최적화을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n회원 등록 API 회원 등록 API\n@RestController @RequiredArgsConstructor public class MemberApiController { private final MemberService memberService; @PostMapping(\u0026#34;/api/v1/members\u0026#34;) public CreateMemberResponse saveMemberV1(@RequestBody @Valid Member member) { Long id = memberService.join(member); return new CreateMemberResponse(id); } @Data static class CreateMemberRequest { private String name; } @Data static class CreateMemberResponse { private Long id; public CreateMemberResponse(Long id) { this.","keywords":["spring boot","JPA"],"articleBody":" 해당 글은 김영한님의 인프런 강의 스프링부트와 JPA활용2 - API 개발과 성능 최적화을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.\n회원 등록 API 회원 등록 API\n@RestController @RequiredArgsConstructor public class MemberApiController { private final MemberService memberService; @PostMapping(\"/api/v1/members\") public CreateMemberResponse saveMemberV1(@RequestBody @Valid Member member) { Long id = memberService.join(member); return new CreateMemberResponse(id); } @Data static class CreateMemberRequest { private String name; } @Data static class CreateMemberResponse { private Long id; public CreateMemberResponse(Long id) { this.id = id; } } } V1 : 엔티티를 Request Body에 직접 매핑 문제점 엔티티에 프레젠테이션 계층을 위한 로직이 추가된다. @NotEmpty 같은 검증을 위한 로직이 엔티티에 들어간다. 회원 엔티티를 위한 API가 다양하게 만들어 지는데, 한 엔티티에 각각의 API를 위한 모든 요청 요구사항을 담기는 어렵다. 엔티티가 변경되면 API 스펙이 변경된다. 결론 API 요청 스펙에 맞추어 별도의 DTO를 파라미터로 받는다. V2 엔티티 대신에 DTO를 RequestBody에 매핑 @PostMapping(\"/api/v2/members\") public CreateMemberResponse saveMemberV2(@RequestBody @Valid CreateMemberRequest request) { Member member = new Member(); member.setName(request.getName()); Long id = memberService.join(member); return new CreateMemberResponse(id); } Member엔티티 대신에 CreateMemberRequest를 RequestBody와 매핑 엔티티와 프레젠테이션 계층을 위한 로직 분리 엔티티와 API 스펙 분리 엔티티가 변해도 API 스펙 변화X 회원 수정 API //수정 API @PutMapping(\"/api/v2/members/{id}\") public UpdateMemberResponse updateMemberV2( @PathVariable(\"id\") Long id, @RequestBody @Valid UpdateMemberRequest request) { //수정할때 가급적이면 변경감지(member가져와서 값만 수정하면 자동으로 변경감지되서 update됨) 쓰기 memberService.update(id, request.getName()); Member findMember = memberService.findOne(id); return new UpdateMemberResponse(findMember.getId(), findMember.getName()); } @Data static class UpdateMemberRequest { private String name; } @Data @AllArgsConstructor //엔티티에는 에노테이션 getter정도만씀. 자제하는편. 이유는?, DTO에는 많이씀 static class UpdateMemberResponse { private Long id; private String name; } 회원 수정도 DTO를 요청 파라미터에 매핑한다.\n@Service @Transactional(readOnly = true) @RequiredArgsConstructor public class MemberService { private final MemberRepository memberRepository; @Transactional public void update(Long id, String name) { Member member = memberRepository.findOne(id); member.setName(name); } } 변경 감지로 데이터 수정\n오류정정: 회원 수정 API updateMemberV2 은 회원 정보를 부분 업데이트 한다. 여기서 PUT 방식을 사용했는데, PUT은 전체 업데이트를 할 때 사용하는 것이 맞다. 부분 업데이트를 하려 PATCH를 사용하거나 POST를 사용하는 것이 REST 스타일에 맞다.\n회원 조회 API 회원조회 V1: 응답 값으로 엔티티를 직접 외부에 노출 @RestController @RequiredArgsConstructor public class MemberApiController { private final MemberService memberService; //조회 V1: 안 좋은 버전, 모든 엔티티가 노출, @JsonIgnore -\u003e 이건 정말 최악, api가 이거 하나인가! 화면에 종속적이지 마라! @GetMapping(\"/api/v1/members\") public List\u003cMember\u003e memebersV1() { return memberService.findMembers(); } } 회원 조회 V1의\n문제점 엔티티에 프레젠테이션 계층을 위한 로직 추가 엔티티 모든값 노출 응답 스펙을 맞추기 위한 로직 추가(@JsonIgnore, 별도의 view 로직 등) 같은 엔티티에 용도에 따라 다양한 API가 만들어지는데 한 엔티티에 각각의 API를 위한 프레젠테이션 응답 로직을 담기는 어려움 엔티티 변경되면 API 스펙 변화 컬렉션 직접 반환시 후에 API 스펙 변경이 어려움 결론 API 응답 스펙에 맞추어 별도의 DTO 반환 회원 조회 V2:응답 값으로 엔티티가 아닌 별도의 DTO 사용 @GetMapping(\"/api/v2/members\") public Result memberV2() { List\u003cMember\u003e findmembers = memberService.findMembers(); List\u003cMemberDto\u003e collect = findmembers.stream() .map(m -\u003e new MemberDto(m.getName())) .collect(Collectors.toList()); return new Result(collect); } @Data @AllArgsConstructor static class Result\u003cT\u003e { private T data; } @Data @AllArgsConstructor static class MemberDto { private String name; } 엔티티를 DTO로 볂완해서 반환 엔티티가 변해도 API 스펙 변경X Result 클래스로 컬렉션을 감싸서 필요한 필드 추가 가능 ","wordCount":"500","inLanguage":"en","image":"https://yosong6729.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-09-23T16:35:17+09:00","dateModified":"2024-09-23T16:35:17+09:00","author":{"@type":"Person","name":"yosong6729"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yosong6729.github.io/post/api-%EA%B0%9C%EB%B0%9C-%EA%B8%B0%EB%B3%B8/"},"publisher":{"@type":"Organization","name":"Yosong6729 Blog","logo":{"@type":"ImageObject","url":"https://yosong6729.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yosong6729.github.io/ accesskey=h title="Yosong6729 블로그 (Alt + H)"><img src=https://yosong6729.github.io/apple-touch-icon.png alt aria-label=logo height=35>Yosong6729 블로그</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yosong6729.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://yosong6729.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yosong6729.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://yosong6729.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">API 개발 기본</h1><div class=post-meta><span title='2024-09-23 16:35:17 +0900 KST'>September 23, 2024</span>&nbsp;·&nbsp;yosong6729&nbsp;|&nbsp;<a href=https://github.com/yosong6729/blog/tree/main/content/post/API%20%ea%b0%9c%eb%b0%9c%20%ea%b8%b0%eb%b3%b8/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%ed%9a%8c%ec%9b%90-%eb%93%b1%eb%a1%9d-api aria-label="회원 등록 API">회원 등록 API</a><ul><li><a href=#v1--%ec%97%94%ed%8b%b0%ed%8b%b0%eb%a5%bc-request-body%ec%97%90-%ec%a7%81%ec%a0%91-%eb%a7%a4%ed%95%91 aria-label="V1 : 엔티티를 Request Body에 직접 매핑">V1 : 엔티티를 Request Body에 직접 매핑</a></li><li><a href=#v2-%ec%97%94%ed%8b%b0%ed%8b%b0-%eb%8c%80%ec%8b%a0%ec%97%90-dto%eb%a5%bc-requestbody%ec%97%90-%eb%a7%a4%ed%95%91 aria-label="V2 엔티티 대신에 DTO를 RequestBody에 매핑">V2 엔티티 대신에 DTO를 RequestBody에 매핑</a></li></ul></li><li><a href=#%ed%9a%8c%ec%9b%90-%ec%88%98%ec%a0%95-api aria-label="회원 수정 API">회원 수정 API</a></li><li><a href=#%ed%9a%8c%ec%9b%90-%ec%a1%b0%ed%9a%8c-api aria-label="회원 조회 API">회원 조회 API</a><ul><li><a href=#%ed%9a%8c%ec%9b%90%ec%a1%b0%ed%9a%8c-v1-%ec%9d%91%eb%8b%b5-%ea%b0%92%ec%9c%bc%eb%a1%9c-%ec%97%94%ed%8b%b0%ed%8b%b0%eb%a5%bc-%ec%a7%81%ec%a0%91-%ec%99%b8%eb%b6%80%ec%97%90-%eb%85%b8%ec%b6%9c aria-label="회원조회 V1: 응답 값으로 엔티티를 직접 외부에 노출">회원조회 V1: 응답 값으로 엔티티를 직접 외부에 노출</a></li><li><a href=#%ed%9a%8c%ec%9b%90-%ec%a1%b0%ed%9a%8c-v2%ec%9d%91%eb%8b%b5-%ea%b0%92%ec%9c%bc%eb%a1%9c-%ec%97%94%ed%8b%b0%ed%8b%b0%ea%b0%80-%ec%95%84%eb%8b%8c-%eb%b3%84%eb%8f%84%ec%9d%98-dto-%ec%82%ac%ec%9a%a9 aria-label="회원 조회 V2:응답 값으로 엔티티가 아닌 별도의 DTO 사용">회원 조회 V2:응답 값으로 엔티티가 아닌 별도의 DTO 사용</a></li></ul></li></ul></div></details></div><div class=post-content><blockquote><p>해당 글은 김영한님의 인프런 강의 <a href=https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-API%EA%B0%9C%EB%B0%9C-%EC%84%B1%EB%8A%A5%EC%B5%9C%EC%A0%81%ED%99%94>스프링부트와 JPA활용2 - API 개발과 성능 최적화</a>을 듣고 내용을 정리하기 위한 것으로 자세한 설명은 해당 강의를 통해 확인할 수 있습니다.</p></blockquote><h2 id=회원-등록-api>회원 등록 API<a hidden class=anchor aria-hidden=true href=#회원-등록-api>#</a></h2><p><strong>회원 등록 API</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequiredArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberApiController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MemberService</span><span class=w> </span><span class=n>memberService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/v1/members&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>CreateMemberResponse</span><span class=w> </span><span class=nf>saveMemberV1</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=nd>@Valid</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberService</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CreateMemberResponse</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>CreateMemberRequest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>CreateMemberResponse</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=nf>CreateMemberResponse</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=v1--엔티티를-request-body에-직접-매핑>V1 : 엔티티를 Request Body에 직접 매핑<a hidden class=anchor aria-hidden=true href=#v1--엔티티를-request-body에-직접-매핑>#</a></h3><ul><li>문제점<ul><li>엔티티에 프레젠테이션 계층을 위한 로직이 추가된다.</li><li>@NotEmpty 같은 검증을 위한 로직이 엔티티에 들어간다.</li><li>회원 엔티티를 위한 API가 다양하게 만들어 지는데, 한 엔티티에 각각의 API를 위한 모든 요청 요구사항을 담기는 어렵다.</li><li>엔티티가 변경되면 API 스펙이 변경된다.</li></ul></li><li>결론<ul><li>API 요청 스펙에 맞추어 별도의 DTO를 파라미터로 받는다.</li></ul></li></ul><h3 id=v2-엔티티-대신에-dto를-requestbody에-매핑>V2 엔티티 대신에 DTO를 RequestBody에 매핑<a hidden class=anchor aria-hidden=true href=#v2-엔티티-대신에-dto를-requestbody에-매핑>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/api/v2/members&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>CreateMemberResponse</span><span class=w> </span><span class=nf>saveMemberV2</span><span class=p>(</span><span class=nd>@RequestBody</span><span class=w> </span><span class=nd>@Valid</span><span class=w> </span><span class=n>CreateMemberRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Member</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>member</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberService</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CreateMemberResponse</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>Member엔티티 대신에 CreateMemberRequest를 RequestBody와 매핑</li><li>엔티티와 프레젠테이션 계층을 위한 로직 분리</li><li>엔티티와 API 스펙 분리</li><li>엔티티가 변해도 API 스펙 변화X</li></ul><hr><h2 id=회원-수정-api>회원 수정 API<a hidden class=anchor aria-hidden=true href=#회원-수정-api>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//수정 API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@PutMapping</span><span class=p>(</span><span class=s>&#34;/api/v2/members/{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>UpdateMemberResponse</span><span class=w> </span><span class=nf>updateMemberV2</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@PathVariable</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>)</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestBody</span><span class=w> </span><span class=nd>@Valid</span><span class=w> </span><span class=n>UpdateMemberRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//수정할때 가급적이면 변경감지(member가져와서 값만 수정하면 자동으로 변경감지되서 update됨) 쓰기</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>memberService</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Member</span><span class=w> </span><span class=n>findMember</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberService</span><span class=p>.</span><span class=na>findOne</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UpdateMemberResponse</span><span class=p>(</span><span class=n>findMember</span><span class=p>.</span><span class=na>getId</span><span class=p>(),</span><span class=w> </span><span class=n>findMember</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>UpdateMemberRequest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w> </span><span class=c1>//엔티티에는 에노테이션 getter정도만씀. 자제하는편. 이유는?, DTO에는 많이씀</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>UpdateMemberResponse</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>회원 수정도 DTO를 요청 파라미터에 매핑한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Transactional</span><span class=p>(</span><span class=n>readOnly</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequiredArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MemberRepository</span><span class=w> </span><span class=n>memberRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=n>Long</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberRepository</span><span class=p>.</span><span class=na>findOne</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>member</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=n>name</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>변경 감지로 데이터 수정</p><blockquote><p>오류정정: 회원 수정 API updateMemberV2 은 회원 정보를 부분 업데이트 한다. 여기서 PUT 방식을 사용했는데, PUT은 전체 업데이트를 할 때 사용하는 것이 맞다. 부분 업데이트를 하려 PATCH를 사용하거나 POST를 사용하는 것이 REST 스타일에 맞다.</p></blockquote><hr><h2 id=회원-조회-api>회원 조회 API<a hidden class=anchor aria-hidden=true href=#회원-조회-api>#</a></h2><h3 id=회원조회-v1-응답-값으로-엔티티를-직접-외부에-노출>회원조회 V1: 응답 값으로 엔티티를 직접 외부에 노출<a hidden class=anchor aria-hidden=true href=#회원조회-v1-응답-값으로-엔티티를-직접-외부에-노출>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequiredArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberApiController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>MemberService</span><span class=w> </span><span class=n>memberService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=c1>//조회 V1: 안 좋은 버전, 모든 엔티티가 노출, @JsonIgnore -&gt; 이건 정말 최악, api가 이거 하나인가! 화면에 종속적이지 마라!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/api/v1/members&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=nf>memebersV1</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>memberService</span><span class=p>.</span><span class=na>findMembers</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>회원 조회 V1의</p><ul><li>문제점<ul><li>엔티티에 프레젠테이션 계층을 위한 로직 추가</li><li>엔티티 모든값 노출</li><li>응답 스펙을 맞추기 위한 로직 추가(@JsonIgnore, 별도의 view 로직 등)</li><li>같은 엔티티에 용도에 따라 다양한 API가 만들어지는데 한 엔티티에 각각의 API를 위한 프레젠테이션 응답 로직을 담기는 어려움</li><li>엔티티 변경되면 API 스펙 변화</li><li>컬렉션 직접 반환시 후에 API 스펙 변경이 어려움</li></ul></li><li>결론<ul><li>API 응답 스펙에 맞추어 별도의 DTO 반환</li></ul></li></ul><h3 id=회원-조회-v2응답-값으로-엔티티가-아닌-별도의-dto-사용>회원 조회 V2:응답 값으로 엔티티가 아닌 별도의 DTO 사용<a hidden class=anchor aria-hidden=true href=#회원-조회-v2응답-값으로-엔티티가-아닌-별도의-dto-사용>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/api/v2/members&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=w> </span><span class=nf>memberV2</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Member</span><span class=o>&gt;</span><span class=w> </span><span class=n>findmembers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memberService</span><span class=p>.</span><span class=na>findMembers</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>MemberDto</span><span class=o>&gt;</span><span class=w> </span><span class=n>collect</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>findmembers</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>m</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>MemberDto</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getName</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Result</span><span class=p>(</span><span class=n>collect</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>Result</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=n>data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>MemberDto</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><hr><ul><li>엔티티를 DTO로 볂완해서 반환</li><li>엔티티가 변해도 API 스펙 변경X</li><li>Result 클래스로 컬렉션을 감싸서 필요한 필드 추가 가능</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://yosong6729.github.io/tags/spring-boot/>Spring Boot</a></li><li><a href=https://yosong6729.github.io/tags/jpa/>JPA</a></li></ul><nav class=paginav><a class=prev href=https://yosong6729.github.io/post/%EC%A7%80%EC%97%B0-%EB%A1%9C%EB%94%A9%EA%B3%BC-%EC%A1%B0%ED%9A%8C-%EC%84%B1%EB%8A%A5-%EC%B5%9C%EC%A0%81%ED%99%94/><span class=title>« Prev</span><br><span>지연 로딩과 조회 성능 최적화</span>
</a><a class=next href=https://yosong6729.github.io/post/%EC%9B%B9-%EA%B3%84%EC%B8%B5-%EA%B0%9C%EB%B0%9C/><span class=title>Next »</span><br><span>웹 계층 개발</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://yosong6729.github.io/>Yosong6729 Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>